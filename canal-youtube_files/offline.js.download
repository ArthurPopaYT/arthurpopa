(function(g){var window=this;'use strict';var TBR=function(Q){var z=new g.RA("und",new g.bD("Default","und",!0));z.captionTracks=Q.captionTracks;return z},eZs=function(Q){return new g.ng(function(z,H){var f=Q.length,b=[];
if(f)for(var L=function(y,q){f--;b[y]=q;f==0&&z(b)},u=function(y){H(y)},X,v=0;v<Q.length;v++)X=Q[v],g.Tq_(X,g.RJ(L,v),u);
else z(b)})},PF=function(Q){this.Z=Q},aN=function(){PF.apply(this,arguments)},lWs=function(){aN.apply(this,arguments)},RZx=function(){aN.apply(this,arguments)},Q2t=function(){aN.apply(this,arguments)},z8O=function(){aN.apply(this,arguments)},H7s=function(){aN.apply(this,arguments)},fy5=function(){aN.apply(this,arguments)},b7s=function(){PF.apply(this,arguments)},LGL=function(){aN.apply(this,arguments)},uAs=function(){aN.apply(this,arguments)},Sam=function(){aN.apply(this,arguments)},XQR=function(){aN.apply(this,
arguments)},vqs=function(){aN.apply(this,arguments)},ykJ=function(){aN.apply(this,arguments)},qa5=function(){aN.apply(this,arguments)},MFR=function(){aN.apply(this,arguments)},ClL=function(){aN.apply(this,arguments)},tFR=function(){aN.apply(this,arguments)},Eqx=function(){aN.apply(this,arguments)},pQs=function(){aN.apply(this,arguments)},nqm=function(){PF.apply(this,arguments)},gqu=function(){aN.apply(this,arguments)},Z75=function(){aN.apply(this,arguments)},GnT=function(){aN.apply(this,arguments)},
$7s=function(){aN.apply(this,arguments)},j2u=function(){aN.apply(this,arguments)},FGR=function(){aN.apply(this,arguments)},x7s=function(){aN.apply(this,arguments)},O7L=function(){aN.apply(this,arguments)},oqL=function(){aN.apply(this,arguments)},Jku=function(){PF.apply(this,arguments)},Njs=function(){PF.apply(this,arguments)},IyT=function(){PF.apply(this,arguments)},Akm=function(){aN.apply(this,arguments)},Ya5=function(){aN.apply(this,arguments)},rks=function(){aN.apply(this,arguments)},s2T=function(){aN.apply(this,
arguments)},Bj5=function(){aN.apply(this,arguments)},PlY=function(){aN.apply(this,arguments)},ayu=function(){aN.apply(this,arguments)},U7B=function(){aN.apply(this,arguments)},cks=function(){aN.apply(this,arguments)},i7u=function(){aN.apply(this,arguments)},h8m=function(){aN.apply(this,arguments)},WGt=function(){aN.apply(this,arguments)},D7s=function(){aN.apply(this,arguments)},KGs=function(){aN.apply(this,arguments)},VFB=function(){aN.apply(this,arguments)},d7R=function(){aN.apply(this,arguments)},
m7u=function(){aN.apply(this,arguments)},wQJ=function(){aN.apply(this,arguments)},knJ=function(){aN.apply(this,arguments)},Tju=function(){aN.apply(this,arguments)},e8T=function(){aN.apply(this,arguments)},lyO=function(){aN.apply(this,arguments)},R8u=function(){aN.apply(this,arguments)},QsB=function(){aN.apply(this,arguments)},zlJ=function(){aN.apply(this,arguments)},Hlu=function(){aN.apply(this,arguments)},fkT=function(){PF.apply(this,arguments)},blu=function(){aN.apply(this,arguments)},LoB=function(){aN.apply(this,
arguments)},uYR=function(){aN.apply(this,arguments)},Sns=function(){aN.apply(this,arguments)},XIu=function(){aN.apply(this,arguments)},v3t=function(){aN.apply(this,arguments)},y5s=function(){aN.apply(this,arguments)},qnt=function(){aN.apply(this,arguments)},MtL=function(){aN.apply(this,arguments)},CVu=function(){aN.apply(this,arguments)},ttT=function(){aN.apply(this,arguments)},E3s=function(){aN.apply(this,arguments)},pIO=function(){aN.apply(this,arguments)},n3O=function(){aN.apply(this,arguments)},
g35=function(){aN.apply(this,arguments)},Zlt=function(){aN.apply(this,arguments)},G9T=function(){aN.apply(this,arguments)},$TY=function(){aN.apply(this,arguments)},jsu=function(){aN.apply(this,arguments)},FoR=function(){aN.apply(this,arguments)},xTJ=function(){aN.apply(this,arguments)},Olm=function(){aN.apply(this,arguments)},o3Y=function(){aN.apply(this,arguments)},J5Y=function(){aN.apply(this,arguments)},NAO=function(){aN.apply(this,arguments)},IkO=function(){aN.apply(this,arguments)},A5R=function(){aN.apply(this,
arguments)},Ynm=function(){aN.apply(this,arguments)},r5R=function(){aN.apply(this,arguments)},ssu=function(){aN.apply(this,arguments)},BA5=function(Q){Q=Q.key||Q.id;
if(!Q)throw Error("Entity key is missing");return Q},PVT=function(){if(Uq)return Uq();
var Q={};Uq=g.zK("PersistentEntityStoreDb",{lU:(Q.EntityStore={Gj:1},Q.EntityAssociationStore={Gj:2},Q),shared:!1,upgrade:function(z,H){H(1)&&g.aE(g.A1(z,"EntityStore",{keyPath:"key"}),"entityType","entityType");H(2)&&(z=g.A1(z,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.aE(z,"byParentEntityKey","parentEntityKey"),g.aE(z,"byChildEntityKey","childEntityKey"))},
version:3});return Uq()},akJ=function(Q){return g.V5(PVT(),Q)},UTT=function(Q){return g.V5((0,g.Ans)(),Q)},cF=function(Q){this.token=Q},iX=function(Q,z){z=z===void 0?{}:z;
g.wD.call(this,g.Y7s[Q],Object.assign({},{name:"PESEncoderError",type:Q},z));this.type=Q;this.level="WARNING";Object.setPrototypeOf(this,iX.prototype)},c5u=function(Q){return new iX("WRONG_DATA_TYPE",{o3:Q})},ilt=function(Q){return Q instanceof Error?new iX("UNKNOWN_ENCODE_ERROR",{SB:Q.message}):new iX("UNKNOWN_ENCODE_ERROR")},hlt=function(Q){return Q instanceof Error?new iX("UNKNOWN_DECODE_ERROR",{SB:Q.message}):new iX("UNKNOWN_DECODE_ERROR")},Wox=function(Q,z){Q=Q instanceof iX?Q:z(Q);
g.BT(Q);throw Q;},DTO=function(){},Ko5=function(Q,z,H){try{return Q.L(z,H)}catch(f){Wox(f,ilt)}},Vts=function(Q){Q=(new TextEncoder).encode(Q).subarray(0,16);
var z=new Uint8Array(16);z.set(Q);return z},hV=function(Q){this.Z=Q},mTu=function(Q){var z=dTR[Q];
if(z)return z;g.PT(new g.wD("Entity model not found.",{entityType:Q}))},wIL=function(Q,z){this.Z=Q;
this.B=z;this.L={}},TAL=function(Q,z){a:{Q=k9t(Q.B,z.version);
try{var H=Q.B(z.data,z.key);break a}catch(f){Wox(f,hlt)}H=void 0}return H},WF=function(Q,z,H){return Q.Z.objectStore("EntityStore").get(z).then(function(f){if(f){if(H&&f.entityType!==H)throw Error("Incorrect entity type");
return TAL(Q,f)}})},D9=function(Q,z,H){return H?(H=H.map(function(f){return WF(Q,f,z)}),g.xw.all(H)):Q.Z.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(z)).then(function(f){return f.map(function(b){return TAL(Q,b)})})},Vl=function(Q,z,H){var f=BA5(z),b=k9t(Q.B,1),L=Object.assign({},z);
return Q.Z.objectStore("EntityStore").get(f).then(function(u){if(u){if(u.entityType!==H)throw Error("Incorrect entity type");L.entityMetadata||(u=TAL(Q,u),L.entityMetadata=u.entityMetadata)}}).then(function(){var u={key:f,
entityType:H,data:Ko5(b,L,f),version:1};return g.xw.all([g.se(Q.Z.objectStore("EntityStore"),u),els(Q,L,H)])}).then(function(){Kz(Q,f,H);
return f})},lkO=function(Q,z,H){z=z.map(function(f){return Vl(Q,f,H)});
return g.xw.all(z)},dF=function(Q,z,H){if(H==null?0:H.fW){var f=new Set;
return Rlt(Q,z,f).then(function(){for(var L=[],u=g.n(f),X=u.next();!X.done;X=u.next())L.push(dF(Q,X.value));return g.xw.all(L).then(function(){})})}var b=g.Tp(z).entityType;
return g.xw.all([Q.Z.objectStore("EntityStore").delete(z),Q3L(Q,z)]).then(function(){Kz(Q,z,b)})},z_s=function(Q,z){return g.h1(Q.Z.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(z)},function(H){return g.xw.all([H.delete(),
Q3L(Q,H.cursor.primaryKey)]).then(function(){Kz(Q,H.cursor.primaryKey,z);return g.cH(H)})})},HhT=function(Q,z,H,f){var b=k9t(Q.B,1);
return WF(Q,z,f).then(function(L){if(L){L=g.p4(L,H);var u={key:z,entityType:f,data:Ko5(b,L,z),version:1};return g.xw.all([g.se(Q.Z.objectStore("EntityStore"),u),els(Q,L,f)])}}).then(function(){Kz(Q,z,f);
return z})},Kz=function(Q,z,H){var f=Q.L[H];
f||(f=new Set,Q.L[H]=f);f.add(z)},f5R=function(Q,z,H){var f=BA5(z);
H=mTu(H);if(!H)return g.xw.resolve([]);H=new H(z);Q=Q.Z.objectStore("EntityAssociationStore");z=[];H=g.n(H.B());for(var b=H.next();!b.done;b=H.next())z.push(g.se(Q,{parentEntityKey:f,childEntityKey:b.value}));return g.xw.all(z).then(function(L){return L.map(function(u){return u[1]})})},Q3L=function(Q,z){return Q.Z.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(z))},els=function(Q,z,H){var f=BA5(z);
return Q3L(Q,f).then(function(){return f5R(Q,z,H)})},Rlt=function(Q,z,H){if(H.has(z))return g.xw.resolve(void 0);
H.add(z);return bhL(Q,z).then(function(f){return Q.Z.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(z)).then(function(){return f})}).then(function(f){var b=g.xw.resolve(void 0);
f=g.n(f);for(var L=f.next(),u={};!L.done;u={bD:void 0},L=f.next())u.bD=L.value,b=b.then(function(X){return function(){return Rlt(Q,X.bD,H)}}(u));
return b}).then(function(){})},bhL=function(Q,z){var H=Q.Z.objectStore("EntityAssociationStore");
return H.index("byParentEntityKey").getAll(IDBKeyRange.only(z)).then(function(f){var b=[];f=g.n(f);for(var L=f.next();!L.done;L=f.next())L=L.value,b.push(H.index("byChildEntityKey").getAll(L.childEntityKey));return g.xw.all(b)}).then(function(f){var b=[];
f=g.n(f);for(var L=f.next();!L.done;L=f.next())L=L.value,L.length===1&&b.push(L[0].childEntityKey);return b})},mY=function(){},LEJ=function(){this.Z={};
this.Z[0]=new mY;if(!g.jT("aes_pes_encoder_killswitch")){var Q=this.Z;try{var z=g.kQ();var H=Vts(z);var f=new hV(new g.j7(H),new g.$9(H))}catch(b){throw Q=b instanceof Error?new iX("KEY_CREATION_FAILED",{SB:b.message}):new iX("KEY_CREATION_FAILED"),g.BT(Q),Q;}Q[1]=f}},k9t=function(Q,z){z=z===void 0?0:z;
Q=Q.Z[z];if(!Q)throw z=new iX("INVALID_ENCODER_VERSION",{o3:z}),g.BT(z),z;return Q},wF=function(Q,z){g.h.call(this);
this.token=Q;this.Z=z;this.observers=[];Q=new g.iL.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.kQ());Q.onmessage=this.B.bind(this);this.channel=Q},k0=function(Q,z,H){var f,b,L,u;
return g.B(function(X){if(X.Z==1)return g.Y(X,akJ(Q.token),2);if(X.Z!=3)return f=X.B,g.Y(X,g.rG(f,["EntityStore","EntityAssociationStore"],z,function(v){b=new wIL(v,Q.Z);return H(b)}),3);
L=X.B;b&&(u=b.L,Object.keys(u).length>0&&(Q.channel.postMessage(u),uLO(Q,u)));return X.return(L)})},Tk=function(Q,z,H){return k0(Q,{mode:"readwrite",
VE:!0},function(f){return Vl(f,z,H)})},Six=function(Q,z){return k0(Q,{mode:"readwrite",
VE:!0},function(H){return lkO(H,z,"offlineOrchestrationActionWrapperEntity")})},Xru=function(Q,z){return k0(Q,{mode:"readwrite",
VE:!0},function(H){return dF(H,z)})},ves=function(Q){return k0(Q,{mode:"readwrite",
VE:!0},function(z){return z_s(z,"videoPlaybackPositionEntity")})},eC=function(Q,z,H){return k0(Q,{mode:"readonly",
VE:!0},function(f){return WF(f,z,H)})},lX=function(Q,z,H){return k0(Q,{mode:"readonly",
VE:!0},function(f){return D9(f,z,H)})},uLO=function(Q,z){Q=g.n(Q.observers);
for(var H=Q.next();!H.done;H=Q.next())H=H.value,H(z)},yxx=function(){var Q,z,H;
return g.B(function(f){if(f.Z==1)return g.$v(f,2),g.Y(f,g.RE(),4);if(f.Z!=2){Q=f.B;if(!Q||!g.Td()||typeof g.iL.BroadcastChannel==="undefined")return f.return();z=new LEJ;return f.return(new wF(Q,z))}H=g.xv(f);H instanceof Error&&g.BT(H);return f.return()})},RN=function(){qiR||(qiR=yxx());
return qiR},M$u=function(Q){var z;
Q=(z=Q.options)==null?void 0:z.persistenceOption;return Q==="ENTITY_PERSISTENCE_OPTION_PERSIST"||Q==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},CWt=function(Q){var z;
return g.B(function(H){return H.Z==1?g.Y(H,RN(),2):(z=H.B)?g.Y(H,k0(z,"readwrite",function(f){for(var b={},L=g.n(Q),u=L.next(),X={};!u.done;X={v7:void 0,Ta:void 0},u=L.next())X.v7=u.value,X.v7.entityKey&&M$u(X.v7)&&(X.Ta=g.Or(X.v7.payload),u=void 0,X.v7.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(u=function(v){return function(){return Vl(f,v.v7.payload[v.Ta],v.Ta)}}(X)),X.v7.type==="ENTITY_MUTATION_TYPE_DELETE"&&(u=function(v){return function(){return dF(f,v.v7.entityKey)}}(X)),X.v7.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(u=function(v){return function(){return HhT(f,v.v7.entityKey,v.v7.payload[v.Ta],v.Ta)}}(X)),u&&(b[X.v7.entityKey]=b[X.v7.entityKey]?b[X.v7.entityKey].then(u):u()));
return g.xw.all(Object.values(b))}),0):H.return()})},t$Y=function(Q){var z;
return g.B(function(H){if(H.Z==1){z=Q.mutations;if(!z||z.length<=0)return H.return();if(g.Qt){var f={type:"ENTITY_LOADED"};z!==void 0&&(f.payload=z);g.Qt.dispatch(f)}return g.Y(H,CWt(z),2)}z.length=0;g.Gu(H)})},Eet=function(Q){return Q!==void 0},pr5=function(Q){var z=g.oZ();
z=Object.assign({},z);Q=Object.assign({},Q);for(var H in z)Q[H]?(z[H]!==4&&(z[H]=Q[H]),delete Q[H]):z[H]!==2&&(z[H]=4);Object.assign(z,Q);g.fqA(z);JSON.stringify(z);return z},neB=function(Q){var z,H;
return g.B(function(f){if(f.Z==1)return g.Y(f,g.RE(),2);if(f.Z!=3)return(z=f.B)?g.Y(f,g.IZ(z),3):f.return();H=f.B;return f.return(g.rG(H,["index","media","captions"],{mode:"readwrite",VE:!0},function(b){var L=IDBKeyRange.bound(Q+"|",Q+"~");b=[b.objectStore("index").delete(L),b.objectStore("media").delete(L),b.objectStore("captions").delete(L)];return g.xw.all(b).then(function(){})}))})},gex=function(){var Q,z;
return g.B(function(H){if(H.Z==1)return g.Y(H,g.RE(),2);if(H.Z!=3){Q=H.B;if(!Q)throw g.j9("rvdfd");return g.Y(H,g.IZ(Q),3)}z=H.B;return H.return(g.rG(z,["index","media"],{mode:"readwrite",VE:!0},function(f){var b={};return g.Ue(f.objectStore("index"),{},function(L){var u=L.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),X=g.xw.resolve(void 0);if(u){var v=u[1];u=u[2];b[v]=b[v]||{};var y;b[v][u]=g.Xcp((y=L.getValue())==null?void 0:y.fmts)}else X=L.delete().then(function(){});
return g.xw.all([g.cH(L),X]).then(function(q){return g.n(q).next().value})}).then(function(){for(var L={},u=g.n(Object.keys(b)),X=u.next();!X.done;X=u.next()){X=X.value;
var v=b[X].v;L[X]=b[X].a&&v?1:2}var y=pr5(L);return g.UP_(f.objectStore("media"),{},function(q){var M=q.cursor.key.match(g.MGZ);M&&L[M[1]]||f.objectStore("media").delete(q.cursor.key);return g.Nv6(q)}).then(function(){return y})})}))})},Zhs=function(Q,z){var H,f;
return g.B(function(b){if(b.Z==1)return g.Y(b,g.RE(),2);if(b.Z!=3){H=b.B;if(!H)throw g.j9("wct");return g.Y(b,g.IZ(H),3)}f=b.B;return g.Y(b,g.rG(f,["captions"],{mode:"readwrite",VE:!0},function(L){var u=[];L=L.objectStore("captions");for(var X=0;X<z.length;X++){var v=g.se(L,z[X],Q+"|"+z[X].metadata.vss_id);u.push(v)}return g.xw.all(u)}),0)})},GJs=function(Q){var z,H,f;
return g.B(function(b){if(b.Z==1)return z=IDBKeyRange.bound(Q+"|",Q+"~"),g.Y(b,g.RE(),2);if(b.Z!=3){H=b.B;if(!H)throw g.j9("gactfv");return g.Y(b,g.IZ(H),3)}f=b.B;return b.return(f.getAll("captions",z))})},$2t=function(Q){return g.B(function(z){g.NG(Q,0);
return z.return(neB(Q))})},j3J=function(Q){return{context:g.eh(),
videoIds:Q}},FEu=function(Q){return{context:g.eh(),
playlistIds:Q}},x2T=function(Q){return{context:g.eh(),
offlinePlaylistSyncChecks:Q}},OhJ=function(){this.Z=new Map},JxY=function(){oes||(oes=new OhJ);
return oes},NWx=function(Q,z){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:Q},metadata:z,statusCode:void 0,csn:void 0,can:void 0}},I5O=function(Q,z,H){if(!H){var f=f===void 0?!1:f;
H=Q.Z.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!H||f)H=g.xk(16),Q.Z.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",H)}Q={flowNonce:H,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:z.eventType};z.metadata&&(Q.flowMetadata=z.metadata);z.statusCode!==void 0&&(Q.flowEventStatus=z.statusCode);z.csn&&(Q.csn=z.csn);z.can&&(Q.can=z.can);g.y5("flowEvent",Q,void 0)},Ax5=function(Q){var z,H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R,Z,d,h8,$O,Cs,J8,eY,Ls,ps,O,N,A;
return g.B(function(P){if(P.Z==1)return g.Y(P,k0(Q,{mode:"readonly",VE:!0},function(c){return D9(c,"playbackData").then(function(zu){var Ln=zu.map(function(pn){return pn.transfer}).filter(function(pn){return!!pn}),uL=zu.map(function(pn){return pn.offlineVideoPolicy}).filter(function(pn){return!!pn}),a=zu.filter(function(pn){return!!pn.key}).map(function(pn){return g.ed(g.Tp(pn.key).entityId,"downloadStatusEntity")});
Ln=D9(c,"transfer",Ln);uL=D9(c,"offlineVideoPolicy",uL);a=D9(c,"downloadStatusEntity",a);var qk=Ln.then(function(pn){pn=pn.reduce(function(v_,Yv){(Yv==null?0:Yv.offlineVideoStreams)&&v_.push.apply(v_,g.F(Yv.offlineVideoStreams));return v_},[]).filter(function(v_){return!!v_});
return D9(c,"offlineVideoStreams",pn)});
return g.xw.all([Ln,uL,qk,a]).then(function(pn){var v_=g.n(pn);pn=v_.next().value;var Yv=v_.next().value;var tt=v_.next().value;v_=v_.next().value;return[zu,pn,Yv,tt,v_]})})}),2);
if(P.Z!=3)return z=P.B,g.Y(P,k0(Q,{mode:"readonly",VE:!0},function(c){return D9(c,"mainDownloadsListEntity").then(function(zu){var Ln,uL;return(uL=(Ln=zu[0])==null?void 0:Ln.downloads)!=null?uL:[]})}),3);
H=P.B;f=g.n(z);b=f.next().value;L=f.next().value;u=f.next().value;X=f.next().value;v=f.next().value;y=b;q=L;M=u;C=X;t=v;E={};G={};x={};J={};I={};r=[];U=g.n(q);for(D=U.next();!D.done;D=U.next())(T=D.value)&&(E[T.key]=T);k=g.n(M);for(bL=k.next();!bL.done;bL=k.next())(SY=bL.value)&&(G[SY.key]=SY);Q9=g.n(t);for(V=Q9.next();!V.done;V=Q9.next())(R=V.value)&&(x[R.key]=R);Z=g.n(C);for(d=Z.next();!d.done;d=Z.next())(h8=d.value)&&(J[h8.key]=h8);$O=g.n(H);for(Cs=$O.next();!Cs.done;Cs=$O.next())J8=Cs.value,eY=
void 0,I[(eY=J8.videoItem)!=null?eY:""]=!0,J8.videoItem&&(ps=Ls=void 0,O=(ps=(Ls=g.Tp(J8.videoItem))==null?void 0:Ls.entityId)!=null?ps:"",r.push({externalVideoId:O}));N=y.filter(function(c){if(!c||!c.key||!c.offlineVideoPolicy)return!1;c=g.Tp(c.key).entityId;c=g.ed(c,"downloadStatusEntity");var zu;return!(c&&((zu=x[c])==null?void 0:zu.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
A=N.map(function(c){var zu=E[c.transfer],Ln=[];if(zu==null?0:zu.offlineVideoStreams)for(var uL=g.n(zu.offlineVideoStreams),a=uL.next();!a.done;a=uL.next())(a=J[a.value])&&Ln.push(a);uL=G[c.offlineVideoPolicy];a=I;var qk=c==null?void 0:c.playerResponseTimestamp,pn=g.Tp(uL.key).entityId;c=g.ed(pn,"mainVideoEntity");if(uL.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var v_="OFFLINE_VIDEO_STATE_DISABLED";uL.expirationTimestamp&&Number(uL.expirationTimestamp)<Date.now()/1E3&&(v_="OFFLINE_VIDEO_STATE_EXPIRED")}else if(uL.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")v_="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(zu==null?void 0:zu.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":v_="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":v_="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":v_="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":v_="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":v_="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":v_="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:v_="OFFLINE_VIDEO_STATE_UNKNOWN"}if(v_==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(zu==null?void 0:zu.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":v_="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":v_="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":v_=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}pn={id:pn,videoState:v_};if(zu==null?0:zu.cotn)pn.cotn=zu.cotn;if(zu==null?0:zu.maximumDownloadQuality)pn.selectedVideoQuality=zu==null?void 0:zu.maximumDownloadQuality;if(zu==null?0:zu.lastProgressTimeMs)pn.lastProgressTimeMs=zu.lastProgressTimeMs;qk&&(pn.playerResponseSavedTimeMs=String(Number(qk)*1E3));zu=String;qk=0;Ln=g.n(Ln);for(v_=Ln.next();!v_.done;v_=Ln.next())if(v_=v_.value,v_.streamsProgress){v_=g.n(v_.streamsProgress);for(var Yv=v_.next();!Yv.done;Yv=
v_.next()){var tt=void 0;qk+=Number((tt=Yv.value.numBytesDownloaded)!=null?tt:0)}}pn.downloadedBytes=zu(qk);pn.selectedOfflineMode=a[c]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";uL.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(pn.offlinePlaybackDisabledReason=uL.offlinePlaybackDisabledReason);return pn});
return P.return({offlineVideos:A,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:r}}})})},Yis=function(){this.locks=navigator.locks},rxO=function(){try{var Q=g.D6("ytglobal.locks_");
if(Q)return Q;var z;if(z=navigator){var H=navigator;z="locks"in H&&!!H.locks}if(z)return g.iL.localStorage&&g.iL.localStorage.getItem("noop"),Q=new Yis,g.W_("ytglobal.locks_",Q),Q}catch(f){}},QF=function(){},s3s=function(){},BWs=function(Q){if(Q.includes(":"))throw Error("Invalid user cache name: "+Q);
return Q+":"+g.kQ("CacheStorage get")},PWL=function(){return g.B(function(Q){if(z1!==void 0)return Q.return(z1);
z1=new Promise(function(z){var H;return g.B(function(f){switch(f.Z){case 1:return g.$v(f,2),g.Y(f,Hv.open("test-only"),4);case 4:return g.Y(f,Hv.delete("test-only"),5);case 5:g.Fa(f,3);break;case 2:if(H=g.xv(f),H instanceof Error&&H.name==="SecurityError")return z(!1),f.return();case 3:z("caches"in window),g.Gu(f)}})});
return Q.return(z1)})},U2s=function(){return g.B(function(Q){if(Q.Z==1)return g.Y(Q,PWL(),2);
if(!Q.B)return Q.return(void 0);a5J||(a5J=new s3s);return Q.return(a5J)})},fM=function(Q,z,H){g.PT(new g.wD("Woffle: "+Q,H?{cotn:H}:""));
z instanceof Error&&g.PT(z)},cxm=function(Q){var z;
return g.B(function(H){if(H.Z==1)return g.Y(H,Ax5(Q),2);z=H.B;g.y5("offlineStateSnapshot",z);g.Gu(H)})},b9=function(Q){g.h.call(this);
var z=this;this.api=Q;this.Po={hsn:function(){return z.Z},
wQh:function(){return z.B}};
typeof g.iL.BroadcastChannel!=="undefined"&&(this.Z=new g.iL.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.kQ()),this.Z.onmessage=this.L.bind(this),this.B=new g.iL.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.kQ()),this.B.onmessage=this.D.bind(this))},LM=function(Q,z){Q.api.F$("onOfflineOperationFailure",z);
var H;(H=Q.Z)==null||H.postMessage(z)},ihu=function(Q,z,H,f){var b=this;
this.N=Q;this.U=z;this.visibility=H;this.V=f;this.S=this.Y=this.j=this.L=this.Z=!1;this.D=new g.e_(function(){b.eF()});
this.Po={Cu:function(){return b.B},
eF:function(){b.eF()},
aLq:function(){return b.D}};
this.visibility.subscribe("visibilitystatechange",function(){b.Ox()})},h_R=function(Q){if(!Q.L&&!Q.Z){var z=rxO();
if(z){Q.L=!0;var H=g.kQ("OfflineLockManager");z.request("woffle_orchestration_leader:"+H,{},function(){var f,b,L,u;return g.B(function(X){switch(X.Z){case 1:return g.$v(X,2),Q.B=new g.nW,Q.Z=!0,Q.L=!1,g.Y(X,Q.N(),4);case 4:return g.Y(X,Q.B.promise,5);case 5:g.Fa(X,0);break;case 2:f=g.xv(X),((L=(b=Q).V)==null?0:L.call(b,"wo_relinquish_leadership_on_lock_request_error"))||Q.eF(),f instanceof Error&&(u=f,u.args=[{name:"WoLockManagerError",jQ:f.name}],g.BT(u)),g.Gu(X)}})})}}},WEs=function(Q){Q.Z&&(Q.S=
!0,u9(Q))},D2u=function(Q,z){Q.Z&&(Q.j=z,u9(Q))},KEx=function(Q,z){Q.Z&&(Q.Y=z,u9(Q))},u9=function(Q){Q.Y&&Q.j&&Q.S&&Q.visibility.isBackground()?g.lp(Q.D,6E4):Q.D.stop()},Sg=function(Q){var z;
Q.offlineDeleteReason=(z=Q.offlineDeleteReason)!=null?z:"OFFLINE_DELETE_REASON_UNKNOWN";var H;Q.offlineModeType=(H=Q.offlineModeType)!=null?H:"OFFLINE_NOW";g.y5("offlineDeleteEvent",Q)},Xz=function(Q,z){var H=z.videoId;
var f=z.UG;z=z.offlineModeType;Q.encryptedVideoId=H;Q.cotn=f==null?void 0:f.cotn;Q.offlineabilityFormatType=f==null?void 0:f.maximumDownloadQuality;var b;Q.isRefresh=(b=f==null?void 0:f.isRefresh)!=null?b:!1;var L;Q.softErrorCount=(L=f==null?void 0:f.transferRetryCount)!=null?L:0;Q.offlineModeType=z!=null?z:"OFFLINE_NOW";(Q.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&Q.statusType==="UNKNOWN_STATUS_TYPE"||!Q.transferStatusType&&!Q.statusType)&&g.PT(Error("Woffle unknown transfer status"));
g.y5("offlineTransferStatusChanged",Q)},V$s=function(Q,z,H,f){f={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!f};z&&H&&(z=Math.floor(z/1024).toFixed(),H=Math.floor(H/1024).toFixed(),f.alreadyDownloadedKbytes=z,f.totalFetchedKbytes=z,f.totalContentKbytes=H);Xz(f,Q)},d2x=function(Q){Xz({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},Q)},m2s=function(Q){switch(Q){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
vv=function(Q){var z,H,f;
return((f=(z=Q.actionMetadata)==null?void 0:(H=z.retryScheduleIntervalsInSeconds)==null?void 0:H.length)!=null?f:0)>0},yF=function(Q){return Q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!Q.entityKey},qu=function(Q){return Q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!Q.entityKey},Mu=function(Q){return Q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!Q.entityKey},wrB=function(Q){return Q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!Q.entityKey},
CM=function(Q,z,H,f,b){b=b===void 0?!1:b;
var L,u,X,v,y,q;return g.B(function(M){if(M.Z==1)return L=g.ed(Q,z),u=g.ed(Q,"downloadStatusEntity"),g.Y(M,k0(H,{mode:"readonly",VE:!0},function(C){return g.xw.all([WF(C,L,z),WF(C,u,"downloadStatusEntity")])}),2);
X=M.B;v=X.length?X[0]:void 0;if(!v)return M.bT(0);y=kJs;if(q=X.length>1?X[1]:void 0){if(q.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!b)return M.return();q.downloadState=f}else q={key:u,downloadState:f};g.hl(v,y,q);return g.Y(M,k0(H,{mode:"readwrite",VE:!0},function(C){return g.xw.all([Vl(C,v,z),Vl(C,q,"downloadStatusEntity")])}),0)})},t3=function(Q,z){return Q.actionType===z.actionType&&Q.entityKey===z.entityKey},EI=function(Q,z){if(Q&&Q.transferState!=="TRANSFER_STATE_COMPLETE"&&Q.transferState!==
"TRANSFER_STATE_FAILED"){var H=g.Tp(Q.key).entityId;
Xz({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:H,UG:Q,offlineModeType:z})}},pM=function(Q){if(!Q||!Q.thumbnails)return[];
var z=[];Q=g.n(Q.thumbnails);for(var H=Q.next();!H.done;H=Q.next())H=H.value,H.url&&z.push(H.url);return z},TWO=function(Q,z,H){H=H===void 0?[]:H;
var f,b,L,u,X,v,y,q,M,C,t,E,G;return g.B(function(x){if(x.Z==1)return H.length?g.Y(x,lX(Q,z),2):x.return([]);f=x.B;b=new Set;L=g.n(f);for(u=L.next();!u.done;u=L.next())if(X=u.value,v=X.id||X.key)y=g.Tp(v).entityId,b.add(y);q=[];M=g.n(H);for(C=M.next();!C.done;C=M.next())t=C.value,E=t.offlineVideoData,G=void 0,((G=E)==null?0:G.videoId)&&!b.has(E.videoId)&&q.push(t);return x.return(q)})},e_T=function(Q,z,H){return new g.D1(Q,{cotn:z,
raw_player_response:H,download_media:!0,start:Infinity,disable_watch_next:!0})},l55=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},nM=function(Q,z,H,f,b,L,u,X,v,y,q){this.entityType=Q;
this.actionId=z;this.action=H;this.parentActionId=f;this.rootActionId=b===void 0?z:b;this.childActionIds=L;this.prereqActionId=u;this.postreqActionIds=X;this.hasChildActionFailed=y;this.retryScheduleIndex=0;this.Z=q||Date.now();this.retryScheduleIndex=v||0},gK=function(Q){if(!Q.key)throw Error("Entity key is required.");
if(!Q.actionProto)throw Error("OfflineOrchestrationAction is required.");var z=g.Tp(Q.key),H=g.Tp(Q.actionProto.entityKey);return new nM(H.entityType,z.entityId,Q.actionProto,Q.parentActionId,Q.rootActionId,Q.childActionIds,Q.prereqActionId,Q.postreqActionIds,Q.retryScheduleIndex,Q.hasChildActionFailed,Number(Q.enqueueTimeSec)*1E3)},Ze=function(Q){return{key:g.ed(Q.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:Q.action,parentActionId:Q.parentActionId,rootActionId:Q.rootActionId,childActionIds:Q.childActionIds,prereqActionId:Q.prereqActionId,postreqActionIds:Q.postreqActionIds,retryScheduleIndex:Q.retryScheduleIndex,hasChildActionFailed:Q.hasChildActionFailed,enqueueTimeSec:(Q.Z/1E3).toFixed()}},R_m=function(){var Q;
return g.B(function(z){return z.Z==1?g.Y(z,U2s(),2):(Q=z.B)?z.return(Q.delete("yt-player-local-img")):z.return(!0)})},G1=function(Q){var z,H;
return g.B(function(f){if(f.Z==1)return g.Y(f,U2s(),2);if(f.Z!=3){z=f.B;if(!z)throw Error("Cache API not supported");return Q.length?g.Y(f,z.open("yt-player-local-img"),3):f.return()}H=f.B;return g.Y(f,Promise.all(Q.map(function(b){return H.delete(b)})),0)})},$4=function(Q){var z,H;
return g.B(function(f){if(f.Z==1)return g.Y(f,U2s(),2);if(f.Z!=3){z=f.B;if(!z)throw Error("Cache API not supported");return Q.length?g.Y(f,z.open("yt-player-local-img"),3):f.return()}H=f.B;return g.Y(f,H.addAll(Q),0)})},jg=function(Q,z,H,f,b){var L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R,Z,d,h8,$O,Cs,J8,eY;
return g.B(function(Ls){switch(Ls.Z){case 1:return L=g.ed(Q,"mainVideoEntity"),u=g.ed(Q,"ytMainChannelEntity"),X=g.ed(Q,"transfer"),v=g.ed(Q,"videoDownloadContextEntity"),g.Y(Ls,k0(z,{mode:"readonly",VE:!0},function(ps){return g.xw.all([WF(ps,L,"mainVideoEntity"),WF(ps,u,"ytMainChannelEntity"),WF(ps,X,"transfer"),WF(ps,v,"videoDownloadContextEntity"),D9(ps,"ytMainChannelEntity"),D9(ps,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:y=Ls.B;q=g.n(y);M=q.next().value;C=q.next().value;t=q.next().value;E=q.next().value;G=q.next().value;x=q.next().value;J=M;I=C;r=t;U=E;D=G;T=x;if(!J&&!I){Ls.bT(3);break}k=J?pM(J.thumbnail):[];if(!I){bL=[];Ls.bT(4);break}return g.Y(Ls,QLt(I,D),5);case 5:bL=Ls.B;case 4:return SY=bL,g.Y(Ls,G1(k.concat(SY)),3);case 3:Q9=[];V=g.ed(Q,"downloadStatusEntity");R=g.n(T);for(Z=R.next();!Z.done;Z=R.next())d=Z.value,h8=g.Tp(d.key).entityId,$O=gK(d),Cs=g.Tp($O.action.entityKey).entityId,h8!==Q&&Cs!==Q||t3(H,
d.actionProto)||Q9.push(d.key);return g.Y(Ls,k0(z,{mode:"readwrite",VE:!0},function(ps){var O=Q9.map(function(N){return dF(ps,N)});
O.push(dF(ps,L,{fW:!0}));O.push(dF(ps,V,{fW:!0}));return g.xw.all(O)}),7);
case 7:eY=(J8=U)==null?void 0:J8.offlineModeType,b&&(Sg(b),b.offlineModeType&&(eY=b.offlineModeType)),EI(r,eY),LM(f,{entityKey:L,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Gu(Ls)}})},fPm=function(Q,z,H,f){var b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R,Z,d,h8,$O,Cs,J8,eY,Ls,ps,O,N,A,P,c,zu,Ln,uL,a,qk,pn,v_,Yv,tt,cu,Cr;
return g.B(function(V9){switch(V9.Z){case 1:return b=g.ed(Q,"mainPlaylistEntity"),L=g.ed(Q,"ytMainChannelEntity"),g.Y(V9,k0(z,{mode:"readonly",VE:!0},function(hC){return g.xw.all([WF(hC,b,"mainPlaylistEntity"),WF(hC,L,"ytMainChannelEntity"),D9(hC,"mainPlaylistEntity"),D9(hC,"mainDownloadsListEntity"),D9(hC,"ytMainChannelEntity"),D9(hC,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:u=V9.B;X=g.n(u);v=X.next().value;y=X.next().value;q=X.next().value;M=X.next().value;C=X.next().value;t=X.next().value;E=v;G=y;x=q;J=M;I=C;r=t;if(!E&&!G){V9.bT(3);break}U=E?zuR(E):[];if(!G){D=[];V9.bT(4);break}return g.Y(V9,QLt(G,I),5);case 5:D=V9.B;case 4:return T=D,g.Y(V9,G1(U.concat(T)),3);case 3:k=[];bL=new Map;if(!E){V9.bT(7);break}return g.Y(V9,H8J(E,x,J),8);case 8:k=V9.B;SY=g.n(k);for(Q9=SY.next();!Q9.done;Q9=SY.next())V=Q9.value,bL.set(V,{videoId:V,playlistId:Q,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.Y(V9,k0(z,{mode:"readonly",VE:!0},function(hC){return g.xw.all([D9(hC,"transfer"),D9(hC,"videoDownloadContextEntity")])}),9);
case 9:R=V9.B;Z=g.n(R);d=Z.next().value;h8=Z.next().value;$O=d;Cs=h8;J8=g.n($O);for(eY=J8.next();!eY.done;eY=J8.next())Ls=eY.value,ps=g.Tp(Ls.key).entityId,(O=bL.get(ps))&&Ls&&(O.cotn=Ls.cotn);N=g.n(Cs);for(A=N.next();!A.done;A=N.next())P=A.value,c=g.Tp(P.key).entityId,(zu=bL.get(c))&&P&&(zu.offlineModeType=P.offlineModeType);case 7:Ln=[];uL=g.n(r);for(a=uL.next();!a.done;a=uL.next())qk=a.value,pn=g.Tp(qk.key).entityId,v_=gK(qk),pn!==Q&&v_.rootActionId!==Q||t3(H,qk.actionProto)||Ln.push(qk.key);Yv=
g.ed(Q,"mainPlaylistEntity");return g.Y(V9,k0(z,{mode:"readwrite",VE:!0},function(hC){var vq=Ln.map(function(s7){return dF(hC,s7)});
vq.push(dF(hC,Yv,{fW:!0}));return g.xw.all(vq)}),10);
case 10:if(!E){V9.bT(0);break}k.reverse();if(!k){V9.bT(0);break}tt=g.n(k);cu=tt.next();case 13:if(cu.done){V9.bT(0);break}Cr=cu.value;return g.Y(V9,jg(Cr,z,H,f,bL.get(Cr)),14);case 14:cu=tt.next(),V9.bT(13)}})},L4u=function(Q,z,H,f){var b,L,u,X,v,y,q,M,C;
return g.B(function(t){if(t.Z==1)return b=g.ed("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),L=new Map,g.Y(t,k0(Q,{mode:"readwrite",VE:!0},function(E){var G=D9(E,"transfer"),x=D9(E,"offlineOrchestrationActionWrapperEntity"),J=D9(E,"videoDownloadContextEntity"),I=WF(E,b,"mainDownloadsListEntity");return g.xw.all([G,x,J,I]).then(function(r){r=g.n(r);var U=r.next().value;var D=r.next().value;var T=r.next().value;var k=r.next().value;r=b8Y.map(function(SY){return z_s(E,SY)});
D=g.n(D);for(var bL=D.next();!bL.done;bL=D.next())bL=bL.value,t3(z,bL.actionProto)||r.push(dF(E,bL.key,{fW:!0}));k&&(k.downloads=[],r.push(Vl(E,k,"mainDownloadsListEntity")));if(T)for(T=g.n(T),k=T.next();!k.done;k=T.next())k=k.value,D=g.Tp(k.key).entityId,D=g.ed(D,"transfer"),L.set(D,k.offlineModeType);return g.xw.all(r).then(function(){return U})})}),2);
u=t.B;X=g.n(u);for(v=X.next();!v.done;v=X.next())y=v.value,EI(y,L.get(y.key)),q=g.Tp(y.key).entityId,M={videoId:q,offlineDeleteReason:f,cotn:y.cotn,offlineModeType:L.get(y.key)},Sg(M),C=g.ed(q,"mainVideoEntity"),LM(H,{entityKey:C,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.Y(t,R_m(),0)})},zuR=function(Q,z){var H=[];
if(Q.thumbnailStyleData){Q=g.n(Q.thumbnailStyleData);for(var f=Q.next();!f.done;f=Q.next()){var b=void 0,L=void 0,u=void 0;H=H.concat(pM((b=f.value)==null?void 0:(L=b.value)==null?void 0:(u=L.collageThumbnail)==null?void 0:u.coverThumbnail))}}z=pM(z);return H.concat(z)},H8J=function(Q,z,H){var f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY;
return g.B(function(Q9){f=[];b=new Set;if(H.length)for(L=g.n(H),u=L.next();!u.done;u=L.next())if(X=u.value,v=void 0,(v=X.downloads)==null?0:v.length)for(y=g.n(X.downloads),q=y.next();!q.done;q=y.next())M=q.value,M.videoItem&&(C=g.Tp(M.videoItem).entityId,b.add(C));if(Q.videos){t=g.n(Q.videos);for(E=t.next();!E.done;E=t.next())G=E.value,x=JSON.parse(g.Tp(G).entityId),x.videoId&&!b.has(x.videoId)&&f.push(x.videoId);J=g.n(z);for(I=J.next();!I.done;I=J.next())if(r=I.value,r.key!==Q.key&&(U=r.videos))for(D=
g.n(U),T=D.next();!T.done;T=D.next())k=T.value,bL=JSON.parse(g.Tp(k).entityId),bL.videoId&&(SY=f.indexOf(bL.videoId),SY!==-1&&f.splice(SY,1))}return Q9.return(f)})},QLt=function(Q,z){var H,f,b,L,u,X,v,y;
return g.B(function(q){H=pM(Q.avatar);f=g.n(z);for(b=f.next();!b.done;b=f.next())if(L=b.value,L.id!==Q.id)for(u=g.n(pM(L.avatar)),X=u.next();!X.done;X=u.next())v=X.value,y=H.indexOf(v),y!==-1&&H.splice(y,1);return q.return(H)})},uqs=function(Q){var z;
return g.B(function(H){z=g.K(Q.frameworkUpdates,Fz);return Q.frameworkUpdates&&z?g.Y(H,t$Y(z),0):H.return()})},XkY=function(Q){var z;
if((z=Q.onResponseReceivedActions)!=null&&z.length){var H;Q=(H=g.K(g.K(Q.onResponseReceivedActions[0],S65),g.oTs))==null?void 0:H.actions;if(Q!=null&&Q.length)return Q}},vBO=function(Q){var z,H,f;
return g.B(function(b){if(b.Z==1)return Q?g.Y(b,eC(Q,g.Bl,"mainDownloadsListEntity"),2):b.return([]);z=b.B;return((H=z)==null?0:(f=H.downloads)==null?0:f.length)?b.return(z.downloads.map(function(L){var u;return(u=L.videoItem)!=null?u:""})):b.return([])})},q6R=function(Q,z){var H;
return g.B(function(f){return f.Z==1?g.Y(f,yPs(Q,z),2):(H=f.B)?g.Y(f,k0(Q,{mode:"readwrite",VE:!0},function(b){var L=[Vl(b,H.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];H.mainDownloadsListEntity&&L.push(Vl(b,H.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.xw.all(L)}),0):f.bT(0)})},yPs=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r;
return g.B(function(U){if(U.Z==1)return H=g.ed("main_downloads_library_id","mainDownloadsLibraryEntity"),f=g.ed("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.Y(U,k0(Q,{mode:"readonly",VE:!0},function(D){return g.xw.all([WF(D,H,"mainDownloadsLibraryEntity"),WF(D,f,"mainDownloadsListEntity")])}),2);
b=U.B;L=g.n(b);u=L.next().value;X=L.next().value;v=u;y=X;v||(v={id:H});q=g.n(z);for(M=q.next();!M.done;M=q.next())if(C=M.value,C===g.Bl){if(v.smartDownloadsList)return U.return();v.smartDownloadsList=C}else if(t=g.Tp(C).entityType,E={},t==="mainPlaylistEntity"?E.playlistItem=C:t==="mainVideoEntity"&&(E.videoItem=C),!g.Ys(E)){G=void 0;if((G=y)==null?0:G.downloads){x=!1;J=g.n(y.downloads);for(I=J.next();!I.done;I=J.next())if(r=I.value,r.playlistItem===C||r.videoItem===C){x=!0;break}x||y.downloads.push(E)}else y=
{id:f,downloads:[E]};v.downloadsList=f}return U.return({mainDownloadsLibraryEntity:v,mainDownloadsListEntity:y})})},M0L=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x;
return g.B(function(J){if(J.Z==1)return H=g.ed("main_downloads_library_id","mainDownloadsLibraryEntity"),f=g.ed("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.Y(J,k0(Q,{mode:"readonly",VE:!0},function(I){return g.xw.all([WF(I,H,"mainDownloadsLibraryEntity"),WF(I,f,"mainDownloadsListEntity"),WF(I,g.Bl,"mainDownloadsListEntity")])}),2);
b=J.B;L=g.n(b);u=L.next().value;X=L.next().value;v=L.next().value;y=u;q=X;M=v;if(!y)return J.bT(0);if(z===g.Bl&&((C=M)==null?0:C.downloads))M.downloads=[];else if((t=q)==null?0:t.downloads)for(E=g.Tp(z).entityType,G=0;G<q.downloads.length;G++)if(x=q.downloads[G],E==="mainVideoEntity"&&x.videoItem===z){q.downloads.splice(G,1);break}else if(E==="mainPlaylistEntity"&&x.playlistItem===z){q.downloads.splice(G,1);break}return g.Y(J,k0(Q,{mode:"readwrite",VE:!0},function(I){var r=[Vl(I,y,"mainDownloadsLibraryEntity")];
q&&r.push(Vl(I,q,"mainDownloadsListEntity"));M&&r.push(Vl(I,M,"mainDownloadsListEntity"));return g.xw.all(r)}),0)})},x4=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C;
return g.B(function(t){if(t.Z==1)return H=g.ed(z,"transfer"),f=g.ed(z,"videoDownloadContextEntity"),g.Y(t,k0(Q,{mode:"readonly",VE:!0},function(E){return g.xw.all([WF(E,H,"transfer"),WF(E,f,"videoDownloadContextEntity")])}),2);
b=t.B;L=g.n(b);u=L.next().value;X=L.next().value;v=u;y=X;C={videoId:z,cotn:(q=v)==null?void 0:q.cotn,offlineModeType:(M=y)==null?void 0:M.offlineModeType};return t.return(C)})},OI=function(Q,z,H,f,b){var L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL;
return g.B(function(SY){switch(SY.Z){case 1:return L=g.ed(Q,"musicTrack"),u=g.ed(Q,"transfer"),g.Y(SY,k0(z,{mode:"readonly",VE:!0},function(Q9){return g.xw.all([WF(Q9,L,"musicTrack"),WF(Q9,u,"transfer"),D9(Q9,"musicTrack"),D9(Q9,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=SY.B;v=g.n(X);y=v.next().value;q=v.next().value;M=v.next().value;C=v.next().value;t=y;E=q;G=M;x=C;if(!t){SY.bT(3);break}return g.Y(SY,C2L(t,G),4);case 4:return J=SY.B,g.Y(SY,G1(J),3);case 3:I=[];r=g.n(x);for(U=r.next();!U.done;U=r.next())D=U.value,T=g.Tp(D.key).entityId,k=gK(D),bL=g.Tp(k.action.entityKey).entityId,T!==Q&&bL!==Q||t3(H,D.actionProto)||I.push(D.key);return g.Y(SY,k0(z,{mode:"readwrite",VE:!0},function(Q9){var V=I.map(function(R){return dF(Q9,R)});
V.push(dF(Q9,L,{fW:!0}));return g.xw.all(V)}),6);
case 6:EI(E),b&&Sg(b),LM(f,{entityKey:L,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Gu(SY)}})},op=function(Q,z,H,f,b){var L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R,Z,d,h8,$O,Cs,J8,eY,Ls,ps,O,N,A;
return g.B(function(P){switch(P.Z){case 1:return L=g.ed(Q,z),u=g.ed("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Y(P,k0(H,{mode:"readonly",VE:!0},function(c){return g.xw.all([WF(c,L,z),WF(c,u,"musicDownloadsLibraryEntity"),D9(c,z),D9(c,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=P.B;v=g.n(X);y=v.next().value;q=v.next().value;M=v.next().value;C=v.next().value;t=y;E=q;G=M;x=C;if(!t){P.bT(3);break}return g.Y(P,C2L(t,G),4);case 4:return J=P.B,g.Y(P,G1(J),3);case 3:I=[];r=new Map;if(!t){P.bT(6);break}return g.Y(P,t0B(t,G,E),7);case 7:I=P.B;U=g.n(I);for(D=U.next();!D.done;D=U.next())T=D.value,k=g.Tp(T).entityId,r.set(k,{videoId:k,playlistId:Q,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.Y(P,lX(H,"transfer"),8);case 8:for(bL=P.B,SY=g.n(bL),
Q9=SY.next();!Q9.done;Q9=SY.next())V=Q9.value,R=g.Tp(V.key).entityId,(Z=r.get(R))&&V&&(Z.cotn=V.cotn);case 6:d=[];h8=g.n(x);for($O=h8.next();!$O.done;$O=h8.next())Cs=$O.value,J8=g.Tp(Cs.key).entityId,eY=gK(Cs),J8!==Q&&eY.rootActionId!==Q||t3(f,Cs.actionProto)||d.push(Cs.key);Ls=g.ed(Q,z);return g.Y(P,k0(H,{mode:"readwrite",VE:!0},function(c){var zu=d.map(function(Ln){return dF(c,Ln)});
zu.push(dF(c,Ls,{fW:!0}));return g.xw.all(zu)}),9);
case 9:if(!t){P.bT(0);break}I.reverse();if(!I.length){P.bT(0);break}ps=g.n(I);O=ps.next();case 12:if(O.done){P.bT(0);break}N=O.value;A=g.Tp(N).entityId;if(!A){P.bT(13);break}return g.Y(P,OI(A,H,f,b,r.get(A)),13);case 13:O=ps.next(),P.bT(12)}})},J3=function(Q,z,H){var f,b,L,u,X,v,y;
return g.B(function(q){if(q.Z==1)return g.Y(q,k0(Q,{mode:"readwrite",VE:!0},function(M){var C=D9(M,"transfer"),t=D9(M,"offlineOrchestrationActionWrapperEntity");return g.xw.all([C,t]).then(function(E){E=g.n(E);var G=E.next().value;var x=E.next().value;E=EBu.map(function(U){return z_s(M,U)});
x=g.n(x);for(var J=x.next();!J.done;J=x.next()){J=J.value;var I=g.Tp(J.actionProto.entityKey).entityType==="musicTrack",r=J.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";t3(z,J.actionProto)||I&&(!I||r)||E.push(dF(M,J.key,{fW:!0}))}return g.xw.all(E).then(function(){return G})})}),2);
f=q.B;b=g.n(f);for(L=b.next();!L.done;L=b.next())u=L.value,EI(u),X=g.Tp(u.key).entityId,v={videoId:X,offlineDeleteReason:void 0,cotn:u.cotn},Sg(v),y=g.ed(X,"musicTrack"),LM(H,{entityKey:y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.Y(q,R_m(),0)})},pkx=function(Q){for(var z,H=g.n(Q.additionalMetadatas),f=H.next();!f.done;f=H.next())f=f.value,f.offlineMusicVideoData&&(z=f.offlineMusicVideoData);
var b,L,u,X,v;return{id:g.ed(Q.videoId,"musicTrack"),videoId:Q.videoId,title:Q.title,thumbnailDetails:Q.thumbnail,lengthMs:String(Number(Q.lengthSeconds)*1E3),albumTitle:(b=z)==null?void 0:b.releaseTitle,musicVideoType:(L=z)==null?void 0:L.musicVideoType,contentRating:{explicitType:(u=z)==null?void 0:u.explicitType},artistNames:((X=z)==null?void 0:X.byline)||((v=z)==null?void 0:v.channelName),downloadMetadata:g.ed(Q.videoId,"musicTrackDownloadMetadataEntity")}},t0B=function(Q,z,H){var f,b,L,u,X,v,
y,q,M,C,t,E,G,x,J,I,r,U;
return g.B(function(D){f=[];b=new Set;if((L=H)==null?0:(u=L.downloadedTracks)==null?0:u.length)for(X=g.n(H.downloadedTracks),v=X.next();!v.done;v=X.next())y=v.value,b.add(y);if(Q.tracks){q=g.n(Q.tracks);for(M=q.next();!M.done;M=q.next())C=M.value,b.has(C)||f.push(C);t=g.n(z);for(E=t.next();!E.done;E=t.next())if(G=E.value,G.id!==Q.id&&(x=G.tracks))for(J=g.n(x),I=J.next();!I.done;I=J.next())r=I.value,U=f.indexOf(r),U!==-1&&f.splice(U,1)}return D.return(f)})},C2L=function(Q,z){var H,f,b,L,u,X,v,y;
return g.B(function(q){H=pM(Q.thumbnailDetails);f=g.n(z);for(b=f.next();!b.done;b=f.next())if(L=b.value,L.id!==Q.id)for(u=g.n(pM(L.thumbnailDetails)),X=u.next();!X.done;X=u.next())v=X.value,y=H.indexOf(v),y!==-1&&H.splice(y,1);return q.return(H)})},nBu=function(Q,z){var H,f,b,L,u,X,v,y,q;
return g.B(function(M){if(M.Z==1)return H=g.ed("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Y(M,eC(Q,H,"musicDownloadsLibraryEntity"),2);(f=M.B)||(f={id:H});b=g.Tp(z).entityType;b==="musicTrack"?(L=f.downloadedTracks)!=null&&L.includes(z)||(f.downloadedTracks=((u=f.downloadedTracks)!=null?u:[]).concat(z)):b==="musicPlaylist"?(X=f.downloadedPlaylists)!=null&&X.includes(z)||(f.downloadedPlaylists=((v=f.downloadedPlaylists)!=null?v:[]).concat(z)):b!=="musicAlbumRelease"||(y=f.downloadedAlbumReleases)!=
null&&y.includes(z)||(f.downloadedAlbumReleases=((q=f.downloadedAlbumReleases)!=null?q:[]).concat(z));return g.Y(M,Tk(Q,f,"musicDownloadsLibraryEntity"),0)})},gBJ=function(Q,z){var H,f,b,L,u,X,v;
return g.B(function(y){if(y.Z==1)return H=g.ed("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Y(y,eC(Q,H,"musicDownloadsLibraryEntity"),2);f=y.B;if(!f)return y.bT(0);b=g.Tp(z).entityType;b==="musicTrack"?L=f.downloadedTracks:b==="musicPlaylist"&&(L=f.downloadedPlaylists);if((u=L)==null?0:u.length)for(X=0;X<L.length;X++)if(v=L[X],v===z){L.splice(X,1);break}return g.Y(y,Tk(Q,f,"musicDownloadsLibraryEntity"),0)})},Z8L=function(Q){var z=Q.videos;
Q=[];var H=[];if(z){z=g.n(z);for(var f=z.next();!f.done;f=z.next()){var b=f.value.offlineVideoData.videoId;f=g.ed(b,"musicTrack");b=g.ed(b,"musicTrackDownloadMetadataEntity");Q.push(f);H.push(b)}}return{bM:Q,Dc:H}},Nu=function(Q,z,H){z={track:pkx(z)};
H&&(z.playlistId=H);if(Q=g.K(Q.actionMetadata,GNx))z.maximumDownloadQuality=Q.maximumDownloadQuality;return{musicTrackEntityActionMetadata:z}},jLs=function(Q){var z,H,f,b,L,u,X,v;
return g.B(function(y){switch(y.Z){case 1:return z=g.L4(),H=j3J(Q),f=g.Qv($3R),g.$v(y,2),L={tK:!0},g.Y(y,g.kx(z,H,f,void 0,L),4);case 4:b=y.B;g.Fa(y,3);break;case 2:u=g.xv(y);if(u instanceof g.dE)throw X="GetOffline network manager error: "+u.message,fM(X,u),Error(X);fM("GetOffline fetch request error",u);throw Error("GetOffline fetch request error");case 3:v=Ip(b);if(!b)throw fM("Network request failed"),Error("Network request failed");if(v!==void 0)A3(v);else if(!b.videos||!b.videos.length)throw fM("No data"),
Error("No data");return y.return(b.videos.map(function(q){return q.offlineVideoData}))}})},F4Y=function(Q){var z,H,f,b,L,u,X,v;
return g.B(function(y){switch(y.Z){case 1:return z=g.L4(),H=FEu(Q),f=g.Qv($3R),g.$v(y,2),L={tK:!0},g.Y(y,g.kx(z,H,f,void 0,L),4);case 4:b=y.B;g.Fa(y,3);break;case 2:u=g.xv(y);if(u instanceof g.dE)throw X="GetOffline network manager error for playlist: "+u.message,fM(X,u),Error(X);fM("GetOffline fetch request error for playlist",u);throw Error("GetOffline fetch request error for playlist");case 3:v=Ip(b);if(!b)throw fM("Network request failed for playlist"),Error("Network request failed for playlist");
if(v!==void 0)A3(v,"playlist");else if(!b.playlists||!b.playlists.length)throw fM("No data for playlist"),Error("No data for playlist");return y.return(b.playlists.map(function(q){return q.offlinePlaylistData}))}})},O8m=function(Q,z,H,f){var b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R,Z,d,h8,$O,Cs;
return g.B(function(J8){switch(J8.Z){case 1:return g.Y(J8,RN(),2);case 2:b=J8.B;if(!b)return J8.return([]);L=[];if((u=f)==null?0:u.length){L=f;J8.bT(3);break}return g.Y(J8,lX(b,"mainPlaylistEntity"),4);case 4:L=J8.B;case 3:if(!L.length)return J8.return([]);X=[];v=Date.now()/1E3;y=g.n(L);q=y.next();case 5:if(q.done)return X.length?g.Y(J8,x3Y(X),10):J8.return([]);M=q.value;if(!M.downloadState){C=void 0;J8.bT(8);break}return g.Y(J8,eC(b,M.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:C=
J8.B;case 8:t=C;E=void 0;x=(G=(E=M)==null?void 0:E.entityMetadata)&&G.nextAutoRefreshIntervalSeconds?Number(G.nextAutoRefreshIntervalSeconds):NaN;J=Number.isNaN(x)?Q:x;r=I=void 0;U=((I=t)==null?0:I.lastSyncedTimestampMillis)?Number((r=t)==null?void 0:r.lastSyncedTimestampMillis)/1E3:0;T=D=void 0;k=((D=t)==null?0:D.addedTimestampMillis)?Number((T=t)==null?void 0:T.addedTimestampMillis)/1E3:0;if(H||!G||U+J<=v){bL=[];SY=void 0;if((SY=M.videos)==null?0:SY.length)for(Q9=g.n(M.videos),V=Q9.next();!V.done;V=
Q9.next())R=V.value,Z=JSON.parse(g.Tp(R).entityId),Z.videoId&&bL.push(Z.videoId);d="0";G&&(h8=void 0,d=String(Number((h8=G.offlineLastModifiedTimestampSeconds)!=null?h8:0).toFixed()));$O={playlistId:M.playlistId,videoIds:bL,offlineLastModifiedTimestamp:d,autoSync:z,offlineDateAddedTimestamp:String(k.toFixed())};X.push($O)}q=y.next();J8.bT(5);break;case 10:return Cs=J8.B,J8.return(Cs)}})},oBJ=function(){var Q,z,H,f,b;
return g.B(function(L){if(L.Z==1)return g.Y(L,RN(),2);if(L.Z!=3)return(Q=L.B)?g.Y(L,lX(Q,"refresh"),3):L.return(!1);z=L.B;if((H=z[0])==null||!H.refreshTime)return L.return(!1);f=Number(z[0].refreshTime);b=Date.now()/1E3;return L.return(isFinite(f)&&b>=f)})},NdB=function(Q,z){var H,f,b;
return g.B(function(L){switch(L.Z){case 1:return g.$v(L,2),g.Y(L,JPm(Q,z),4);case 4:return f=L.B,g.Y(L,uqs(f),5);case 5:H=XkY(f);g.Fa(L,3);break;case 2:b=g.xv(L),fM("getAndProcessSmartDownloadsResponse request or processing error",b);case 3:return L.return(H)}})},IPO=function(Q,z,H,f){var b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R,Z,d,h8,$O,Cs;
return g.B(function(J8){switch(J8.Z){case 1:return g.Y(J8,RN(),2);case 2:b=J8.B;if(!b)return J8.return([]);L=[];if((u=f)==null?0:u.length){L=f;J8.bT(3);break}return g.Y(J8,lX(b,"musicPlaylist"),4);case 4:L=J8.B;case 3:if(!L.length)return J8.return([]);X=[];v=Date.now()/1E3;y=g.n(L);q=y.next();case 5:if(q.done)return X.length?g.Y(J8,x3Y(X),10):J8.return([]);M=q.value;C=void 0;E=(t=(C=M)==null?void 0:C.entityMetadata)&&t.nextAutoRefreshIntervalSeconds?Number(t.nextAutoRefreshIntervalSeconds):NaN;G=
Number.isNaN(E)?Q:E;J=x=0;I="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!M.downloadMetadata){J8.bT(8);break}return g.Y(J8,eC(b,M.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:r=J8.B,D=U=void 0,x=Number((D=(U=r)==null?void 0:U.addedTimestampMillis)!=null?D:"0")/1E3,k=T=void 0,J=Number((k=(T=r)==null?void 0:T.lastModifiedTimestampMillis)!=null?k:"0")/1E3,SY=bL=void 0,I=(SY=(bL=r)==null?void 0:bL.syncState)!=null?SY:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Q9=void 0;if(H||I!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!t||Number((Q9=t.lastSyncedTimestampSeconds)!=null?Q9:0)+G<=v){V=[];R=void 0;if((R=M.tracks)==null?0:R.length)for(Z=g.n(M.tracks),d=Z.next();!d.done;d=Z.next())h8=d.value,V.push(g.Tp(h8).entityId);$O={playlistId:M.playlistId,videoIds:V,offlineLastModifiedTimestamp:String(J.toFixed()),autoSync:z,offlineDateAddedTimestamp:String(x.toFixed())};X.push($O)}q=y.next();J8.bT(5);break;case 10:return Cs=J8.B,J8.return(Cs)}})},JPm=function(Q,z){var H,f,b,L,u,X,v,y,q,M;
return g.B(function(C){switch(C.Z){case 1:return H=g.L4(),g.Y(C,RN(),2);case 2:f=C.B;if(!f){C.bT(3);break}return g.Y(C,Ax5(f),4);case 4:b=C.B;case 3:var t=b;L={context:g.eh(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:Q},offlineClientState:t,clientStateRequestData:{preferredFormatType:z}}}};u=g.Qv(APO);g.$v(C,5);v={tK:!0};return g.Y(C,g.kx(H,L,u,void 0,v),7);case 7:X=C.B;g.Fa(C,6);break;case 5:y=g.xv(C);if(y instanceof g.dE)throw q=
"DPS network manager error for smart downloads: "+y.message,fM(q,y),Error(q);fM("DPS fetch request error for smart downloads",y);throw Error("DPS fetch request error for smart downloads");case 6:M=Ip(X);if(X)M!==void 0&&A3(M,"smart downloads");else throw fM("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return C.return(X)}})},rPx=function(Q,z){var H,f,b,L,u,X,v,y;
return g.B(function(q){switch(q.Z){case 1:return H=g.L4(),f={context:g.eh(),videoPlaybackPositionEntities:Q,lastSyncTimestampUsec:z},b=g.Qv(Y6O),g.$v(q,2),u={tK:!0},g.Y(q,g.kx(H,f,b,void 0,u),4);case 4:L=q.B;g.Fa(q,3);break;case 2:X=g.xv(q);if(X instanceof g.dE)throw v="VPPS network manager error: "+X.message,fM(v,X),Error(v);fM("VPPS fetch request error",X);throw Error("VPPS fetch request error");case 3:y=Ip(L);if(L)y!==void 0&&A3(y,"position sync");else throw fM("Network request failed for position sync"),
Error("Network request failed for position sync");return q.return(L)}})},Bds=function(Q,z,H){var f,b,L,u,X,v,y,q;
return g.B(function(M){switch(M.Z){case 1:f=g.L4();var C=H.refreshData,t=H.isEnqueuedForExpiredStreamUrlRefetch,E=H.tD,G=H.offlineSourceData,x=H.mediaCapabilities,J={entityKey:Q};C&&(J.refreshData=C);t&&(J.isExpiredStreamUrlRefetch=t);E&&(J.downloadParameters=E);G&&(J.offlineSourceData=G);C={context:g.bj(z),signatureTimestamp:20153,videos:[J]};x&&(C.mediaCapabilities=x);b=C;L=g.Qv(sLY);g.$v(M,2);X={tK:!0};return g.Y(M,g.kx(f,b,L,void 0,X),4);case 4:u=M.B;g.Fa(M,3);break;case 2:v=g.xv(M);if(v instanceof
g.dE)throw y="GetPDE network manager error: "+v.message,fM(y,v),Error(y);fM("GetPDE fetch request error",v);throw Error("GetPDE fetch request error");case 3:q=Ip(u);if(u)q!==void 0&&A3(q,"PDE");else throw fM("Network request failed for PDE"),Error("Network request failed for PDE");return M.return(u)}})},Ip=function(Q){var z;
return(z=Q.errorMetadata)==null?void 0:z.status},A3=function(Q,z){z=z?" for "+z:"";
if(Q===0)throw Q="Empty response body"+z,fM(Q),Error(Q);Q="Response with error"+z;fM(Q);throw Error(Q);},x3Y=function(Q){var z,H,f,b,L,u,X,v;
return g.B(function(y){switch(y.Z){case 1:return z=g.L4(),H=x2T(Q),f=g.Qv(P2s),g.$v(y,2),L={tK:!0},g.Y(y,g.kx(z,H,f,void 0,L),4);case 4:b=y.B;g.Fa(y,3);break;case 2:u=g.xv(y);if(u instanceof g.dE)throw X="offlinePlaylistSyncCheck network manager error: "+u.message,fM(X,u),Error(X);fM("offlinePlaylistSyncCheck fetch request error",u);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:v=Ip(b);if(!b)throw fM("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(v!==void 0)A3(v,"playlist sync");else if(!b.offlinePlaylistSyncCheckDatas||!b.offlinePlaylistSyncCheckDatas.length)throw fM("No data for playlist sync"),Error("No data for playlist sync");return y.return(b.offlinePlaylistSyncCheckDatas.map(function(q){return q.offlinePlaylistSyncCheckData}))}})},Y4=function(Q){this.Z=Q},aPt=function(Q,z){var H,f,b,L,u,X;
return g.B(function(v){switch(v.Z){case 1:H=new Map,f=g.n(z),b=f.next();case 2:if(b.done){v.bT(4);break}L=b.value;u=H;X=u.set;return g.Y(v,Q.B(L),5);case 5:X.call(u,L,v.B);b=f.next();v.bT(2);break;case 4:return v.return(H)}})},rK=function(Q,z,H,f,b,L){z=g.ed(z,H);
f=Object.assign({},L,{priority:f,retryScheduleIntervalsInSeconds:b});return{actionType:Q,entityKey:z,actionMetadata:f}},sI=function(Q,z,H,f,b,L){this.status=Q;
this.Z=z;this.D=H;this.B=f;this.L=b;this.downloadState=L},U3s=function(Q,z,H){this.Z=Q;
this.rh=z;this.L=H},huT=function(Q,z){var H,f,b,L,u,X,v,y,q;
return g.B(function(M){switch(M.Z){case 1:return H=z.entityKey,b=(f=g.K(z.actionMetadata,Bv))==null?void 0:f.isEnqueuedForExpiredStreamUrlRefetch,g.$v(M,2),L=void 0,g.Y(M,cPY(Q,z),4);case 4:L=M.B;g.$v(M,5);var C=(C=g.K(z.actionMetadata,Bv))?{maximumDownloadQuality:C.maximumDownloadQuality}:void 0;return g.Y(M,Bds(H,Q.rh,{isEnqueuedForExpiredStreamUrlRefetch:b,tD:C,offlineSourceData:L}),7);case 7:u=M.B;g.Fa(M,6,2);break;case 5:return g.xv(M,2),X=vv(z)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",fM("PDE handleAdd error"),M.return(Pv(z,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",X,"DOWNLOAD_STATE_FAILED"));case 6:return g.Y(M,i85(Q,u,z),8);case 8:return M.return(Pv(z,!0,u.orchestrationActions));case 2:return v=g.xv(M),y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.nf&&v.type==="QUOTA_EXCEEDED"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),fM("PDE handleAdd error"),M.return(Pv(z,!1,void 0,y,q,"DOWNLOAD_STATE_FAILED"))}})},K4t=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY;
return g.B(function(Q9){switch(Q9.Z){case 1:return H=z.entityKey,f=g.Tp(H).entityId,g.Y(Q9,k0(Q.Z,{mode:"readonly",VE:!0},function(V){var R=WF(V,H,"playbackData"),Z=WF(V,g.ed(f,"offlineVideoPolicy"),"offlineVideoPolicy");V=WF(V,g.ed(f,"transfer"),"transfer");return g.xw.all([R,Z,V])}),2);
case 2:b=Q9.B;L=g.n(b);u=L.next().value;X=L.next().value;v=L.next().value;y=u;q=X;M=v;if(!y||!q)return Q9.return(Pv(z,!0));C=[];G=((E=y)==null?0:E.playerResponseJson)?JSON.parse(y.playerResponseJson):null;if(!(M&&G&&Q.rh.V("html5_refresh_deprecated_downloads"))){Q9.bT(3);break}t=W45(Q,G,M);return g.Y(Q9,D3L(Q,M),4);case 4:C=Q9.B;case 3:x={lastPlayerResponseTimestampSeconds:y.playerResponseTimestamp,offlineToken:q.offlineToken,formatIds:C};J={};if((I=M)==null?0:I.maximumDownloadQuality)J.maximumDownloadQuality=
M.maximumDownloadQuality;g.$v(Q9,5);r=void 0;return g.Y(Q9,cPY(Q,z),7);case 7:return r=Q9.B,g.$v(Q9,8),g.Y(Q9,Bds(H,Q.rh,{refreshData:x,tD:J,offlineSourceData:r,mediaCapabilities:t}),10);case 10:U=Q9.B;g.Fa(Q9,9,5);break;case 8:return g.xv(Q9,5),D=vv(z)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",fM("PDE handleRefresh error"),Q9.return(Pv(z,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",D,
"DOWNLOAD_STATE_FAILED"));case 9:return g.Y(Q9,i85(Q,U,z),11);case 11:return Q9.return(Pv(z,!0,U.orchestrationActions));case 5:return T=g.xv(Q9),k="PDE handleRefresh error",T instanceof Error&&(k="PDE handleRefresh error: "+T.message),bL="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",SY="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.nf&&T.type==="QUOTA_EXCEEDED"&&(bL="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",SY="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
fM(k),Q9.return(Pv(z,!1,void 0,bL,SY,"DOWNLOAD_STATE_FAILED"))}})},cPY=function(Q,z){var H,f,b,L;
return g.B(function(u){if(u.Z==1)return H=g.Tp(z.entityKey).entityId,f=g.ed(H,"videoDownloadContextEntity"),g.Y(u,eC(Q.Z,f,"videoDownloadContextEntity"),2);b=u.B;return(L=b)!=null&&L.offlineModeType?u.return({offlineModeType:b.offlineModeType}):u.return(void 0)})},i85=function(Q,z,H){var f,b,L,u,X;
return g.B(function(v){if(v.Z==1){if(!z.frameworkUpdates||!g.K(z.frameworkUpdates,Fz))return v.return();if(!(g.K(z.frameworkUpdates,Fz).mutations&&g.K(z.frameworkUpdates,Fz).mutations.length>0&&g.K(z.frameworkUpdates,Fz).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return v.bT(2);f=g.Tp(g.K(z.frameworkUpdates,Fz).mutations[0].entityKey).entityId;return g.Y(v,x4(Q.Z,f),3)}if(v.Z!=2){b=v.B;L=g.K(H.actionMetadata,Bv);if(X=(u=L)==null?void 0:u.playlistId)b.playlistId=X;b.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.mD(Q.rh)?g.Y(v,jg(f,Q.Z,H,Q.L,b),2):g.Ux(Q.rh)?g.Y(v,OI(f,Q.Z,H,Q.L),2):v.bT(2)}return g.Y(v,t$Y(g.K(z.frameworkUpdates,Fz)),0)})},Pv=function(Q,z,H,f,b,L){return new sI(z?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",vv(Q),H,f,b,L)},W45=function(Q,z,H){z=e_T(Q.rh,H.cotn,z);
H=g.uE(z);return g.aMY(z,H,Q.rh)},D3L=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C;
return g.B(function(t){if(t.Z==1)return H=[],g.Y(t,k0(Q.Z,{mode:"readonly",VE:!0},function(E){var G=[],x=z.offlineVideoStreams;if(x){x=g.n(x);for(var J=x.next();!J.done;J=x.next())G.push(WF(E,J.value,"offlineVideoStreams"))}return g.xw.all(G)}),2);
if(f=t.B)for(b=g.n(f),L=b.next();!L.done;L=b.next())if(u=L.value,X=void 0,(X=u)==null?0:X.streamsProgress)for(v=u.streamsProgress,y=0;y<v.length;y++)q=v[y],M=JSON.parse(q.formatStreamBytes),C={itag:M.itag,lmt:M.lastModified,xtags:M.xtags},H.push(C);return t.return(H)})},V05=function(Q,z){this.Z=Q;
this.rh=z},d3s=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t;
return g.B(function(E){switch(E.Z){case 1:return H=vv(z),g.Y(E,lX(Q.Z,"videoPlaybackPositionEntity"),2);case 2:f=E.B;if(f.length===0)return E.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));g.$v(E,3);return g.Y(E,cF.getInstance(),5);case 5:b=E.B;if(!b)throw Error("prefStorage is undefined");return g.Y(E,b.get("psi"),6);case 6:return L=E.B,v=(X=(u=L)==null?void 0:u.gH)!=null?X:"0",g.Y(E,rPx(f,v),7);case 7:return y=E.B,q={isPaused:y.watchHistoryPaused,gH:y.syncTimestampUsec},g.Y(E,b.set("psi",
q),8);case 8:if(q.isPaused){E.bT(9);break}M=g.K(y.frameworkUpdates,Fz);if(!y.frameworkUpdates||!M){E.bT(9);break}return g.Y(E,t$Y(M),9);case 9:g.Fa(E,4);break;case 3:return C=g.xv(E),t="PPE handleRefresh error: "+(C instanceof Error?C.message:"unknown error"),fM(t),E.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return E.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
H))}})},wks=function(Q,z){var H,f,b,L,u,X,v,y;
return g.B(function(q){switch(q.Z){case 1:return H=vv(z),f=g.Tp(z.entityKey).entityId,g.$v(q,2),g.Y(q,cF.getInstance(),4);case 4:b=q.B;if(!b)throw Error("prefStorage is undefined");return g.Y(q,b.get("psi"),5);case 5:L=q.B;u=g.K(z.actionMetadata,m3T);if(((X=L)==null?void 0:X.isPaused)!==!1||(v=u)==null||!v.lastPlaybackPositionSeconds){q.bT(6);break}y={key:g.ed(f,"videoPlaybackPositionEntity"),videoId:f,lastPlaybackPositionSeconds:u.lastPlaybackPositionSeconds};return g.Y(q,Tk(Q.Z,y,"videoPlaybackPositionEntity"),
6);case 6:g.Fa(q,3);break;case 2:return g.xv(q),q.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H))}})},kNs=function(Q,z){var H,f,b;
return g.B(function(L){switch(L.Z){case 1:H=vv(z);g.$v(L,2);f=g.Tp(z.entityKey).entityId;if(f==="!*$_ALL_ENTITIES_!*$")return g.Y(L,ves(Q.Z),5);b=g.ed(f,"videoPlaybackPositionEntity");return g.Y(L,Xru(Q.Z,b),5);case 5:g.Fa(L,3);break;case 2:return g.xv(L),L.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return L.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
H))}})},Tds=function(Q,z){this.api=Q;
this.Z=z;this.logger=new g.bk("woffle");this.B=!1;this.Po={nG:this.nG};this.logger.debug("Initialized OfflineMediaManager")},euO=function(Q){return g.B(function(z){return z.return($2t(Q))})},lPu=function(Q){var z;
return g.B(function(H){if(H.Z==1)return g.Y(H,g.vNn(Q),2);z=H.B;return H.return(z.filter(function(f){return!!f.url}).map(function(f){return f.url}))})},ap=function(Q,z){var H=g.Jh(z);
if(H===1||H===0)return Promise.resolve();(H=Rus(Q,z))&&H.stopVideo();Q.L=0;return euO(z)},UI=function(Q,z,H,f){H=H===void 0?!1:H;
f=f===void 0?!0:f;var b=typeof z==="string"?z:z.videoDetails.videoId;g.Jh(b)===2&&((z=Rus(Q,b))?z.stopVideo():Q.logger.info(function(){return"Corresponding player for "+b+" not found. Pausing anyway"}),g.NG(b,2),Q.L=2,H?Qes(Q.Z):f&&zRO(Q.Z))},Rus=function(Q,z){var H;
return((H=Q.player)==null?void 0:H.getVideoData().videoId)===z?Q.player:null},H5R=function(Q,z,H){z.getPlayerResponse();
g.NG(z.videoId,2);Q.L=2;Q.B=!1;var f;(f=Q.player)==null||f.dispose();Q.player=Q.api.CU(z);z={};Q.player.rZ((z.localmediachange=Q.xZ,z.signatureexpired=Q.Uo,z.statechange=Q.Xov,z),Q);var b=Q.nG(H);Q.player.jD(g.zQ(b,b,!0,"m"),!1);Q.logger.debug(function(){return"Starting headless playback with quality: "+b});
Q.player.gX(!1)},fRO=function(Q,z){this.Z=Q;
this.rh=z},Lsx=function(Q,z){var H,f;
return g.B(function(b){switch(b.Z){case 1:return H=vv(z),g.Y(b,eC(Q.Z,z.entityKey,"transfer"),2);case 2:if(f=b.B)return b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));g.$v(b,3);return g.Y(b,b5s(Q,z),5);case 5:g.Fa(b,4);break;case 3:return g.xv(b),b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
H))}})},ugm=function(Q,z){var H,f;
return g.B(function(b){switch(b.Z){case 1:return H=vv(z),g.Y(b,eC(Q.Z,z.entityKey,"transfer"),2);case 2:f=b.B;if(!f||f.transferState!=="TRANSFER_STATE_COMPLETE")return b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));g.$v(b,3);return g.Y(b,b5s(Q,z,!0),5);case 5:g.Fa(b,4);break;case 3:return g.xv(b),b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H))}})},S4u=function(Q,z){var H,f,b,L,u,X,v,y,q,M;
return g.B(function(C){switch(C.Z){case 1:return H=vv(z),f=g.Tp(z.entityKey).entityId,g.Y(C,k0(Q.Z,{mode:"readonly",VE:!0},function(t){var E=WF(t,z.entityKey,"transfer");t=WF(t,g.ed(f,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.xw.all([E,t])}),2);
case 2:b=C.B;L=g.n(b);u=L.next().value;X=L.next().value;v=u;y=X;if(!v||v.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return C.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));g.$v(C,3);v.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.Y(C,Tk(Q.Z,v,"transfer"),5);case 5:q=g.Tp(v.key).entityId;Xz({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:q,UG:v,offlineModeType:(M=y)==null?void 0:M.offlineModeType});g.Fa(C,
4);break;case 3:return g.xv(C),C.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return C.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H))}})},b5s=function(Q,z,H){H=H===void 0?!1:H;
var f,b,L,u,X,v,y,q,M,C,t,E,G,x,J;return g.B(function(I){switch(I.Z){case 1:return f=g.K(z.actionMetadata,Xzx),b=g.Tp(z.entityKey).entityId,L=g.ed(b,"downloadStatusEntity"),g.Y(I,k0(Q.Z,{mode:"readonly",VE:!0},function(r){var U=WF(r,L,"downloadStatusEntity");r=WF(r,g.ed(b,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.xw.all([U,r])}),2);
case 2:return u=I.B,X=g.n(u),v=X.next().value,y=X.next().value,q=v,M=y,C="TRANSFER_STATE_TRANSFER_IN_QUEUE",((t=q)==null?void 0:t.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(C="TRANSFER_STATE_PAUSED_BY_USER"),x={key:z.entityKey,transferState:C,cotn:g.xk(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(E=f)==null?void 0:E.maximumDownloadQuality,preferredAudioTrack:(G=f)==null?void 0:G.preferredAudioTrack,transferRetryCount:0,isRefresh:H,hasLoggedFirstStarted:!1},g.Y(I,k0(Q.Z,
{mode:"readwrite",VE:!0},function(r){var U=[];H&&U.push(dF(r,g.ed(b,"offlineVideoStreams")));U.push(Vl(r,x,"transfer"));return g.xw.all(U)}),3);
case 3:if(!H){I.bT(4);break}return g.Y(I,euO(b),4);case 4:Xz({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:b,UG:x,offlineModeType:(J=M)==null?void 0:J.offlineModeType}),g.Gu(I)}})},yZx=function(Q,z,H,f){if(!Q.action.entityKey)throw Error("entityKey is missing.");
var b=g.Tp(Q.action.entityKey);b={entityType:b.Pw,entityId:b.entityId,offlineOrchestrationActionType:Q.action.actionType,orchestrationAction:{orchestrationActionId:Q.actionId}};z&&(b.offlineOrchestrationActionResult=z.status,b.isRetryable=H?!1:z.Z,z.L&&(b.offlineOrchestrationFailureReason=vWL(z.L,b.isRetryable)));var L,u;if((L=Q.action.actionMetadata)==null?0:(u=L.offlineLoggingData)==null?0:u.offlineModeType)b.offlineModeType=Q.action.actionMetadata.offlineLoggingData.offlineModeType;f&&(b.additionalOrchestrationActions=
f.map(function(X){return{orchestrationActionId:X.actionId}}));
return b},vWL=function(Q,z){return Q!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||z?Q==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&z?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":Q:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},q4J=function(Q,z){var H={offlineOrchestrationContext:yZx(Q)};
z=NWx(z,H);I5O(JxY(),z,Q.rootActionId)},M_T=function(Q,z,H,f){f=f===void 0?[]:f;
z={offlineOrchestrationContext:yZx(Q,z,H,f)};z=NWx(3,z);I5O(JxY(),z,Q.rootActionId)},Cpm=function(){this.actions=[]},t_x=function(Q,z){z=g.n(z);
for(var H=z.next();!H.done;H=z.next())H=H.value,q4J(H,1),Q.actions.push(H);Q.actions.sort(Q.Z)},EWu=function(Q,z){if(z)for(var H=0;H<Q.actions.length;H++)if(z==="!*$_ALL_ENTITIES_!*$"&&Q.actions[H].actionId!==z||z!=="!*$_ALL_ENTITIES_!*$"&&Q.actions[H].rootActionId===z&&Q.actions[H].actionId!==z)Q.actions.splice(H,1),H--},pzx=function(Q,z){Q=g.n(Q.actions);
for(var H=Q.next();!H.done;H=Q.next())if(H.value.actionId===z)return!0;return!1},cv=function(Q,z,H,f,b){g.h.call(this);
var L=this;this.B=Q;this.L3=z;this.Ze=H;this.Y=f;this.rh=b;this.Z=new Cpm;this.j=new g.kC;this.L=new g.e_(function(){L.retry()});
this.N=NaN;this.S=!1;this.Po={qTq:function(){return L.Z},
Ih:function(){return L.j},
Dtj:function(){return L.L},
retry:function(){return L.retry()}};
g.W(this,this.L);this.U=this.B.observe(this.wh.bind(this))},Z5u=function(Q,z,H,f,b){var L;
return g.B(function(u){if(u.Z==1)return L=new cv(Q,z,H,f,b),g.Y(u,nWO(L),2);gWs(L);return u.return(L)})},gWs=function(Q){var z=Q.Z.actions[0];
return Q.D?((z==null?void 0:z.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&Q.D[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Q.S=!0),Promise.resolve()):GOY(Q)},GOY=function(Q){var z,H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J;
return g.B(function(I){switch(I.Z){case 1:if(Q.D)throw Error("Already processing an action");if(Q.Sm())return I.return();z=Q.Z.actions.shift();D2u(Q.Ze,!z);if(z===void 0)return I.return();z.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&z.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&EWu(Q.Z,z.actionId);H="";z.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&z.rootActionId===z.actionId&&(H=z.actionId);f=[z];Q.D=f;if(b=Q.L3[z.entityType]){I.bT(2);break}Q.D=
void 0;return g.Y(I,GOY(Q),3);case 3:return I.return();case 2:L=g.n(f);for(u=L.next();!u.done;u=L.next())X=u.value,q4J(X,2);g.$v(I,4,5);return g.Y(I,aPt(b,f.map(function(r){return r.action})),7);
case 7:v=I.B,y=g.n(f),q=y.next();case 8:if(q.done){I.bT(10);break}M=q.value;C=v.get(M.action);return g.Y(I,$Ns(Q,M,C),9);case 9:q=y.next();I.bT(8);break;case 10:EWu(Q.Z,H);case 5:g.OA(I);Q.D=void 0;g.oJ(I,6);break;case 4:return t=g.xv(I),fM("Orchestration error",t),g.$v(I,12),g.Y(I,jeR(Q,f),14);case 14:g.Fa(I,5);break;case 12:E=g.xv(I);fM("Orchestration retry error",E);G=g.n(f);for(x=G.next();!x.done;x=G.next())J=x.value,J.retryScheduleIndex<3&&t_x(Q.Z,[J]);I.bT(5);break;case 6:return g.Y(I,GOY(Q),
0)}})},$Ns=function(Q,z,H){var f,b,L,u,X,v,y,q,M,C,t,E;
return g.B(function(G){switch(G.Z){case 1:f=z.retryScheduleIndex+2===3;if(H.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){G.bT(2);break}if(H.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){G.bT(0);break}M_T(z,H,f);if(H.Z&&z.retryScheduleIndex+1<3)return g.Y(G,jeR(Q,[z]),0);L=((b=H)==null?0:b.B)?H.B:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";u={entityKey:z.action.entityKey,failureReason:L};X=void 0;g.mD(Q.rh)?X="mainVideoDownloadStateEntity":g.Ux(Q.rh)&&(X="musicTrackDownloadMetadataEntity");
if(!X||!H.downloadState){G.bT(7);break}v=g.Tp(z.action.entityKey).entityId;return g.Y(G,CM(v,X,Q.B,H.downloadState),7);case 7:LM(Q.Y,u);if(H.downloadState==="DOWNLOAD_STATE_FAILED"&&Q.rh.V("html5_auto_retry_failed_pde_actions")){G.bT(0);break}fM("Orchestration result is not retryable, deleting action");return g.Y(G,Xru(Q.B,Ze(z).key),0);case 2:y=void 0;try{y=(q=H.D)==null?void 0:q.map(function(x){return Q.createAction(x,z)})}catch(x){return M_T(z,H,f),M={entityKey:z.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},LM(Q.Y,M),fM("Orchestration subactions creation error",x),G.return()}M_T(z,H,f,y);if(!y){G.bT(12);break}C=y.map(function(x){return Ze(x)});
t=0;case 13:if(!(t<y.length)||Q.S){G.bT(15);break}return g.Y(G,k0(Q.B,{mode:"readwrite",VE:!0},function(x){var J=[];J.push(lkO(x,C.slice(t,t+10),"offlineOrchestrationActionWrapperEntity"));return g.xw.all(J)}),16);
case 16:t+=10;G.bT(13);break;case 15:if(Q.S)return Q.S=!1,G.return();case 12:return E=Ze(z),g.Y(G,Xru(Q.B,E.key),17);case 17:q4J(z,4),g.Gu(G)}})},oWO=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t;
return g.B(function(E){H=[];f=Infinity;b=4E3;L=g.n(z);for(u=L.next();!u.done;u=L.next())X=u.value,v=Number(X.enqueueTimeSec),y=Fsx(v),q=X.retryScheduleIndex,M=q!=null&&q>0,y>0&&M?(f=Math.min(f,v),b=Math.min(y,b)):H.push(X);isFinite(f)&&(!Q.L.isActive()||f<Q.N)&&(Q.N=f,Q.L.start(b));Q.j.yP()||(C=H.length,H=H.filter(function(G){var x;G=((x=G.actionProto)==null?void 0:x.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!xNs.includes(G)}),t=H.length<C,!Q.L.isActive()&&t&&Q.L.start(1));
H.length>0&&O5s(Q,H);return g.Y(E,gWs(Q),0)})},NNT=function(Q){var z,H,f,b,L,u,X;
return g.B(function(v){if(v.Z==1)return g.Y(v,JZJ(Q),2);z=v.B;H=[];f=g.n(z);for(b=f.next();!b.done;b=f.next())L=b.value,u=g.Tp(L.key),X=u.entityId,pzx(Q.Z,X)||H.push(L);return g.Y(v,oWO(Q,H),0)})},Fsx=function(Q){Q=Q*1E3-Date.now();
return Q>4E3?4E3:Q},jeR=function(Q,z){var H,f,b;
return g.B(function(L){H=g.n(z);for(f=H.next();!f.done;f=H.next()){b=f.value;var u=void 0,X=void 0,v=((X=b.action)==null?void 0:(u=X.actionMetadata)==null?void 0:u.retryScheduleIntervalsInSeconds)||[1,2,4];u=1;b.retryScheduleIndex<v.length&&(u=v[b.retryScheduleIndex]);b.Z=u*1E3+Date.now();b.retryScheduleIndex++}return g.Y(L,IRL(Q,z),0)})},nWO=function(Q){var z;
return g.B(function(H){if(H.Z==1)return g.Y(H,lX(Q.B,"offlineOrchestrationActionWrapperEntity"),2);z=H.B;return g.Y(H,oWO(Q,z),0)})},O5s=function(Q,z){z.length!==0&&z.forEach(function(H){H=gK(H);
H.retryScheduleIndex<3&&t_x(Q.Z,[H])})},JZJ=function(Q,z){var H;
return g.B(function(f){if(f.Z==1)return g.Y(f,lX(Q.B,"offlineOrchestrationActionWrapperEntity",z),2);H=f.B;return f.return(H.filter(Eet))})},IRL=function(Q,z){if(z.length===0)return Promise.resolve([]);
z=z.map(function(H){return Ze(H)});
return Six(Q.B,z)},AZu=function(Q){this.Yv=Q;
this.Z=void 0},Y4u=function(Q,z){var H,f,b,L;
return g.B(function(u){H=z.videoId;f=!0;if(z.captionTracks.length)b=TBR(z),Q.Z=new g.$b(Q.Yv,z,b);else if(z.cq)L=g.gHn(z),Q.Z=new g.Fe(Q.Yv,z.cq,H,L,z.B5,z.eventId),f=z.B5;else return u.return();return u.return(new Promise(function(X){var v;(v=Q.Z)==null||v.vk({cU:function(){return g.B(function(y){if(y.Z==1)return g.Y(y,Q.cU(H,f),2);X();g.Gu(y)})},
FE:function(){}})}))})},rZx=function(Q){var z;
return g.B(function(H){if(H.Z==1)return g.Y(H,GJs(Q),2);z=H.B;return H.return(!!z&&z.length>0)})},i9=function(Q){g.h.call(this);
this.Z=Q;this.B=this.Z.observe(this.L.bind(this))},seL=function(Q,z){var H,f,b,L,u,X,v;
return g.B(function(y){switch(y.Z){case 1:if(z.length===0)return y.return([]);H=z.map(function(q){return g.ed(q,"transfer")});
return g.Y(y,lX(Q.Z,"transfer",H),2);case 2:f=y.B;b=f.filter(Eet).map(function(q){return g.Tp(q.key).entityId});
L=z.filter(function(q){return b.indexOf(q)===-1});
if(L.length===0)return y.return([]);u=g.n(L);X=u.next();case 3:if(X.done){y.bT(5);break}v=X.value;return g.Y(y,euO(v),4);case 4:X=u.next();y.bT(3);break;case 5:return y.return(L)}})},aRB=function(Q,z,H,f,b,L){var u,X,v;
return g.B(function(y){u="STREAM_TYPE_UNKNOWN";H.video&&H.audio?(u="STREAM_TYPE_AUDIO_AND_VIDEO",fM("unexpected stream type")):H.video&&!H.audio?u="STREAM_TYPE_VIDEO":!H.video&&H.audio&&(u="STREAM_TYPE_AUDIO");X=g.ed(z,"offlineVideoStreams");v={numBytesDownloaded:b.toFixed(),numTotalBytes:L.toFixed(),streamType:u,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(f),itag:u==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(H.itag):void 0};return g.Y(y,k0(Q,{mode:"readwrite",VE:!0},
function(q){var M=WF(q,X,"offlineVideoStreams"),C=WF(q,g.ed(z,"transfer"),"transfer");return g.xw.all([M,C]).then(function(t){t=g.n(t);var E=t.next().value;t=t.next().value;if(!t)return dF(q,X).then(function(){});
var G=BNY(E);E=PpL(E,f,v,X);var x=Vl(q,E,"offlineVideoStreams");BNY(E)>G&&(t.lastProgressTimeMs=Date.now().toString());G=[x];t.offlineVideoStreams||(t.offlineVideoStreams=[]);t.offlineVideoStreams.indexOf(X)===-1&&(t.offlineVideoStreams.push(X),G.push(Vl(q,t,"transfer")));return g.xw.all(G)})}),0)})},UNx=function(Q,z){var H,f,b,L,u;
return g.B(function(X){if(X.Z==1)return H=g.ed(z,"offlineVideoStreams"),g.Y(X,eC(Q,H,"offlineVideoStreams"),2);f=X.B;if(!f||!f.streamsProgress)return X.return();b=g.n(f.streamsProgress);for(L=b.next();!L.done;L=b.next())u=L.value,u.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",u.numTotalBytes!==u.numBytesDownloaded&&(u.numBytesDownloaded=u.numTotalBytes);return g.Y(X,Tk(Q,f,"offlineVideoStreams"),0)})},PpL=function(Q,z,H,f){if(Q&&Q.streamsProgress){f=Q;
a:{z=z.itag+";"+z.xtags;for(var b=Q.streamsProgress,L=0;L<b.length;L++){var u=JSON.parse(b[L].formatStreamBytes);if(u.itag+";"+u.xtags===z){b[L]=H;H=b;break a}}b.push(H);H=b}f.streamsProgress=H}else Q={key:f,streamsProgress:[H]};return Q},BNY=function(Q){if(Q==null?0:Q.streamsProgress){var z=0;
Q=Q.streamsProgress;for(var H=0;H<Q.length;H++){var f=Q[H];isNaN(Number(f.numBytesDownloaded))?fM("stream progress bytes number invalid"):z+=Number(f.numBytesDownloaded)}return z}return 0},cZB=function(Q,z,H,f){g.h.call(this);
var b=this;this.B=Q;this.api=z;this.En=H;this.wh=f;this.j=new g.kC;this.D=new g.e_(function(){b.Z&&b.Z.transferState==="TRANSFER_STATE_TRANSFERRING"&&b.j.yP()&&((b.Z.transferRetryCount||0)<3?UI(b.Y,b.S,!1,!1):ap(b.Y,b.S.videoDetails.videoId),b.wg("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Ze=this.yl=0;this.U=this.N=!1;this.iT=g.qf(this.api.C().experiments,"html5_transfer_processing_logs_interval");this.mq=new g.Bt(this);this.Po={STh:function(){return b.D},
ere:function(){return b.wh},
Ih:function(){return b.j}};
this.L3=this.B.observe(this.jw.bind(this));this.Y=new Tds(z,this);this.uT=new AZu(z);this.De=new i9(this.B);this.jm=this.j.listen("publicytnetworkstatus-online",this.wu.bind(this));this.f3=this.j.listen("publicytnetworkstatus-offline",this.NVe.bind(this));this.U=this.api.C().V("html5_less_transfer_processing_logs");g.W(this,this.mq);this.mq.X(z,"offlinetransferpause",this.F4v);g.mD(this.api.C())?this.L="mainVideoDownloadStateEntity":g.Ux(this.api.C())&&(this.L="musicTrackDownloadMetadataEntity")},
i5x=function(Q){return g.B(function(z){if(z.Z==1)z=g.Y(z,gex(),2);
else{var H=Q.De;var f=g.oZ();f=Object.keys(f);H=seL(H,f);z=g.Y(z,H,0)}return z})},Wv=function(Q,z){z=z===void 0?!1:z;
var H;return g.B(function(f){if(f.Z==1){if(Q.Z)throw Error("Already downloading a video");Q.Ze=0;Q.N=!1;return g.Y(f,hRs(Q),2)}return f.Z!=4?(H=f.B,KEx(Q.En,!H),H&&Q.j.yP()?z?g.Y(f,new Promise(function(b){g.n1(b,1E3)}),4):f.bT(4):(!H&&Q.Z&&h3(Q),f.bT(0))):g.Y(f,WsB(Q,H),0)})},DNL=function(Q){return g.B(function(z){if(z.Z==1)return Q.S?g.Y(z,ap(Q.Y,Q.S.videoDetails.videoId),3):z.bT(0);
h3(Q);g.Gu(z)})},KsY=function(Q,z){var H,f,b;
return g.B(function(L){switch(L.Z){case 1:return g.$v(L,2),(H=!!z.captionTracks.length||!!z.cq)?g.Y(L,rZx(z.videoId),4):L.return();case 4:return(f=L.B)?L.return():g.Y(L,Y4u(Q.uT,z),5);case 5:g.Fa(L,0);break;case 2:b=g.xv(L),fM("Caption downloading error",b,z.cotn),g.Gu(L)}})},WsB=function(Q,z){var H,f,b,L,u,X;
return g.B(function(v){switch(v.Z){case 1:if(Q.N)return v.return();Q.N=!0;Q.Z=z;H=g.Tp(Q.Z.key);f=H.entityId;b=void 0;if(Q.Z.transferState==="TRANSFER_STATE_TRANSFERRING")return g.Y(v,De(Q,f),7);if(Q.Z.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||Q.Z.transferRetryCount||Q.Z.hasLoggedFirstStarted){v.bT(3);break}return g.Y(v,De(Q,f),5);case 5:return b=v.B,Q.Z.hasLoggedFirstStarted=!0,g.Y(v,V_O(Q),6);case 6:V$s({videoId:f,UG:Q.Z,offlineModeType:b},void 0,void 0,!0);v.bT(3);break;case 7:b=v.B,
Xz({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:f,UG:Q.Z,offlineModeType:b});case 3:return g.Y(v,dNx(Q),8);case 8:return L=null,g.$v(v,9),g.Y(v,mNJ(Q,z),11);case 11:L=v.B;Q.S=L;g.Fa(v,10);break;case 9:return u=g.xv(v),fM("error getting player response",u,z.cotn),g.Y(v,Q.wg("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return v.return();case 10:return X=e_T(Q.api.C(),z.cotn,L),g.Y(v,KsY(Q,X),13);case 13:return g.Y(v,lPu(X.videoId),
14);case 14:X.Qg=v.B,H5R(Q.Y,X,z.maximumDownloadQuality),Q.D.start(108E5),g.Gu(v)}})},hRs=function(Q){var z,H;
return g.B(function(f){if(f.Z==1)return g.Y(f,lX(Q.B,"transfer"),2);z=f.B;H=z.filter(wzJ).sort(kOs);return H.length===0?f.return():f.return(H[0])})},dNx=function(Q){var z,H,f;
return g.B(function(b){if(b.Z==1){if(!Q.Z)return KM(Q,"onTransferStart"),b.return();Q.D.start(108E5);return g.Y(b,VF(Q,"TRANSFER_STATE_TRANSFERRING"),2)}z=Q.Z;return(f=((H=z)==null?0:H.key)?g.Tp(z.key).entityId:"")&&Q.L?g.Y(b,CM(f,Q.L,Q.B,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):b.bT(0)})},Qes=function(Q){var z,H,f,b;
g.B(function(L){switch(L.Z){case 1:if(!Q.Z){KM(Q,"onTransferPausedByUser");L.bT(2);break}z=Q.Z;Q.D.stop();return g.Y(L,VF(Q,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:f=((H=z)==null?0:H.key)?g.Tp(z.key).entityId:"";if(!f||!Q.L){L.bT(4);break}return g.Y(L,CM(f,Q.L,Q.B,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.Y(L,De(Q,f),6);case 6:b=L.B,d2x({videoId:f,UG:z,offlineModeType:b});case 2:h3(Q),Wv(Q),g.Gu(L)}})},zRO=function(Q){var z,H,f;
g.B(function(b){if(b.Z==1){if(!Q.Z)return KM(Q,"onTransferPausedByNetwork"),b.return();Q.D.stop();return g.Y(b,VF(Q,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(b.Z!=3)return z=Q.Z,(f=((H=z)==null?0:H.key)?g.Tp(z.key).entityId:"")&&Q.L?g.Y(b,CM(f,Q.L,Q.B,"DOWNLOAD_STATE_PAUSED"),3):b.bT(3);h3(Q);g.Gu(b)})},TNu=function(Q){var z,H,f,b,L;
g.B(function(u){switch(u.Z){case 1:if(!Q.Z)return KM(Q,"onTransferComplete"),u.return();z=Q.Z;Q.D.stop();if(!z||!Q.S){u.bT(2);break}H=e_T(Q.api.C(),z.cotn,Q.S);return g.Y(u,KsY(Q,H),2);case 2:return g.Y(u,VF(Q,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:b=((f=z)==null?0:f.key)?g.Tp(z.key).entityId:"";if(!b||!Q.L){u.bT(5);break}return g.Y(u,CM(b,Q.L,Q.B,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.Y(u,UNx(Q.B,b),7);case 7:return g.Y(u,De(Q,b),8);case 8:L=u.B,Xz({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:b,UG:z,offlineModeType:L}),h3(Q),Wv(Q),g.Gu(u)}})},eRu=function(Q,z,H){var f,b;
g.B(function(L){switch(L.Z){case 1:if(!Q.Z)return KM(Q,"onTransferProgress: "+z),L.return();if(Q.Z.transferState==="TRANSFER_STATE_TRANSFERRING"){L.bT(2);break}return g.Y(L,dNx(Q),2);case 2:f=Date.now();if(!(f-Q.yl>1E3)){L.bT(4);break}Q.yl=f;return g.Y(L,aRB(Q.B,H.videoId,H.B,H.LG,H.bytesDownloaded,H.Z),5);case 5:if(Q.U&&!(Q.U&&f-Q.Ze>Q.iT)){L.bT(4);break}Q.Ze=f;return g.Y(L,De(Q,z),7);case 7:b=L.B,V$s({videoId:z,UG:Q.Z,offlineModeType:b},H.bytesDownloaded,H.Z);case 4:Q.D.start(108E5),g.Gu(L)}})},
lRu=function(Q){var z=(Q.Z.transferRetryCount||0)<3;
z&&(Q=Q.Z,Q.transferRetryCount=(Q.transferRetryCount||0)+1);return z},RRJ=function(Q,z){z=z===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":z;
var H,f,b,L;return g.B(function(u){if(u.Z==1)return Q.Z||KM(Q,"setTransferToFailed: "+z),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z==="TRANSFER_FAILURE_REASON_NETWORK"?H="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":z==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.Y(u,VF(Q,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",z),2);if(u.Z!=3)return LM(Q.wh,{entityKey:(f=Q.Z)==null?void 0:f.key,failureReason:H}),
b=Q.Z?g.Tp(Q.Z.key).entityId:"",g.Y(u,De(Q,b),3);L=u.B;var X={videoId:b,UG:Q.Z,offlineModeType:L},v=z,y={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};v&&(y.transferFailureReason=v,y.failureReason=m2s(v));Xz(y,X);g.Gu(u)})},VF=function(Q,z,H,f){var b;
return g.B(function(L){if(L.Z==1){if(!Q.Z)return KM(Q,"saveTransferState: "+z),L.return();Q.Z.transferState=z;Q.Z.failureReason=f;g.$v(L,2);return g.Y(L,V_O(Q,function(u){return H?D9(u,"offlineVideoStreams",Q.Z.offlineVideoStreams).then(function(X){for(var v=g.n(X),y=v.next();!y.done;y=v.next())if((y=y.value)&&y.streamsProgress){y=g.n(y.streamsProgress);for(var q=y.next();!q.done;q=y.next())q.value.streamState=H}return lkO(u,X.filter(function(M){return!!M}),"offlineVideoStreams")}):g.xw.resolve(void 0)}),
4)}if(L.Z!=2)return g.Fa(L,0);
b=g.xv(L);return b instanceof g.nf&&b.type==="QUOTA_EXCEEDED"?g.Y(L,Q.wg("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):L.bT(0)})},V_O=function(Q,z){var H;
return g.B(function(f){if(!Q.Z)return f.return();H=Q.Z;return g.Y(f,k0(Q.B,{mode:"readwrite",VE:!0},function(b){var L=[Vl(b,H,"transfer")];z&&L.push(z(b));return g.xw.all(L)}),0)})},h3=function(Q){Q.Z=void 0;
Q.S=void 0;Q.D.stop()},mNJ=function(Q,z){var H,f,b,L,u;
return g.B(function(X){if(X.Z==1)return H=g.Tp(z.key),f=H.entityId,b=g.ed(f,"playbackData"),g.Y(X,eC(Q.B,b,"playbackData"),2);L=X.B;if((u=L)==null?0:u.playerResponseJson)return X.return(JSON.parse(L.playerResponseJson));throw Error("No PlayerResponse found");})},KM=function(Q,z){Q.api.On("woffle",{mcte:z});
fM("missing current transfer entity.")},De=function(Q,z){var H,f,b;
return g.B(function(L){if(L.Z==1)return g.Y(L,eC(Q.B,g.ed(z,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);H=L.B;return L.return((b=(f=H)==null?void 0:f.offlineModeType)!=null?b:void 0)})},wzJ=function(Q){return QHx[Q.transferState]!==void 0},kOs=function(Q,z){var H=QHx[Q.transferState],f=QHx[z.transferState];
return H!==f?H-f:Number(Q.enqueuedTimestampMs)-Number(z.enqueuedTimestampMs)},dK=function(Q,z){var H=this;
this.rh=Q;this.api=z;this.j=new g.kC;this.S=new g.nW;this.Po={Cu:function(){return H.L.Po.Cu()},
Ih:function(){return H.j},
H9j:function(){return H.L},
JL:function(){return H.JL()},
r8:function(){return H.r8()},
O1:function(){return H.O1()},
q$:function(){return H.q$()},
Pg:function(){return H.Pg()},
I7:function(f){return H.I7(f)}};
this.L=new ihu(function(){return zEY(H)},function(){H.O1()},this.api.Kq(),this.api.V.bind(this.api));
this.Z=new b9(this.api);h_R(this.L)},zEY=function(Q){return g.B(function(z){Q.api.F$("onOrchestrationBecameLeader");
return g.Y(z,Q.r8(),0)})},fxx=function(Q){var z,H;
return g.B(function(f){if(f.Z==1)return g.Y(f,RN(),2);if(f.Z!=3){z=f.B;if(!z)return fM("PES is undefined"),f.return();Q.B=new cZB(z,Q.api,Q.L,Q.Z);H=Q.AJ(z);return g.Y(f,Z5u(z,H,Q.L,Q.Z,Q.rh),3)}Q.Y=f.B;return g.Y(f,HZx(Q),0)})},HZx=function(Q){var z;
return g.B(function(H){switch(H.Z){case 1:if(!Q.B)return fM("transferManager is undefined"),H.return();if(Q.B.Z){H.bT(2);break}return g.Y(H,Wv(Q.B),2);case 2:if(!Q.rh.V("woffle_enable_main_downloads_library")){H.bT(4);break}return g.Y(H,Q.qQ(),4);case 4:if(!Q.rh.V("html5_offline_playback_position_sync")){H.bT(6);break}return g.Y(H,Q.Ml(),7);case 7:return g.Y(H,Q.I7(864E5),6);case 6:return g.Y(H,Q.refreshAllStaleEntities(43200,!0),9);case 9:return g.Y(H,Q.Bf(),10);case 10:if(!Q.rh.V("html5_retry_downloads_for_expiration")){H.bT(11);
break}return g.Y(H,Q.Pg(),11);case 11:return Q.N=g.gR(function(){Q.refreshAllStaleEntities(43200,!0);Q.Bf()},9E5),g.R4(g.za(),function(){return Q.q$()}),g.Y(H,RN(),13);
case 13:return z=H.B,g.Y(H,cxm(z),14);case 14:WEs(Q.L),g.Gu(H)}})},bZT=function(){var Q,z,H,f,b,L;
return g.B(function(u){switch(u.Z){case 1:return g.Y(u,RN(),2);case 2:Q=u.B;if(!Q)return u.return([]);z=Date.now()/1E3;return g.Y(u,lX(Q,"offlineVideoPolicy"),3);case 3:H=u.B,f=g.n(H),b=f.next();case 4:if(b.done){u.bT(6);break}L=b.value;if(!(L.expirationTimestamp&&Number(L.expirationTimestamp)<z)){u.bT(5);break}L.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";L.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.Y(u,Tk(Q,L,"offlineVideoPolicy"),5);
case 5:b=f.next();u.bT(4);break;case 6:return u.return(H.map(function(X){return X.key}))}})},mF=function(Q,z,H,f,b){var L,u,X;
return g.B(function(v){if(v.Z==1)return g.Y(v,RN(),2);L=v.B;if(!L)return v.return([]);u=z.map(function(y){var q=g.ed(y,H);q={actionType:f,entityKey:q,actionMetadata:Object.assign({},l55(),b)};f!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(q.actionMetadata.priority=0);y=new nM(H,y,q);return Ze(y)});
X=Six(L,u);h_R(Q.L);return v.return(X)})},LgT=function(Q,z,H,f){var b,L,u,X,v,y,q,M;
return g.B(function(C){switch(C.Z){case 1:b=[],L=g.n(z),u=L.next();case 2:if(u.done){C.bT(4);break}X=u.value;if(X.upToDate||H&&!X.shouldAutoSyncMetadata||!X.playlistId){C.bT(3);break}v={};switch(f){case "mainPlaylistEntity":y={nextAutoRefreshIntervalSeconds:X.checkInSeconds,autoSync:H};v={mainPlaylistEntityActionMetadata:y};break;case "musicPlaylist":q={autoSync:H},v={musicPlaylistEntityActionMetadata:q}}return g.Y(C,mF(Q,[X.playlistId],f,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",v),6);case 6:(M=
C.B)&&b.push.apply(b,g.F(M));case 3:u=L.next();C.bT(2);break;case 4:return C.return(b)}})},u95=function(Q,z){var H;
return g.B(function(f){return z.length?(H=l55(),g.hl(H,Bv,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Q.api.On("qrd",{v:z.length}),f.return(mF(Q,z,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H))):f.return([])})},SFL=function(Q,z,H){this.Z=Q;
this.rh=z;this.L=H},yDs=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I;
return g.B(function(r){switch(r.Z){case 1:return H=vv(z),f=g.Tp(z.entityKey),b=f.entityId,L=[],g.$v(r,2),g.Y(r,XOY(Q,b),4);case 4:L=r.B;if(!(Q.rh.V("woffle_enable_main_downloads_library")&&((u=L)==null?0:u.length))){r.bT(5);break}return g.Y(r,q6R(Q.Z,[z.entityKey]),5);case 5:g.Fa(r,3);break;case 2:return X=g.xv(r),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.nf&&X.type==="QUOTA_EXCEEDED"?(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):fM("Playlist add error"),r.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,v,y));case 3:q=[];if(!Q.rh.V("html5_offline_prevent_redownload_downloaded_video")){r.bT(7);break}return g.Y(r,TWO(Q.Z,"mainVideoEntity",L),8);case 8:L=r.B;case 7:if((M=L)==null?0:M.length)for(C=g.n(L),t=C.next();!t.done;t=C.next())if(E=t.value,G=E.offlineVideoData,x=void 0,(x=G)==null?0:x.videoId)J=void 0,I=Number(((J=z.actionMetadata)==null?void 0:J.priority)||
0)+1,q.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G.videoId,"mainVideoEntity",I,wK,vFm(z,G,b)));return r.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,q))}})},MKs=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R,Z,d,h8,$O,Cs,J8,eY,Ls,ps,O,N,A,P,c,zu,Ln,uL,a,qk,pn,v_,Yv,tt,cu,Cr,V9,hC,vq,s7,wa,qz,mU,WY,wf,FU,Mz,sE,tn,B4,PQ,a2,I6,RG,kZ,fr,xW,W5;
return g.B(function(tC){switch(tC.Z){case 1:return H=vv(z),f=z.entityKey,b=g.Tp(f).entityId,L=[],u=!1,b==="!*$_ALL_ENTITIES_!*$"?(u=!0,g.Y(tC,lX(Q.Z,"mainPlaylistEntity"),5)):g.Y(tC,eC(Q.Z,f,"mainPlaylistEntity"),4);case 4:(X=tC.B)&&L.push(X);tC.bT(3);break;case 5:L=tC.B;case 3:if((v=L)==null||!v.length)return tC.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));y=g.K(z.actionMetadata,qFs);M=(q=y)==null?void 0:q.nextAutoRefreshIntervalSeconds;t=(C=y)==null?void 0:C.autoSync;E=[];x=G=
!0;J=!1;if(!u&&t===!1){tC.bT(6);break}g.$v(tC,7);return g.Y(tC,O8m(0,!!t,!0,L),9);case 9:E=tC.B;g.Fa(tC,8);break;case 7:I=g.xv(tC);if(!(I instanceof Error&&I.message==="No data")){I instanceof Error&&I.message==="Empty response body"&&fM(I.message);tC.bT(8);break}return b==="!*$_ALL_ENTITIES_!*$"?g.Y(tC,L4u(Q.Z,z,Q.L,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.Y(tC,fPm(b,Q.Z,z,Q.L),8);case 8:if(!E.length||!u&&E[0].playlistId!==b)return tC.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
H));case 6:if(u){r=[];U=g.n(E);for(D=U.next();!D.done;D=U.next())T=D.value,T.upToDate||t&&!T.shouldAutoSyncMetadata||!T.playlistId||(k={nextAutoRefreshIntervalSeconds:T.checkInSeconds,autoSync:t},r.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",T.playlistId,"mainPlaylistEntity",0,wK,{mainPlaylistEntityActionMetadata:k})));return tC.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,r))}E.length&&(bL=E[0],J=!!bL.upToDate,t&&(G=(SY=bL.shouldAutoSyncMetadata)!=null?SY:!0,x=(Q9=bL.shouldAutoSyncVideos)!=
null?Q9:!0,bL.checkInSeconds&&(M=bL.checkInSeconds)));if(J||!G)return tC.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));V=[];R=L[0];if(!R.downloadState){Z=void 0;tC.bT(15);break}return g.Y(tC,eC(Q.Z,R.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Z=tC.B;case 15:return d=Z,$O=((h8=d)==null?0:h8.addedTimestampMillis)?String(d.addedTimestampMillis):void 0,g.$v(tC,17),g.Y(tC,XOY(Q,b,$O,M),19);case 19:V=tC.B;g.Fa(tC,18);break;case 17:Cs=g.xv(tC);if(!(Cs instanceof Error&&
Cs.message==="No data for playlist")){if(Cs instanceof Error&&Cs.message==="Empty response body for playlist")fM(Cs.message);else return J8="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",eY="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Cs instanceof g.nf&&Cs.type==="QUOTA_EXCEEDED"&&(J8="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",eY="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),tC.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,J8,eY));tC.bT(18);
break}return g.Y(tC,fPm(b,Q.Z,z,Q.L),18);case 18:if(!x)return tC.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));Ls=[];ps=new Map;if((O=V)==null?0:O.length)for(N=g.n(V),A=N.next();!A.done;A=N.next())P=A.value,c=P.offlineVideoData,zu=void 0,((zu=c)==null?0:zu.videoId)&&ps.set(c.videoId,c);Ln=new Map;uL=[];if((a=R)==null?0:(qk=a.videos)==null?0:qk.length)for(pn=g.n(R.videos),v_=pn.next();!v_.done;v_=pn.next())if(Yv=v_.value,tt=JSON.parse(g.Tp(Yv).entityId),cu=tt.videoId)ps.has(cu)?(Ln.set(cu,
ps.get(cu)),ps.delete(cu)):uL.push(cu);V9=Number(((Cr=z.actionMetadata)==null?void 0:Cr.priority)||0)+1;hC=g.n(ps.entries());for(vq=hC.next();!vq.done;vq=hC.next())s7=vq.value,wa=g.n(s7),qz=wa.next().value,mU=wa.next().value,WY=qz,wf=mU,Ls.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",WY,"mainVideoEntity",V9,wK,vFm(z,wf,b)));FU=g.n(Ln.entries());for(Mz=FU.next();!Mz.done;Mz=FU.next())sE=Mz.value,tn=g.n(sE),B4=tn.next().value,PQ=tn.next().value,a2=B4,I6=PQ,Ls.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
a2,"mainVideoEntity",V9,wK,vFm(z,I6,b)));RG=g.n(uL);for(kZ=RG.next();!kZ.done;kZ=RG.next())fr=kZ.value,xW={playlistId:b},W5={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:xW},Ls.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",fr,"mainVideoEntity",0,wK,W5));return tC.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,Ls))}})},Cns=function(Q,z){var H,f,b,L;
return g.B(function(u){switch(u.Z){case 1:return H=vv(z),g.$v(u,2),f=g.Tp(z.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.Y(u,L4u(Q.Z,z,Q.L,(b=z.actionMetadata)==null?void 0:(L=b.offlineLoggingData)==null?void 0:L.offlineDeleteReason),5):g.Y(u,fPm(f,Q.Z,z,Q.L),6);case 6:if(!Q.rh.V("woffle_enable_main_downloads_library")){u.bT(5);break}return g.Y(u,M0L(Q.Z,z.entityKey),5);case 5:g.Fa(u,3);break;case 2:return g.xv(u),u.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return u.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H))}})},XOY=function(Q,z,H,f){var b,L,u,X,v,y,q;
return g.B(function(M){switch(M.Z){case 1:return g.Y(M,F4Y([z]),2);case 2:return b=M.B,g.Y(M,tKm(Q,b[0],H,f),3);case 3:return L=M.B,u=L.mainPlaylistEntity,X=L.rNT,y=zuR(u,(v=X)==null?void 0:v.avatar),g.$v(M,4),g.Y(M,$4(y),6);case 6:g.Fa(M,5);break;case 4:q=g.xv(M),q instanceof Error&&q.message==="Failed to fetch"&&fM(q.message);case 5:return M.return(b[0].videos)}})},tKm=function(Q,z,H,f){var b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U;
return g.B(function(D){switch(D.Z){case 1:b=Date.now().toString();H||(H=b);L=z.videos;u=z.playlistId;X=[];v=[];if(L)for(y=g.n(L),q=y.next();!q.done;q=y.next()){M=q.value;C=M.offlineVideoData;if(!C||!C.videoId)throw fM("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");t=C.videoId;E={videoId:t,playlistId:u};G={id:g.ed(JSON.stringify(E),"mainPlaylistVideoEntity"),video:g.ed(t,"mainVideoEntity")};X.push(G);v.push(G.id)}J={key:g.ed(u,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:H,lastSyncedTimestampMillis:b};I={key:g.ed(u,"mainPlaylistEntity"),playlistId:u,videos:v,title:z.title,thumbnailStyleData:EFY(z),visibility:pOs(z),downloadState:J.key};z.channel&&(r=z.channel.offlineChannelData,x=nFB(g.ed(u,"ytMainChannelEntity"),r),I.channelOwner=x.id);((U=I)==null?0:U.entityMetadata)?(I.entityMetadata.offlineLastModifiedTimestampSeconds=z.lastModifiedTimestamp,f&&(I.entityMetadata.nextAutoRefreshIntervalSeconds=String(f))):I&&(I.entityMetadata={nextAutoRefreshIntervalSeconds:f?
String(f):void 0,offlineLastModifiedTimestampSeconds:z.lastModifiedTimestamp});g.$v(D,2);return g.Y(D,k0(Q.Z,{mode:"readwrite",VE:!0},function(T){var k=Vl(T,I,"mainPlaylistEntity"),bL=Vl(T,J,"mainPlaylistDownloadStateEntity");k=[k,bL];bL=g.n(X);for(var SY=bL.next();!SY.done;SY=bL.next())k.push(Vl(T,SY.value,"mainPlaylistVideoEntity"));x&&k.push(Vl(T,x,"ytMainChannelEntity"));return g.xw.all(k)}),4);
case 4:g.Fa(D,3);break;case 2:throw g.xv(D),fM("PES failure for playlist"),Error("PES failure for playlist");case 3:return D.return({mainPlaylistEntity:I,rNT:x,b8v:X})}})},nFB=function(Q,z){return{id:Q,
channelId:z.channelId,title:z.title,avatar:z.thumbnail}},EFY=function(Q){var z=[],H=Q.videos;
H&&H.length>0&&z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:H[0].offlineVideoData.thumbnail}}});if((Q=Q.additionalMetadadatas)&&Q.length>0)for(Q=g.n(Q),H=Q.next();!H.done;H=Q.next()){var f=H.value.offlineBundleItemPlaylistData,b=void 0;H=(b=f)==null?void 0:b.style;b=void 0;f={collageThumbnail:{coverThumbnail:(b=f)==null?void 0:b.coverThumbnail}};switch(H){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:f});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:f});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:f});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:f})}}return z},pOs=function(Q){switch(Q.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},vFm=function(Q,z,H){z={offlineVideoData:z,
playlistId:H};if(Q=g.K(Q.actionMetadata,qFs))z.maximumDownloadQuality=Q.maximumDownloadQuality;return{mainVideoEntityActionMetadata:z}},gFL=function(Q,z,H){this.Z=Q;
this.rh=z;this.L=H},$PJ=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E;
return g.B(function(G){switch(G.Z){case 1:return H=vv(z),f=g.Tp(z.entityKey),b=f.entityId,L=g.K(z.actionMetadata,k4),X=!((u=L)==null?0:u.playlistId),g.$v(G,2),g.Y(G,ZZJ(Q,b,void 0,(v=L)==null?void 0:v.offlineVideoData,X),4);case 4:g.Fa(G,3);break;case 2:return y=g.xv(G),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.nf&&y.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
G.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,q,M));case 3:C=1;C=Number(((t=z.actionMetadata)==null?void 0:t.priority)||0)+1;var x=(x=g.K(z.actionMetadata,k4))?{playbackDataActionMetadata:{maximumDownloadQuality:x.maximumDownloadQuality}}:void 0;E=rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",b,"playbackData",C,GeO,x);return G.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,[E]))}})},jHt=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I;
return g.B(function(r){switch(r.Z){case 1:return H=vv(z),f=g.Tp(z.entityKey),b=f.entityId,g.Y(r,eC(Q.Z,z.entityKey,"mainVideoEntity"),2);case 2:L=r.B;if(!L){u=void 0;r.bT(3);break}return g.Y(r,eC(Q.Z,L.downloadState,"mainVideoDownloadStateEntity"),4);case 4:u=r.B;case 3:X=u;if(!L||!X)return r.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));g.$v(r,5);return g.Y(r,ZZJ(Q,b,X.addedTimestampMillis,(y=g.K(z.actionMetadata,k4))==null?void 0:y.offlineVideoData),7);case 7:q=1;q=Number(((M=
z.actionMetadata)==null?void 0:M.priority)||0)+1;v=rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b,"playbackData",q,GeO);g.Fa(r,6);break;case 5:C=g.xv(r);if(!(C instanceof Error&&C.message==="No data")){if(C instanceof Error&&C.message==="Empty response body")fM(C.message);else return t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.nf&&C.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),r.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,t,E));r.bT(6);break}return g.Y(r,x4(Q.Z,b),9);case 9:G=r.B;x=g.K(z.actionMetadata,k4);if(I=(J=x)==null?void 0:J.playlistId)G.playlistId=I;G.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.Y(r,jg(b,Q.Z,z,Q.L,G),6);case 6:return r.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,v?[v]:void 0))}})},FgY=function(Q,z){var H,f,b,L,u,X,v,y,q,M;
return g.B(function(C){switch(C.Z){case 1:return H=vv(z),g.$v(C,2),f=g.Tp(z.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.Y(C,L4u(Q.Z,z,Q.L,(q=z.actionMetadata)==null?void 0:(M=q.offlineLoggingData)==null?void 0:M.offlineDeleteReason),5):g.Y(C,x4(Q.Z,f),6);case 6:b=C.B;L=g.K(z.actionMetadata,k4);if(X=(u=L)==null?void 0:u.playlistId)b.playlistId=X;b.offlineDeleteReason=(v=z.actionMetadata)==null?void 0:(y=v.offlineLoggingData)==null?void 0:y.offlineDeleteReason;return g.Y(C,jg(f,Q.Z,z,Q.L,b),7);
case 7:if(!Q.rh.V("woffle_enable_main_downloads_library")){C.bT(5);break}return g.Y(C,M0L(Q.Z,z.entityKey),5);case 5:g.Fa(C,3);break;case 2:return g.xv(C),C.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return C.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H))}})},ZZJ=function(Q,z,H,f,b){var L,u,X,v,y,q;
return g.B(function(M){switch(M.Z){case 1:if(L=f){M.bT(2);break}return g.Y(M,jLs([z]),3);case 3:u=M.B,L=u[0];case 2:return g.Y(M,xPO(Q,L,H,b),4);case 4:X=M.B;v=X.mainVideoEntity;y=X.channelEntity;g.$v(M,5);var C=pM(v.thumbnail),t=pM(y.avatar);return g.Y(M,$4(C.concat(t)),7);case 7:g.Fa(M,0);break;case 5:q=g.xv(M),q instanceof Error&&q.message==="Failed to fetch"&&fM(q.message),g.Gu(M)}})},xPO=function(Q,z,H,f){var b,L,u,X,v,y,q,M,C,t,E,G,x;
return g.B(function(J){switch(J.Z){case 1:H||(H=Date.now().toString());L=(b=z.channel)==null?void 0:b.offlineChannelData;u={id:g.ed(z.videoId,"ytMainChannelEntity"),channelId:L.channelId,title:L.title,avatar:L.thumbnail};X={key:g.ed(z.videoId,"mainVideoDownloadStateEntity"),playbackData:g.ed(z.videoId,"playbackData"),addedTimestampMillis:H,videoDownloadContextEntity:g.ed(z.videoId,"videoDownloadContextEntity")};v={key:g.ed(z.videoId,"videoPlaybackPositionEntity"),videoId:z.videoId,lastPlaybackPositionSeconds:"0"};
Q.rh.V("html5_offline_playback_position_sync")&&(y={playbackPosition:v.key});q=g.ed(z.videoId,"mainVideoEntity");M={key:q,videoId:z.videoId,title:z.title,thumbnail:z.thumbnail,localizedStrings:{viewCount:z.shortViewCountText},userState:y,lengthSeconds:z.lengthSeconds?Number(z.lengthSeconds):void 0,publishedTimestampMillis:z.publishedTimestamp?(Number(z.publishedTimestamp)*1E3).toString():void 0,formattedDescription:z.description,owner:u.id,downloadState:X.key};if(!Q.rh.V("woffle_enable_main_downloads_library")||
!f){J.bT(2);break}return g.Y(J,yPs(Q.Z,[q]),3);case 3:if(E=J.B)C=E.mainDownloadsLibraryEntity,t=E.mainDownloadsListEntity;case 2:return x=kJs,G={key:g.ed(z.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.hl(X,x,G),g.Y(J,k0(Q.Z,{mode:"readwrite",VE:!0},function(I){var r=Vl(I,u,"ytMainChannelEntity"),U=Vl(I,X,"mainVideoDownloadStateEntity"),D=Vl(I,M,"mainVideoEntity");r=[r,U,D];Q.rh.V("html5_offline_playback_position_sync")&&(U=Vl(I,v,"videoPlaybackPositionEntity"),
r.push(U));C&&(U=Vl(I,C,"mainDownloadsLibraryEntity"),r.push(U));t&&(U=Vl(I,t,"mainDownloadsListEntity"),r.push(U));G&&(I=Vl(I,G,"downloadStatusEntity"),r.push(I));return g.xw.all(r)}),4);
case 4:return J.return({mainVideoEntity:M,channelEntity:u})}})},OZs=function(Q,z,H){this.Z=Q;
this.rh=z;this.L=H},JD5=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R;
return g.B(function(Z){switch(Z.Z){case 1:return H=vv(z),f=[],g.Y(Z,cF.getInstance(),2);case 2:b=Z.B;if(!b){Z.bT(3);break}return g.Y(Z,b.get("sdois"),4);case 4:return L=Z.B,g.Y(Z,(X=b)==null?void 0:X.get("lmqf"),5);case 5:u=Z.B;case 3:g.$v(Z,6);if(L===void 0)throw Error("prefStorage or opt-in state is undefined");v=[];if(L){Z.bT(8);break}return g.Y(Z,vBO(Q.Z),9);case 9:v=Z.B,v.reverse();case 8:if(!v.length){Z.bT(10);break}y=g.n(v);q=y.next();case 11:if(q.done){Z.bT(10);break}M=q.value;if(!M){Z.bT(12);
break}C=g.Tp(M).entityId;return g.Y(Z,x4(Q.Z,C),14);case 14:return t=Z.B,t.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.Y(Z,jg(C,Q.Z,{entityKey:M,actionType:z.actionType},Q.L,t),12);case 12:q=y.next();Z.bT(11);break;case 10:return g.Y(Z,JPm(L,(E=u)!=null?E:"SD"),16);case 16:return G=Z.B,g.Y(Z,uqs(G),17);case 17:x=XkY(G);if(!Q.rh.V("woffle_enable_main_downloads_library")){Z.bT(18);break}if(L){Z.bT(19);break}return g.Y(Z,M0L(Q.Z,g.Bl),19);case 19:return g.Y(Z,q6R(Q.Z,[g.Bl]),18);
case 18:if((J=x)==null?0:J.length)for(I=g.n(x),r=I.next();!r.done;r=I.next())if(D=U=r.value,T=D.actionType,k=D.entityKey,bL=D.actionMetadata,T&&k&&bL&&!g.K(bL,oFu)){T==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(bL.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(SY=g.K(U.actionMetadata,k4))SY.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",U.actionMetadata=Object.assign({},U.actionMetadata,{mainVideoEntityActionMetadata:SY});f.push(U)}g.Fa(Z,7);break;
case 6:return Q9=g.xv(Z),V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",R="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q9 instanceof g.nf&&Q9.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",R="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,V,R));case 7:return Z.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,f))}})},NvL=function(){dK.apply(this,arguments);
this.U="mainVideoEntity"},IxO=function(Q,z,H){z=z===void 0?43200:z;
H=H===void 0?!0:H;var f=f===void 0?!1:f;var b,L,u;return g.B(function(X){switch(X.Z){case 1:if(!Q.j.yP())return X.return([]);b=[];g.$v(X,2);return g.Y(X,O8m(z,H,f),4);case 4:b=X.B;g.Fa(X,3);break;case 2:L=g.xv(X),L instanceof Error&&L.message==="No data"||L instanceof Error&&L.message==="Empty response body"&&fM(L.message);case 3:return u=LgT(Q,b,H,"mainPlaylistEntity"),X.return(u)}})},ADu=function(Q,z,H,f){f=f===void 0?!1:f;
var b,L,u,X,v,y,q,M,C,t,E,G,x,J,I;return g.B(function(r){switch(r.Z){case 1:return b=[],g.Y(r,oBJ(),2);case 2:return(L=r.B)||f?g.Y(r,NdB(z,H),3):r.return([]);case 3:u=r.B;if((X=u)==null||!X.length)return r.return([]);v={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};y=g.n(u);q=y.next();case 4:if(q.done){r.bT(6);break}C=M=q.value;t=C.actionType;E=C.entityKey;G=C.actionMetadata;if(!(t&&E&&G)||g.K(G,oFu)){r.bT(5);break}t==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(G.offlineLoggingData=
v);x=g.Tp(E);J=x.entityId;return g.Y(r,mF(Q,[J],"mainVideoEntity",t,G),8);case 8:I=r.B,b=b.concat(I);case 5:q=y.next();r.bT(4);break;case 6:return r.return(b)}})},YF5=function(Q,z){this.Z=Q;
this.L=z},sHx=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J;
return g.B(function(I){switch(I.Z){case 1:return H=vv(z),f=g.Tp(z.entityKey),b=f.entityId,L=[],g.$v(I,2),g.Y(I,rDu(Q,b),4);case 4:L=I.B;if((u=L)==null||!u.length){I.bT(5);break}return g.Y(I,nBu(Q.Z,z.entityKey),5);case 5:g.Fa(I,3);break;case 2:return X=g.xv(I),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.nf&&X.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
I.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,v,y));case 3:return q=[],g.Y(I,TWO(Q.Z,"musicTrack",L),7);case 7:L=I.B;if(L.length)for(M=g.n(L),C=M.next();!C.done;C=M.next())if(t=C.value,E=t.offlineVideoData,G=void 0,(G=E)==null?0:G.videoId)x=void 0,J=Number(((x=z.actionMetadata)==null?void 0:x.priority)||0)+1,q.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",E.videoId,"musicTrack",J,T1,Nu(z,E,b)));return I.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,q))}})},
Bvs=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R,Z,d,h8,$O,Cs,J8,eY,Ls,ps,O,N,A,P,c,zu,Ln,uL,a,qk,pn,v_,Yv,tt,cu,Cr,V9,hC,vq,s7,wa,qz,mU;
return g.B(function(WY){switch(WY.Z){case 1:return H=vv(z),f=z.entityKey,b=g.Tp(f).entityId,L=[],u=!1,b==="!*$_ALL_ENTITIES_!*$"?(u=!0,g.Y(WY,lX(Q.Z,"musicAlbumRelease"),5)):g.Y(WY,eC(Q.Z,f,"musicAlbumRelease"),4);case 4:(X=WY.B)&&L.push(X);WY.bT(3);break;case 5:L=WY.B;case 3:if((v=L)==null||!v.length)return WY.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));if(u){y=[];q=g.n(L);for(M=q.next();!M.done;M=q.next())C=M.value,t=g.Tp(C.id).entityId,y.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
t,"musicAlbumRelease",0,T1));return WY.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,y))}E=[];G=L[0];x=void 0;if(!G.downloadMetadata){WY.bT(6);break}return g.Y(WY,eC(Q.Z,G.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:J=WY.B,x=Number((r=(I=J)==null?void 0:I.addedTimestampMillis)!=null?r:"0")/1E3;case 6:return g.$v(WY,8),g.Y(WY,rDu(Q,b,(U=x)==null?void 0:U.toString()),10);case 10:E=WY.B;g.Fa(WY,9);break;case 8:D=g.xv(WY);if(!(D instanceof Error&&D.message===
"No data")){if(D instanceof Error&&D.message==="Empty response body")fM(D.message);else return T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.nf&&D.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),WY.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,T,k));WY.bT(9);break}return g.Y(WY,op(b,"musicAlbumRelease",Q.Z,
z,Q.L),9);case 9:bL=[];SY=new Map;if((Q9=E)==null?0:Q9.length)for(V=g.n(E),R=V.next();!R.done;R=V.next())Z=R.value,d=Z.offlineVideoData,h8=void 0,((h8=d)==null?0:h8.videoId)&&SY.set(d.videoId,d);$O=new Map;Cs=[];if((J8=G)==null?0:(eY=J8.tracks)==null?0:eY.length)for(Ls=g.n(G.tracks),ps=Ls.next();!ps.done;ps=Ls.next())if(O=ps.value,N=g.Tp(O).entityId)SY.has(N)?($O.set(N,SY.get(N)),SY.delete(N)):Cs.push(N);P=Number(((A=z.actionMetadata)==null?void 0:A.priority)||0)+1;c=g.n(SY.entries());for(zu=c.next();!zu.done;zu=
c.next())Ln=zu.value,uL=g.n(Ln),a=uL.next().value,qk=uL.next().value,pn=a,v_=qk,bL.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",pn,"musicTrack",P,T1,Nu(z,v_)));Yv=g.n($O.entries());for(tt=Yv.next();!tt.done;tt=Yv.next())cu=tt.value,Cr=g.n(cu),V9=Cr.next().value,hC=Cr.next().value,vq=V9,s7=hC,bL.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",vq,"musicTrack",P,T1,Nu(z,s7)));wa=g.n(Cs);for(qz=wa.next();!qz.done;qz=wa.next())mU=qz.value,bL.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",mU,
"musicTrack",0,T1));return WY.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,bL))}})},PnL=function(Q,z){var H,f;
return g.B(function(b){switch(b.Z){case 1:return H=vv(z),g.$v(b,2),f=g.Tp(z.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.Y(b,J3(Q.Z,z,Q.L),5):g.Y(b,op(f,"musicAlbumRelease",Q.Z,z,Q.L),6);case 6:return g.Y(b,gBJ(Q.Z,z.entityKey),5);case 5:g.Fa(b,3);break;case 2:return g.xv(b),b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
H))}})},rDu=function(Q,z,H){var f,b,L;
return g.B(function(u){switch(u.Z){case 1:return g.Y(u,F4Y([z]),2);case 2:return f=u.B,g.Y(u,axs(Q,f[0],H),3);case 3:return b=u.B,L=pM(b.thumbnailDetails),g.Y(u,$4(L),4);case 4:return u.return(f[0].videos)}})},axs=function(Q,z,H){var f,b,L,u,X,v,y,q,M,C,t,E,G,x;
return g.B(function(J){if(J.Z==1){f=z.additionalMetadadatas;b=void 0;if(f&&f.length>0)for(L=g.n(f),u=L.next();!u.done;u=L.next())if(X=u.value,X.offlineMusicPlaylistData){b=X.offlineMusicPlaylistData;break}v=z.playlistId;y=Z8L(z);q=y.bM;M=y.Dc;C=H?(Number(H)*1E3).toString():Date.now().toString();t=z.lastModifiedTimestamp?(Number(z.lastModifiedTimestamp)*1E3).toString():"0";E={id:g.ed(v,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:M,lastModifiedTimestampMillis:t,addedTimestampMillis:C,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};G={id:g.ed(v,"musicAlbumRelease"),title:z.title,audioPlaylistId:v,trackCount:z.totalVideoCount,tracks:q,downloadMetadata:E.id};b&&(G.thumbnailDetails=(x=b.albumHqThumbnail)!=null?x:b.albumArtistThumbnail,G.artistDisplayName=b.albumArtistDisplayName,G.releaseDate=b.albumReleaseDate,G.contentRating={explicitType:b.albumReleaseExplicitType},G.releaseType=b.albumReleaseType);return g.Y(J,k0(Q.Z,{mode:"readwrite",VE:!0},function(I){var r=Vl(I,G,"musicAlbumRelease");
I=Vl(I,E,"musicAlbumReleaseDownloadMetadataEntity");return g.xw.all([r,I])}),2)}return J.return(G)})},UPu=function(Q,z){this.Z=Q;
this.L=z},iZR=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J;
return g.B(function(I){switch(I.Z){case 1:return H=vv(z),f=g.Tp(z.entityKey),b=f.entityId,L=[],g.$v(I,2),g.Y(I,cDT(Q,b),4);case 4:L=I.B;if((u=L)==null||!u.length){I.bT(5);break}return g.Y(I,nBu(Q.Z,z.entityKey),5);case 5:g.Fa(I,3);break;case 2:return X=g.xv(I),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.nf&&X.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
I.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,v,y));case 3:return q=[],g.Y(I,TWO(Q.Z,"musicTrack",L),7);case 7:L=I.B;if(L.length)for(M=g.n(L),C=M.next();!C.done;C=M.next())if(t=C.value,E=t.offlineVideoData,G=void 0,(G=E)==null?0:G.videoId)x=void 0,J=Number(((x=z.actionMetadata)==null?void 0:x.priority)||0)+1,q.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",E.videoId,"musicTrack",J,eg,Nu(z,E,b)));return I.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,q))}})},
hEB=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R,Z,d,h8,$O,Cs,J8,eY,Ls,ps,O,N,A,P,c,zu,Ln,uL,a,qk,pn,v_,Yv,tt,cu,Cr,V9,hC,vq,s7,wa,qz,mU,WY,wf,FU,Mz,sE,tn,B4,PQ,a2,I6,RG,kZ;
return g.B(function(fr){switch(fr.Z){case 1:return H=vv(z),f=z.entityKey,b=g.Tp(f).entityId,L=[],u=!1,b==="!*$_ALL_ENTITIES_!*$"?(u=!0,g.Y(fr,lX(Q.Z,"musicPlaylist"),5)):g.Y(fr,eC(Q.Z,f,"musicPlaylist"),4);case 4:(X=fr.B)&&L.push(X);fr.bT(3);break;case 5:L=fr.B;case 3:if((v=L)==null||!v.length)return fr.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));y=g.K(z.actionMetadata,GNx);M=(q=y)==null?void 0:q.autoSync;C=[];E=t=!0;G=!1;x=void 0;if(!u&&M===!1){fr.bT(6);break}g.$v(fr,7);return g.Y(fr,
IPO(0,!!M,!0,L),9);case 9:C=fr.B;g.Fa(fr,8);break;case 7:J=g.xv(fr);if(!(J instanceof Error&&J.message==="No data")){J instanceof Error&&J.message==="Empty response body"&&fM(J.message);fr.bT(8);break}return b==="!*$_ALL_ENTITIES_!*$"?g.Y(fr,J3(Q.Z,z,Q.L),8):g.Y(fr,op(b,"musicPlaylist",Q.Z,z,Q.L),8);case 8:if(!C.length||!u&&C[0].playlistId!==b)return fr.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));case 6:if(u){I=[];r=g.n(C);for(U=r.next();!U.done;U=r.next())D=U.value,D.upToDate||
M&&!D.shouldAutoSyncMetadata||!D.playlistId||(T={autoSync:M},I.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D.playlistId,"musicPlaylist",0,eg,{musicPlaylistEntityActionMetadata:T})));return fr.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,I))}C.length&&(k=C[0],G=!!k.upToDate,M&&(t=(bL=k.shouldAutoSyncMetadata)!=null?bL:!0,E=(SY=k.shouldAutoSyncVideos)!=null?SY:!0,k.checkInSeconds&&(x=k.checkInSeconds)));if(G||!t)return fr.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
H));Q9=[];V=L[0];R=void 0;if(!V.downloadMetadata){fr.bT(15);break}return g.Y(fr,eC(Q.Z,V.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Z=fr.B,R=Number((h8=(d=Z)==null?void 0:d.addedTimestampMillis)!=null?h8:"0")/1E3;case 15:return g.$v(fr,17),g.Y(fr,cDT(Q,b,($O=R)==null?void 0:$O.toString(),x),19);case 19:Q9=fr.B;g.Fa(fr,18);break;case 17:Cs=g.xv(fr);if(!(Cs instanceof Error&&Cs.message==="No data")){if(Cs instanceof Error&&Cs.message==="Empty response body")fM(Cs.message);else return J8=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",eY="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Cs instanceof g.nf&&Cs.type==="QUOTA_EXCEEDED"&&(J8="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",eY="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),fr.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,J8,eY));fr.bT(18);break}return g.Y(fr,op(b,"musicPlaylist",Q.Z,z,Q.L),18);case 18:if(!E)return fr.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
H));Ls=[];ps=new Map;if((O=Q9)==null?0:O.length)for(N=g.n(Q9),A=N.next();!A.done;A=N.next())P=A.value,c=P.offlineVideoData,zu=void 0,((zu=c)==null?0:zu.videoId)&&ps.set(c.videoId,c);Ln=new Map;uL=[];if((a=V)==null?0:(qk=a.tracks)==null?0:qk.length)for(pn=g.n(V.tracks),v_=pn.next();!v_.done;v_=pn.next())if(Yv=v_.value,tt=g.Tp(Yv).entityId)ps.has(tt)?(Ln.set(tt,ps.get(tt)),ps.delete(tt)):uL.push(tt);Cr=Number(((cu=z.actionMetadata)==null?void 0:cu.priority)||0)+1;V9=g.n(ps.entries());for(hC=V9.next();!hC.done;hC=
V9.next())vq=hC.value,s7=g.n(vq),wa=s7.next().value,qz=s7.next().value,mU=wa,WY=qz,Ls.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",mU,"musicTrack",Cr,eg,Nu(z,WY)));wf=g.n(Ln.entries());for(FU=wf.next();!FU.done;FU=wf.next())Mz=FU.value,sE=g.n(Mz),tn=sE.next().value,B4=sE.next().value,PQ=tn,a2=B4,Ls.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",PQ,"musicTrack",Cr,eg,Nu(z,a2)));I6=g.n(uL);for(RG=I6.next();!RG.done;RG=I6.next())kZ=RG.value,Ls.push(rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
kZ,"musicTrack",0,eg));return fr.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,Ls))}})},WgO=function(Q,z){var H,f;
return g.B(function(b){switch(b.Z){case 1:return H=vv(z),g.$v(b,2),f=g.Tp(z.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.Y(b,J3(Q.Z,z,Q.L),5):g.Y(b,op(f,"musicPlaylist",Q.Z,z,Q.L),6);case 6:return g.Y(b,gBJ(Q.Z,z.entityKey),5);case 5:g.Fa(b,3);break;case 2:return g.xv(b),b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
H))}})},cDT=function(Q,z,H,f){var b,L,u;
return g.B(function(X){switch(X.Z){case 1:return g.Y(X,F4Y([z]),2);case 2:return b=X.B,g.Y(X,DPL(Q,b[0],H,f),3);case 3:return L=X.B,u=pM(L.thumbnailDetails),g.Y(X,$4(u),4);case 4:return X.return(b[0].videos)}})},DPL=function(Q,z,H,f){var b,L,u,X,v,y,q,M,C;
return g.B(function(t){return t.Z==1?(b=z.playlistId,L=Z8L(z),u=L.bM,X=L.Dc,v=H?(Number(H)*1E3).toString():Date.now().toString(),y=z.lastModifiedTimestamp?(Number(z.lastModifiedTimestamp)*1E3).toString():"0",q={id:g.ed(b,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:X,lastModifiedTimestampMillis:y,addedTimestampMillis:v,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},M={id:g.ed(b,"musicPlaylist"),title:z.title,playlistId:b,thumbnailDetails:z.thumbnail,visibility:KgR(z),trackCount:z.totalVideoCount,
tracks:u,downloadMetadata:q.id},f&&(((C=M)==null?0:C.entityMetadata)?M.entityMetadata.nextAutoRefreshIntervalSeconds=String(f):M&&(M.entityMetadata={nextAutoRefreshIntervalSeconds:String(f)})),g.Y(t,k0(Q.Z,{mode:"readwrite",VE:!0},function(E){var G=Vl(E,M,"musicPlaylist");E=Vl(E,q,"musicPlaylistDownloadMetadataEntity");return g.xw.all([G,E])}),2)):t.return(M)})},KgR=function(Q){switch(Q.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},VKJ=function(Q,z){this.Z=Q;
this.L=z},keR=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E;
return g.B(function(G){switch(G.Z){case 1:return H=vv(z),f=g.Tp(z.entityKey),b=f.entityId,L=g.K(z.actionMetadata,dPR),g.$v(G,2),g.Y(G,mPO(Q,b,void 0,(u=L)==null?void 0:u.track,(X=L)==null?void 0:X.albumRelease),4);case 4:if((v=L)==null?0:v.playlistId){G.bT(5);break}return g.Y(G,nBu(Q.Z,z.entityKey),5);case 5:g.Fa(G,3);break;case 2:return y=g.xv(G),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.nf&&y.type==="QUOTA_EXCEEDED"&&
(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),G.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,q,M));case 3:t=Number(((C=z.actionMetadata)==null?void 0:C.priority)||0)+1;var x=(x=g.K(z.actionMetadata,dPR))?{playbackDataActionMetadata:{maximumDownloadQuality:x.maximumDownloadQuality}}:void 0;E=rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",b,"playbackData",t,wOu,x);return G.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
H,[E]))}})},TvR=function(Q,z){var H,f,b,L,u,X,v,y,q,M,C,t,E,G,x;
return g.B(function(J){switch(J.Z){case 1:return H=vv(z),f=g.Tp(z.entityKey),b=f.entityId,g.Y(J,eC(Q.Z,z.entityKey,"musicTrack"),2);case 2:L=J.B;if(!L){u=void 0;J.bT(3);break}return g.Y(J,eC(Q.Z,L.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:u=J.B;case 3:X=u;if(!L||!X)return J.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H));y=g.K(z.actionMetadata,dPR);g.$v(J,5);return g.Y(J,mPO(Q,b,X.addedTimestampMillis,(q=y)==null?void 0:q.track,(M=y)==null?void 0:M.albumRelease),
7);case 7:t=Number(((C=z.actionMetadata)==null?void 0:C.priority)||0)+1;v=rK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b,"playbackData",t,wOu);g.Fa(J,6);break;case 5:E=g.xv(J);if(!(E instanceof Error&&E.message==="No data")){if(E instanceof Error&&E.message==="Empty response body")fM(E.message);else return G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.nf&&E.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),J.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,G,x));J.bT(6);break}return g.Y(J,OI(b,Q.Z,z,Q.L),6);case 6:return J.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",H,v?[v]:void 0))}})},eEs=function(Q,z){var H,f;
return g.B(function(b){switch(b.Z){case 1:return H=vv(z),g.$v(b,2),f=g.Tp(z.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.Y(b,J3(Q.Z,z,Q.L),5):g.Y(b,OI(f,Q.Z,z,Q.L),6);case 6:return g.Y(b,gBJ(Q.Z,z.entityKey),5);case 5:g.Fa(b,3);break;case 2:return g.xv(b),b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",H,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new sI("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
H))}})},mPO=function(Q,z,H,f,b){var L,u,X,v,y,q;
return g.B(function(M){switch(M.Z){case 1:if(L=f){M.bT(2);break}return g.Y(M,jLs([z]),3);case 3:u=M.B,X=u[0],L=pkx(X);case 2:return g.Y(M,lxs(Q,L,z,b,H),4);case 4:v=M.B;y=v.musicTrackEntity;q=v.Nv;var C=pM(y.thumbnailDetails),t=[];q&&(t=pM(q.thumbnailDetails));return g.Y(M,$4(C.concat(t)),0)}})},lxs=function(Q,z,H,f,b){var L;
return g.B(function(u){return u.Z==1?(b||(b=Date.now().toString()),L={id:g.ed(H,"musicTrackDownloadMetadataEntity"),playbackData:g.ed(H,"playbackData"),addedTimestampMillis:b,videoDownloadContextEntity:g.ed(H,"videoDownloadContextEntity")},f&&(z.albumRelease=f.id),g.Y(u,k0(Q.Z,{mode:"readwrite",VE:!0},function(X){var v=[],y=Vl(X,L,"musicTrackDownloadMetadataEntity");v.push(y);y=Vl(X,z,"musicTrack");v.push(y);f&&(X=Vl(X,f,"musicAlbumRelease"),v.push(X));return g.xw.all(v)}),2)):u.Z!=3?g.Y(u,CM(H,"musicTrackDownloadMetadataEntity",
Q.Z,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):u.return({musicTrackEntity:z,
Nv:f})})},l9=function(){dK.apply(this,arguments);
this.U="musicTrack"},REt=function(Q,z,H){z=z===void 0?43200:z;
H=H===void 0?!0:H;var f=f===void 0?!1:f;var b,L;return g.B(function(u){switch(u.Z){case 1:if(!Q.j.yP())return u.return([]);b=[];g.$v(u,2);return g.Y(u,IPO(z,H,f),4);case 4:b=u.B;g.Fa(u,3);break;case 2:g.xv(u);case 3:return L=LgT(Q,b,H,"musicPlaylist"),u.return(L)}})},QfL=function(){g.g3.apply(this,arguments);
var Q=this;this.events=new g.Bt(this);this.rh=this.player.C();this.Po={O9l:function(){return Q.Z},
Ea:function(){return Q.Ea()},
xW:function(z){return Q.xW(z)}}},z$B=function(Q){var z;
Q=g.K((z=Q.getWatchNextResponse())==null?void 0:z.currentVideoEndpoint,g.ew);if(Q==null?0:Q.playlistId)var H=Q.playlistId;return H},HTu=function(Q,z){var H,f,b,L;
return g.B(function(u){if(u.Z==1){H=z.clientPlaybackNonce;f={cpn:H,offlineSourceVisualElement:g.FG(z.yl||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};z.B&&(f.videoFmt=Number(z.B.itag));z.D&&(f.audioFmt=Number(z.D.itag));if((b=z$B(z))&&z.videoId){var X=z.videoId;X=b!=="PPSV"?Promise.resolve(!1):Q.Z.OS(X);u=g.Y(u,X,3)}else u=u.bT(2);return u}u.Z!=2&&(L=u.B)&&(f.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");Q.B=H;g.y5("offlinePlaybackStarted",f);g.Gu(u)})};
g.OZ.prototype.CU=g.fn(51,function(Q){return this.app.CU(Q)});
g.gQ.prototype.CU=g.fn(50,function(Q){return g.BKJ(this,9,Q)});
g.p(aN,PF);g.Xa.Object.defineProperties(aN.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.Z.entityMetadata},
set:function(Q){this.Z.entityMetadata=Q}}});
g.p(lWs,aN);lWs.prototype.B=function(){return[]};
g.p(RZx,aN);RZx.prototype.B=function(){return[]};
g.p(Q2t,aN);Q2t.prototype.B=function(){return[]};
g.p(z8O,aN);z8O.prototype.B=function(){return[]};
g.p(H7s,aN);H7s.prototype.B=function(){var Q=[];this.Z.alternateChannel&&Q.push(this.Z.alternateChannel);this.Z.alternateChannelList&&Q.push.apply(Q,g.F(this.Z.alternateChannelList));this.Z.oneofChannelEntity&&Q.push(this.Z.oneofChannelEntity);return[].concat(g.F(new Set(Q)))};
g.p(fy5,aN);fy5.prototype.B=function(){var Q=[];this.Z.entryCollection&&Q.push(this.Z.entryCollection);return[].concat(g.F(new Set(Q)))};
g.p(b7s,PF);b7s.prototype.B=function(){var Q=[];this.Z.video&&Q.push(this.Z.video);return[].concat(g.F(new Set(Q)))};
g.p(LGL,aN);LGL.prototype.B=function(){var Q=[];this.Z.parentPlaylist&&Q.push(this.Z.parentPlaylist);if(this.Z.entries)for(var z=g.n(this.Z.entries),H=z.next();!H.done;H=z.next())Q.push.apply(Q,g.F((new b7s(H.value)).B()));return[].concat(g.F(new Set(Q)))};
g.p(uAs,aN);uAs.prototype.B=function(){var Q=[];this.Z.descriptionEntity&&Q.push(this.Z.descriptionEntity);this.Z.creators&&Q.push.apply(Q,g.F(this.Z.creators));this.Z.theBiggestFan&&Q.push(this.Z.theBiggestFan);return[].concat(g.F(new Set(Q)))};
g.p(Sam,aN);Sam.prototype.B=function(){return[]};
g.p(XQR,aN);XQR.prototype.B=function(){return[]};
g.p(vqs,aN);vqs.prototype.B=function(){return[]};
g.p(ykJ,aN);ykJ.prototype.B=function(){return[]};
g.p(qa5,aN);qa5.prototype.B=function(){return[]};
g.p(MFR,aN);MFR.prototype.B=function(){return[]};
g.p(ClL,aN);ClL.prototype.B=function(){return[]};
g.p(tFR,aN);tFR.prototype.B=function(){return[]};
g.p(Eqx,aN);Eqx.prototype.B=function(){return[]};
g.p(pQs,aN);pQs.prototype.B=function(){var Q=[];this.Z.downloadsList&&Q.push(this.Z.downloadsList);this.Z.smartDownloadsList&&Q.push(this.Z.smartDownloadsList);this.Z.recommendedDownloadsList&&Q.push(this.Z.recommendedDownloadsList);this.Z.refresh&&Q.push(this.Z.refresh);return[].concat(g.F(new Set(Q)))};
g.p(nqm,PF);nqm.prototype.B=function(){var Q=[];this.Z.video&&Q.push(this.Z.video);this.Z.playlist&&Q.push(this.Z.playlist);this.Z.videoItem&&Q.push(this.Z.videoItem);this.Z.playlistItem&&Q.push(this.Z.playlistItem);return[].concat(g.F(new Set(Q)))};
g.p(gqu,aN);gqu.prototype.B=function(){var Q=[];this.Z.refresh&&Q.push(this.Z.refresh);if(this.Z.downloads)for(var z=g.n(this.Z.downloads),H=z.next();!H.done;H=z.next())Q.push.apply(Q,g.F((new nqm(H.value)).B()));return[].concat(g.F(new Set(Q)))};
g.p(Z75,aN);Z75.prototype.B=function(){var Q=[];this.Z.localImageEntities&&Q.push.apply(Q,g.F(this.Z.localImageEntities));return[].concat(g.F(new Set(Q)))};
g.p(GnT,aN);GnT.prototype.B=function(){var Q=[];this.Z.playbackData&&Q.push(this.Z.playbackData);this.Z.localImageEntities&&Q.push.apply(Q,g.F(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&Q.push(this.Z.videoDownloadContextEntity);return[].concat(g.F(new Set(Q)))};
g.p($7s,aN);$7s.prototype.B=function(){return[]};
g.p(j2u,aN);j2u.prototype.B=function(){var Q=[];this.Z.fakeChildren&&Q.push.apply(Q,g.F(this.Z.fakeChildren));return[].concat(g.F(new Set(Q)))};
g.p(FGR,aN);FGR.prototype.B=function(){var Q=[];this.Z.video&&Q.push(this.Z.video);this.Z.playbackData&&Q.push(this.Z.playbackData);this.Z.offlineVideoPolicy&&Q.push(this.Z.offlineVideoPolicy);return[].concat(g.F(new Set(Q)))};
g.p(x7s,aN);x7s.prototype.B=function(){return[]};
g.p(O7L,aN);O7L.prototype.B=function(){var Q=[];this.Z.channelOwner&&Q.push(this.Z.channelOwner);this.Z.videos&&Q.push.apply(Q,g.F(this.Z.videos));this.Z.collaboratorChannels&&Q.push.apply(Q,g.F(this.Z.collaboratorChannels));this.Z.downloadState&&Q.push(this.Z.downloadState);this.Z.refresh&&Q.push(this.Z.refresh);return[].concat(g.F(new Set(Q)))};
g.p(oqL,aN);oqL.prototype.B=function(){var Q=[];this.Z.video&&Q.push(this.Z.video);this.Z.channelContributor&&Q.push(this.Z.channelContributor);return[].concat(g.F(new Set(Q)))};
g.p(Jku,PF);Jku.prototype.B=function(){var Q=[];this.Z.localImageEntities&&Q.push.apply(Q,g.F(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&Q.push(this.Z.videoDownloadContextEntity);return[].concat(g.F(new Set(Q)))};
g.p(Njs,PF);Njs.prototype.B=function(){var Q=[];this.Z.recommendedVideoMetadata&&Q.push.apply(Q,g.F((new Jku(this.Z.recommendedVideoMetadata)).B()));return[].concat(g.F(new Set(Q)))};
g.p(IyT,PF);IyT.prototype.B=function(){var Q=[];this.Z.playbackPosition&&Q.push(this.Z.playbackPosition);return[].concat(g.F(new Set(Q)))};
g.p(Akm,aN);Akm.prototype.B=function(){var Q=[];this.Z.owner&&Q.push(this.Z.owner);this.Z.downloadState&&Q.push(this.Z.downloadState);this.Z.userState&&Q.push.apply(Q,g.F((new IyT(this.Z.userState)).B()));this.Z.additionalMetadata&&Q.push.apply(Q,g.F((new Njs(this.Z.additionalMetadata)).B()));return[].concat(g.F(new Set(Q)))};
g.p(Ya5,aN);Ya5.prototype.B=function(){var Q=[];this.Z.userChannelDetails&&Q.push(this.Z.userChannelDetails);return[].concat(g.F(new Set(Q)))};
g.p(rks,aN);rks.prototype.B=function(){var Q=[];this.Z.channelOwner&&Q.push(this.Z.channelOwner);this.Z.playbackPosition&&Q.push(this.Z.playbackPosition);this.Z.localImageEntities&&Q.push.apply(Q,g.F(this.Z.localImageEntities));this.Z.downloadStatus&&Q.push(this.Z.downloadStatus);return[].concat(g.F(new Set(Q)))};
g.p(s2T,aN);s2T.prototype.B=function(){return[]};
g.p(Bj5,aN);Bj5.prototype.B=function(){return[]};
g.p(PlY,aN);PlY.prototype.B=function(){return[]};
g.p(ayu,aN);ayu.prototype.B=function(){return[]};
g.p(U7B,aN);U7B.prototype.B=function(){return[]};
g.p(cks,aN);cks.prototype.B=function(){return[]};
g.p(i7u,aN);i7u.prototype.B=function(){return[]};
g.p(h8m,aN);h8m.prototype.B=function(){return[]};
g.p(WGt,aN);WGt.prototype.B=function(){return[]};
g.p(D7s,aN);D7s.prototype.B=function(){return[]};
g.p(KGs,aN);KGs.prototype.B=function(){return[]};
g.p(VFB,aN);VFB.prototype.B=function(){var Q=[];this.Z.trackDownloadMetadatas&&Q.push.apply(Q,g.F(this.Z.trackDownloadMetadatas));return[].concat(g.F(new Set(Q)))};
g.p(d7R,aN);
d7R.prototype.B=function(){var Q=[];this.Z.downloadedTracks&&Q.push.apply(Q,g.F(this.Z.downloadedTracks));this.Z.smartDownloadedTracks&&Q.push.apply(Q,g.F(this.Z.smartDownloadedTracks));this.Z.downloadedEpisodes&&Q.push.apply(Q,g.F(this.Z.downloadedEpisodes));this.Z.downloadedAlbumReleases&&Q.push.apply(Q,g.F(this.Z.downloadedAlbumReleases));this.Z.smartDownloadedAlbumReleases&&Q.push.apply(Q,g.F(this.Z.smartDownloadedAlbumReleases));this.Z.downloadedPlaylists&&Q.push.apply(Q,g.F(this.Z.downloadedPlaylists));this.Z.smartDownloadedPlaylists&&
Q.push.apply(Q,g.F(this.Z.smartDownloadedPlaylists));this.Z.metadataOnlyTracks&&Q.push.apply(Q,g.F(this.Z.metadataOnlyTracks));return[].concat(g.F(new Set(Q)))};
g.p(m7u,aN);m7u.prototype.B=function(){var Q=[];this.Z.trackDownloadMetadatas&&Q.push.apply(Q,g.F(this.Z.trackDownloadMetadatas));return[].concat(g.F(new Set(Q)))};
g.p(wQJ,aN);wQJ.prototype.B=function(){var Q=[];this.Z.playbackData&&Q.push(this.Z.playbackData);this.Z.localImageEntities&&Q.push.apply(Q,g.F(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&Q.push(this.Z.videoDownloadContextEntity);return[].concat(g.F(new Set(Q)))};
g.p(knJ,aN);knJ.prototype.B=function(){var Q=[];this.Z.musicLibraryStatusEntity&&Q.push(this.Z.musicLibraryStatusEntity);this.Z.primaryArtists&&Q.push.apply(Q,g.F(this.Z.primaryArtists));this.Z.details&&Q.push(this.Z.details);this.Z.userDetails&&Q.push(this.Z.userDetails);this.Z.tracks&&Q.push.apply(Q,g.F(this.Z.tracks));this.Z.share&&Q.push(this.Z.share);this.Z.downloadMetadata&&Q.push(this.Z.downloadMetadata);this.Z.refresh&&Q.push(this.Z.refresh);return[].concat(g.F(new Set(Q)))};
g.p(Tju,aN);Tju.prototype.B=function(){var Q=[];this.Z.albumRelease&&Q.push(this.Z.albumRelease);this.Z.tracks&&Q.push.apply(Q,g.F(this.Z.tracks));return[].concat(g.F(new Set(Q)))};
g.p(e8T,aN);e8T.prototype.B=function(){var Q=[];this.Z.albumRelease&&Q.push(this.Z.albumRelease);return[].concat(g.F(new Set(Q)))};
g.p(lyO,aN);lyO.prototype.B=function(){var Q=[];this.Z.details&&Q.push(this.Z.details);this.Z.userDetails&&Q.push(this.Z.userDetails);return[].concat(g.F(new Set(Q)))};
g.p(R8u,aN);R8u.prototype.B=function(){var Q=[];this.Z.parentArtist&&Q.push(this.Z.parentArtist);return[].concat(g.F(new Set(Q)))};
g.p(QsB,aN);QsB.prototype.B=function(){var Q=[];this.Z.parentArtist&&Q.push(this.Z.parentArtist);return[].concat(g.F(new Set(Q)))};
g.p(zlJ,aN);zlJ.prototype.B=function(){return[]};
g.p(Hlu,aN);Hlu.prototype.B=function(){return[]};
g.p(fkT,PF);fkT.prototype.B=function(){var Q=[];this.Z.creatorEntity&&Q.push(this.Z.creatorEntity);return[].concat(g.F(new Set(Q)))};
g.p(blu,aN);
blu.prototype.B=function(){var Q=[];this.Z.tracks&&Q.push.apply(Q,g.F(this.Z.tracks));this.Z.refresh&&Q.push(this.Z.refresh);this.Z.musicLibraryStatusEntity&&Q.push(this.Z.musicLibraryStatusEntity);this.Z.details&&Q.push(this.Z.details);this.Z.downloadMetadata&&Q.push(this.Z.downloadMetadata);this.Z.sideloadMetadata&&Q.push(this.Z.sideloadMetadata);this.Z.userDetails&&Q.push(this.Z.userDetails);this.Z.entryCollection&&Q.push(this.Z.entryCollection);this.Z.share&&Q.push(this.Z.share);this.Z.podcastShowAdditionalMetadata&&Q.push.apply(Q,
g.F((new fkT(this.Z.podcastShowAdditionalMetadata)).B()));return[].concat(g.F(new Set(Q)))};
g.p(LoB,aN);LoB.prototype.B=function(){return[]};
g.p(uYR,aN);
uYR.prototype.B=function(){var Q=[];this.Z.musicLibraryStatusEntity&&Q.push(this.Z.musicLibraryStatusEntity);this.Z.artists&&Q.push.apply(Q,g.F(this.Z.artists));this.Z.audioModeVersion&&Q.push(this.Z.audioModeVersion);this.Z.videoModeVersion&&Q.push(this.Z.videoModeVersion);this.Z.userDetails&&Q.push(this.Z.userDetails);this.Z.details&&Q.push(this.Z.details);this.Z.albumRelease&&Q.push(this.Z.albumRelease);this.Z.share&&Q.push(this.Z.share);this.Z.libraryEdit&&Q.push(this.Z.libraryEdit);this.Z.downloadMetadata&&
Q.push(this.Z.downloadMetadata);this.Z.playbackPosition&&Q.push(this.Z.playbackPosition);this.Z.lyrics&&Q.push(this.Z.lyrics);return[].concat(g.F(new Set(Q)))};
g.p(Sns,aN);Sns.prototype.B=function(){var Q=[];this.Z.parentTrack&&Q.push(this.Z.parentTrack);return[].concat(g.F(new Set(Q)))};
g.p(XIu,aN);XIu.prototype.B=function(){var Q=[];this.Z.parentTrack&&Q.push(this.Z.parentTrack);return[].concat(g.F(new Set(Q)))};
g.p(v3t,aN);v3t.prototype.B=function(){return[]};
g.p(y5s,aN);y5s.prototype.B=function(){return[]};
g.p(qnt,aN);qnt.prototype.B=function(){return[]};
g.p(MtL,aN);MtL.prototype.B=function(){return[]};
g.p(CVu,aN);CVu.prototype.B=function(){var Q=[];this.Z.transfer&&Q.push(this.Z.transfer);this.Z.adsPlaybackData&&Q.push.apply(Q,g.F(this.Z.adsPlaybackData));this.Z.drmLicense&&Q.push(this.Z.drmLicense);this.Z.offlineVideoPolicy&&Q.push(this.Z.offlineVideoPolicy);this.Z.videoDownloadContextEntity&&Q.push(this.Z.videoDownloadContextEntity);return[].concat(g.F(new Set(Q)))};
g.p(ttT,aN);ttT.prototype.B=function(){return[]};
g.p(E3s,aN);E3s.prototype.B=function(){var Q=[];this.Z.offlineVideoStreams&&Q.push.apply(Q,g.F(this.Z.offlineVideoStreams));this.Z.captionTrack&&Q.push.apply(Q,g.F(this.Z.captionTrack));return[].concat(g.F(new Set(Q)))};
g.p(pIO,aN);pIO.prototype.B=function(){return[]};
g.p(n3O,aN);n3O.prototype.B=function(){return[]};
g.p(g35,aN);g35.prototype.B=function(){return[]};
g.p(Zlt,aN);Zlt.prototype.B=function(){return[]};
g.p(G9T,aN);G9T.prototype.B=function(){return[]};
g.p($TY,aN);$TY.prototype.B=function(){return[]};
g.p(jsu,aN);jsu.prototype.B=function(){return[]};
g.p(FoR,aN);FoR.prototype.B=function(){return[]};
g.p(xTJ,aN);xTJ.prototype.B=function(){return[]};
g.p(Olm,aN);Olm.prototype.B=function(){return[]};
g.p(o3Y,aN);o3Y.prototype.B=function(){return[]};
g.p(J5Y,aN);J5Y.prototype.B=function(){return[]};
g.p(NAO,aN);NAO.prototype.B=function(){return[]};
g.p(IkO,aN);IkO.prototype.B=function(){return[]};
g.p(A5R,aN);A5R.prototype.B=function(){return[]};
g.p(Ynm,aN);Ynm.prototype.B=function(){return[]};
g.p(r5R,aN);r5R.prototype.B=function(){return[]};
g.p(ssu,aN);ssu.prototype.B=function(){return[]};
var APO=["browse","music/browse","unplugged/browse"],P2s=["offline/playlist_sync_check"],$3R=["offline"],Y6O=["offline/offline_video_playback_position_sync"],sLY=["offline/get_playback_data_entity"],Uq;cF.getInstance=function(){return g.B(function(Q){return Q.return(new Promise(function(z){g.RE().then(function(H){H?(cF.instance||(cF.instance=new cF(H)),z(cF.instance)):z(void 0)})}))})};
cF.prototype.get=function(Q){var z=this,H,f,b;return g.B(function(L){if(L.Z==1)return g.Y(L,UTT(z.token),2);if(L.Z!=3)return H=L.B,g.Y(L,H.get("prefs",Q),3);f=L.B;if(!f)return L.return();b=(0,g.NV)();return f.expirationTimestampMs<=b?L.return():L.return(f.value)})};
cF.prototype.set=function(Q,z,H){H=H===void 0?31536E3:H;var f=this,b,L,u;return g.B(function(X){if(X.Z==1)return b=(0,g.NV)(),L={key:Q,value:z,expirationTimestampMs:b+H*1E3},g.Y(X,UTT(f.token),2);u=X.B;return g.Y(X,g.BH(u,"prefs",L),0)})};
cF.prototype.remove=function(Q){var z=this,H;return g.B(function(f){if(f.Z==1)return g.Y(f,UTT(z.token),2);H=f.B;return g.Y(f,H.delete("prefs",Q),0)})};
g.p(iX,g.wD);g.p(hV,DTO);hV.prototype.L=function(Q,z){z=Vts(z);Q=(new TextEncoder).encode(JSON.stringify(Q));return this.Z.encrypt(Q,z)};
hV.prototype.B=function(Q,z){if(!(Q instanceof Uint8Array))throw c5u(1);var H=new TextDecoder;z=Vts(z);Q=this.Z.decrypt(Q,z);return JSON.parse(H.decode(Q))};
var dTR={accountLinkStatusEntity:vqs,booleanEntity:Q2t,buttonEntity:o3Y,captionTrack:v3t,channelHandle:lWs,commerceAcquisitionClientPayloadEntity:NAO,commerceCartListEntity:IkO,contextNoteFeedEntityPayload:RZx,continuationTokenEntity:x7s,downloadQualityPickerEntity:ClL,downloadsPageRefreshTokenEntity:Eqx,downloadsPageViewConfigurationEntity:s2T,downloadStatusEntity:tFR,dismissState:G9T,sfvAudioItemCurrentlyPlayingEntity:n3O,emojiFountainDataEntity:xTJ,emojiCustomizationSetEntity:FoR,fakeChannel:H7s,
fakePlaylist:fy5,fakePlaylistEntryCollection:LGL,fakeVideo:uAs,fakeVideoDescription:Sam,featuredProductsEntity:WGt,flowStateEntity:XQR,iconBadgeEntity:A5R,interstitialInteractionStateEntity:qa5,likeButtonAnimationEntity:Bj5,liveChatPollStateEntity:MFR,liveReactionsDataEntity:Olm,logoEntity:ykJ,macroMarkerEntity:PlY,mainDownloadsLibraryEntity:pQs,mainDownloadsListEntity:gqu,mainPlaylistDownloadStateEntity:Z75,mainPlaylistEntity:O7L,mainPlaylistVideoEntity:oqL,mainVideoDownloadStateEntity:GnT,mainVideoEntity:Akm,
markersEngagementPanelSyncEntity:ayu,markersVisibilityOverrideEntity:U7B,musicAlbumReleaseDetail:Tju,musicAlbumReleaseDownloadMetadataEntity:VFB,musicAlbumRelease:knJ,musicAlbumReleaseUserDetail:e8T,musicArtistDetail:R8u,musicArtist:lyO,musicArtistUserDetail:QsB,musicDownloadsLibraryEntity:d7R,musicLibraryEdit:zlJ,musicLibraryStatusEntity:Hlu,musicPlaylist:blu,musicPlaylistDownloadMetadataEntity:m7u,musicShare:LoB,musicTrackDetail:Sns,musicTrackDownloadMetadataEntity:wQJ,musicTrack:uYR,musicTrackUserDetail:XIu,
offlineOrchestrationActionWrapperEntity:y5s,offlineVideoPolicy:qnt,offlineVideoStreams:MtL,offlineabilityEntity:$7s,orchestrationWebSamplingEntity:j2u,pageHeaderEntity:$TY,pdpStateEntity:Ynm,pinnedProductEntity:D7s,playbackData:CVu,playerStateEntity:cks,quantityIncrementerEntity:r5R,refresh:ttT,saveToPlaylistListEntity:g35,settingEntity:Zlt,stringEntity:z8O,suggestedFeedbackChipStateEntity:i7u,transfer:E3s,trendingOfferEntity:KGs,videoDownloadContextEntity:pIO,videoOverviewAsyncDataEntity:ssu,videoPlaybackPositionEntity:J5Y,
votingEntity:jsu,ytMainChannelEntity:Ya5,youchatPendingResponseEntity:h8m,ytMainDownloadedVideoEntity:FGR,ytMainVideoEntity:rks};g.p(mY,DTO);mY.prototype.L=function(Q){return Q};
mY.prototype.B=function(Q){if(Q instanceof Uint8Array)throw c5u(0);return Q};
g.p(wF,g.h);wF.prototype.observe=function(Q){var z=this;this.observers.push(Q);return function(){var H=z.observers.indexOf(Q);H>=0&&z.observers.splice(H,1)}};
wF.prototype.B=function(Q){uLO(this,Q.data)};
wF.prototype.zv=function(){this.channel.close()};
var qiR,S65=new g.NU("elementsCommand");var Fz=new g.NU("entityBatchUpdate");var kJs=new g.NU("downloadStatusEntity");var qFs=new g.NU("mainPlaylistEntityActionMetadata");var k4=new g.NU("mainVideoEntityActionMetadata");var GNx=new g.NU("musicPlaylistEntityActionMetadata");var dPR=new g.NU("musicTrackEntityActionMetadata");var oFu=new g.NU("localImageEntityActionMetadata");var Bv=new g.NU("playbackDataActionMetadata");var Xzx=new g.NU("transferEntityActionMetadata");var m3T=new g.NU("videoPlaybackPositionEntityActionMetadata");var oes;new g.nW;new g.nW;Yis.prototype.request=function(Q,z,H){z=z===void 0?{}:z;return this.locks.request(Q,z,function(f){return H(f)})};var Hv=g.iL.caches,z1,a5J;QF.prototype.open=function(Q){return Hv.open(BWs(Q))};
QF.prototype.has=function(Q){return Hv.has(BWs(Q))};
QF.prototype.delete=function(Q){return Hv.delete(BWs(Q))};
QF.prototype.match=function(Q,z){var H=this,f,b,L,u,X,v;return g.B(function(y){switch(y.Z){case 1:return g.Y(y,H.keys(),2);case 2:f=y.B,b=g.n(f),L=b.next();case 3:if(L.done){y.bT(5);break}u=L.value;return g.Y(y,H.open(u),6);case 6:return X=y.B,g.Y(y,X.match(Q,z),7);case 7:if(v=y.B)return y.return(v);L=b.next();y.bT(3);break;case 5:return y.return()}})};
g.p(s3s,QF);s3s.prototype.keys=function(){var Q,z,H,f,b,L,u,X,v;return g.B(function(y){if(y.Z==1)return Q=[],z=g.kQ("CacheStorage keys"),g.Y(y,Hv.keys(),2);H=y.B;f=g.n(H);for(b=f.next();!b.done;b=f.next()){L=b.value;var q=L.indexOf(":");u=q===-1?{jQ:L}:{jQ:L.substring(0,q),datasyncId:L.substring(q+1)};X=u.jQ;v=u.datasyncId;v===z&&Q.push(X)}return y.return(Q)})};g.p(b9,g.h);b9.prototype.L=function(Q){this.api.F$("onOfflineOperationFailure",Q.data)};
b9.prototype.D=function(Q){this.api.publish("offlinetransferpause",Q.data)};
b9.prototype.zv=function(){var Q;(Q=this.Z)==null||Q.close();var z;(z=this.B)==null||z.close()};ihu.prototype.Ox=function(){this.Z&&u9(this)};
ihu.prototype.eF=function(){this.B&&this.B.resolve();this.L=this.Z=!1;this.U()};var xNs=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var b8Y="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var EBu="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.p(U3s,Y4);U3s.prototype.B=function(Q){return yF(Q)?huT(this,Q):qu(Q)?K4t(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};g.p(V05,Y4);V05.prototype.B=function(Q){return qu(Q)?d3s(this,Q):wrB(Q)?wks(this,Q):Mu(Q)?kNs(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};g.S=Tds.prototype;g.S.Xov=function(Q){var z=this,H,f,b,L;return g.B(function(u){if(!g.w(Q.state,128))return u.bT(0);H=Q.state.WS;var X=(f=H)==null?void 0:f.errorCode,v=(b=H)==null?void 0:b.zE;L=X==="net.connect"&&v===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(X==null?0:X.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.Y(u,z.wg(z.player.getVideoData().videoId,L),0)})};
g.S.wg=function(Q,z){var H=this;return g.B(function(f){if(f.Z==1){if(H.B)return f.return();H.B=!0;return z==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(UI(H,Q,!1,!0),f.bT(0)):g.Y(f,ap(H,Q),3)}g.NG(Q,4);return g.Y(f,H.Z.wg(z),0)})};
g.S.xZ=function(Q){Q.status===2?(Q.status!==this.L&&(dNx(this.Z),g.NG(Q.videoId,2)),Q.E_&&eRu(this.Z,Q.videoId,Q.E_)):Q.status===4?(ap(this,Q.videoId),this.wg(Q.videoId,Q.d0?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):Q.status===1&&TNu(this.Z);this.L=Q.status;this.api.F$("localmediachange",{videoId:Q.videoId,status:Q.status})};
g.S.Uo=function(){var Q=this,z;return g.B(function(H){if(H.Z==1){if(Q.B)return H.return();Q.B=!0;z=Q.player.getVideoData().videoId;return g.Y(H,ap(Q,z),2)}return g.Y(H,Q.Z.Uo(),0)})};
g.S.nG=function(Q){switch(Q){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.S.V=function(Q){return this.api.C().V(Q)};g.p(fRO,Y4);fRO.prototype.B=function(Q){return yF(Q)?Lsx(this,Q):qu(Q)?ugm(this,Q):wrB(Q)?S4u(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};Cpm.prototype.Z=function(Q,z){var H=Q.action.actionMetadata.priority-z.action.actionMetadata.priority;H===0&&(Q.Z<z.Z?H=-1:Q.Z>z.Z&&(H=1));return H};g.p(cv,g.h);cv.prototype.zv=function(){this.U&&this.U();g.h.prototype.zv.call(this)};
cv.prototype.createAction=function(Q,z){var H=g.Tp(Q.entityKey).entityType,f=g.xk(16);return new nM(H,f,Q,z.actionId,z.rootActionId)};
cv.prototype.wh=function(Q){var z=this,H,f,b,L,u,X,v,y,q;return g.B(function(M){if(M.Z==1){if(z.Sm())return M.return();f=(H=Q.offlineOrchestrationActionWrapperEntity)!=null?H:new Set;b=[];L=g.n(f);for(u=L.next();!u.done;u=L.next())X=u.value,v=g.Tp(X),y=v.entityId,pzx(z.Z,y)||b.push(X);return g.Y(M,JZJ(z,b),2)}q=M.B;return g.Y(M,oWO(z,q),0)})};
cv.prototype.retry=function(){var Q=this;return g.B(function(z){return g.Y(z,NNT(Q),0)})};AZu.prototype.cU=function(Q,z){z=z===void 0?!0:z;var H=this,f,b,L,u,X,v,y,q;return g.B(function(M){switch(M.Z){case 1:if(!H.Z)return M.return();f=[];b=g.LA(H.Z.B,z);L=[];for(u={pK:0};u.pK<b.length;u={pK:u.pK},u.pK++)X=b[u.pK],v=H.Z.oU(X,"json3"),y=g.Y7(v,{withCredentials:!0,format:"RAW"},3,500).then(function(C){return function(t){t={metadata:g.Cv(b[C.pK]),trackData:t.xhr.responseText};L.push(t)}}(u)).IN(function(C){fM("Caption fetch error",C)}),f.push(y);
return g.Y(M,eZs(f),2);case 2:return g.$v(M,3),g.Y(M,Zhs(Q,L),5);case 5:g.Fa(M,0);break;case 3:q=g.xv(M),fM("Caption DB transaction error",q),g.Gu(M)}})};g.p(i9,g.h);i9.prototype.zv=function(){this.B&&this.B();g.h.prototype.zv.call(this)};
i9.prototype.L=function(Q){var z=this,H,f,b,L,u,X,v,y;return g.B(function(q){f=(H=Q.transfer)!=null?H:new Set;b=[];L=g.n(f);for(u=L.next();!u.done;u=L.next())X=u.value,v=g.Tp(X),y=v.entityId,b.push(y);return b.length===0?q.return():g.Y(q,seL(z,b),0)})};g.p(cZB,g.h);g.S=cZB.prototype;g.S.zv=function(){this.L3&&this.L3();this.De.dispose();this.D.dispose();this.jm&&g.hU(this.j.ya,this.jm);this.f3&&g.hU(this.j.ya,this.f3);g.h.prototype.zv.call(this)};
g.S.F4v=function(Q){var z=this,H,f,b;return g.B(function(L){switch(L.Z){case 1:H=g.ed(Q,"transfer");if(z.Z&&H===z.Z.key){UI(z.Y,z.S,!0);z.D.stop();L.bT(0);break}return g.Y(L,k0(z.B,{mode:"readwrite",VE:!0},function(u){return WF(u,H,"transfer").then(function(X){if(X&&X.transferState!=="TRANSFER_STATE_COMPLETE"&&X.transferState!=="TRANSFER_STATE_FAILED")return X.transferState="TRANSFER_STATE_PAUSED_BY_USER",Vl(u,X,"transfer").then(function(){return X})})}),3);
case 3:f=L.B;if(!f){L.bT(0);break}if(!Q||!z.L){L.bT(5);break}return g.Y(L,CM(Q,z.L,z.B,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.Y(L,De(z,Q),7);case 7:b=L.B,d2x({videoId:Q,UG:f,offlineModeType:b}),g.Gu(L)}})};
g.S.NVe=function(){var Q=this;if(this.Z&&this.S){UI(this.Y,this.S,!1);var z=this.Z,H=(z==null?0:z.key)?g.Tp(z.key).entityId:"";H&&this.L&&(new Promise(function(f,b){CM(H,Q.L,Q.B,"DOWNLOAD_STATE_PAUSED").catch(function(L){b(L)})})).catch(function(f){fM("Download state setting error",f)})}this.D.stop()};
g.S.wu=function(){this.Z?WsB(this,this.Z):Wv(this)};
g.S.jw=function(Q){var z=this;return g.B(function(H){switch(H.Z){case 1:if(!z.Z){H.bT(2);break}if(z.Z.transferState==="TRANSFER_STATE_COMPLETE"||z.Z.transferState==="TRANSFER_STATE_FAILED"||!Q.transfer||!Q.transfer.has(z.Z.key)){H.bT(3);break}return g.Y(H,eC(z.B,z.Z.key,"transfer"),4);case 4:z.Z=H.B;if(z.Z){H.bT(3);break}return g.Y(H,DNL(z),3);case 3:if(z.Z)return H.return();case 2:return g.Y(H,Wv(z),0)}})};
g.S.wg=function(Q,z){var H=this,f,b,L,u,X;return g.B(function(v){switch(v.Z){case 1:if(!H.Z){KM(H,"onTransferFailure: "+Q);v.bT(2);break}f=H.Z;L=((b=f)==null?0:b.key)?g.Tp(f.key).entityId:"";a:switch(Q){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var y=!1;break a;default:y=!0}return y&&lRu(H)?g.Y(v,VF(H,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.Y(v,
RRJ(H,Q),5);case 5:if(!L||!H.L){v.bT(2);break}return g.Y(v,CM(L,H.L,H.B,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.Y(v,De(H,L),9);case 9:u=v.B;Xz({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:L,UG:f,offlineModeType:u});if(!L||!H.L){v.bT(2);break}return g.Y(v,CM(L,H.L,H.B,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:h3(H),X=Wv(H,!0),z&&z(X),g.Gu(v)}})};
g.S.Uo=function(Q){var z=this,H,f,b,L,u,X,v,y,q,M,C,t;return g.B(function(E){switch(E.Z){case 1:if(!z.Z){KM(z,"onMaybeTransferStreamsExpired");E.bT(2);break}return lRu(z)?g.Y(E,VF(z,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.Y(E,RRJ(z,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!z.L){E.bT(2);break}H=z.Z;b=((f=H)==null?0:f.key)?g.Tp(H.key).entityId:"";if(!b){E.bT(2);break}return g.Y(E,CM(b,z.L,z.B,"DOWNLOAD_STATE_FAILED"),2);case 9:return z.Z||KM(z,"onMaybeTransferStreamsExpiredRetryAttempting"),
L=z.Z,X=((u=L)==null?0:u.key)?g.Tp(L.key).entityId:"",g.Y(E,De(z,X),10);case 10:return v=E.B,Xz({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:X,UG:L,offlineModeType:v}),y=l55(),g.hl(y,Bv,{isEnqueuedForExpiredStreamUrlRefetch:!0}),q=g.ed(X,"playbackData"),M={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:q,actionMetadata:y},C=Ze(new nM("playbackData",X,M)),g.Y(E,Tk(z.B,C,"offlineOrchestrationActionWrapperEntity"),2);case 2:h3(z),t=Wv(z,!0),
Q&&Q(t),g.Gu(E)}})};
var fVm={},QHx=(fVm.TRANSFER_STATE_TRANSFERRING=1,fVm.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,fVm);g.S=dK.prototype;g.S.JL=function(){return this.S.promise};
g.S.r8=function(){if(this.B&&this.Y)return this.S.promise;fxx(this).then(this.S.resolve).catch(this.S.reject);return this.S.promise};
g.S.AJ=function(Q){var z={};return z.playbackData=new U3s(Q,this.rh,this.Z),z.transfer=new fRO(Q,this.rh),z.videoPlaybackPositionEntity=new V05(Q,this.rh),z};
g.S.q$=function(){var Q=this;return g.B(function(z){return Q.B?g.Y(z,i5x(Q.B),0):z.bT(0)})};
g.S.O1=function(){var Q=this,z,H;return g.B(function(f){if(f.Z==1)return Q.B||Q.Y?g.Y(f,Q.JL(),2):f.return();Q.N!==void 0&&(g.Gr(Q.N),Q.N=void 0);Q.D!==void 0&&(g.Gr(Q.D),Q.D=void 0);(z=Q.B)==null||z.dispose();Q.B=void 0;(H=Q.Y)==null||H.dispose();Q.Y=void 0;Q.api.F$("onOrchestrationLostLeader");Q.S=new g.nW;g.Gu(f)})};
g.S.isOrchestrationLeader=function(){return this.L.Z};
g.S.OS=function(){return g.B(function(Q){return Q.return(!1)})};
g.S.Yy=function(Q){var z=this.Z;z.api.publish("offlinetransferpause",Q);var H;(H=z.B)==null||H.postMessage(Q)};
g.S.wu=function(Q){var z,H;return g.B(function(f){if(f.Z==1)return g.Y(f,RN(),2);z=f.B;if(!z)return f.return();H=g.ed(Q,"transfer");return g.Y(f,k0(z,{mode:"readwrite",VE:!0},function(b){var L=WF(b,H,"transfer"),u=WF(b,g.ed(Q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.xw.all([L,u]).then(function(X){X=g.n(X);var v=X.next().value;var y=X.next().value;return v&&v.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(v.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Vl(b,v,"transfer").then(function(){Xz({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:Q,UG:v,offlineModeType:y==null?void 0:y.offlineModeType});return g.xw.resolve(null)})):g.xw.resolve(null)})}),0)})};
g.S.Fy=function(Q){Q=Q===void 0?43200:Q;var z=this,H,f,b,L,u,X,v,y;return g.B(function(q){if(q.Z==1)return z.j.yP()?g.Y(q,RN(),2):q.return(bZT());if(q.Z!=3){H=q.B;if(!H)return q.return([]);f=Date.now()/1E3;return g.Y(q,lX(H,"offlineVideoPolicy"),3)}b=q.B;L=[];u=g.n(b);for(X=u.next();!X.done;X=u.next())v=X.value,Number(v.lastUpdatedTimestampSeconds)+Q<=f&&(y=g.Tp(v.key).entityId,L.push(y));return L.length?q.return(mF(z,L,z.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):q.return([])})};
g.S.deleteAll=function(){return mF(this,["!*$_ALL_ENTITIES_!*$"],this.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.S.refreshAllStaleEntities=function(Q){var z=this;return g.B(function(H){return H.Z==1?g.Y(H,z.Fy(Q),2):H.return(H.B)})};
g.S.setUpPositionSyncInterval=function(Q){var z=this;this.D!==void 0&&(g.Gr(this.D),this.D=void 0);var H=Q!=null?Q:864E5;this.D=g.gR(function(){z.I7(H)},H)};
g.S.I7=function(Q){var z=this,H,f,b,L,u,X;return g.B(function(v){switch(v.Z){case 1:return g.$v(v,2),g.Y(v,cF.getInstance(),4);case 4:H=v.B;if(!H)throw Error("prefStorage is undefined");return g.Y(v,H.get("psi"),5);case 5:f=v.B;L=((b=f)==null?0:b.gH)?Number(f.gH)/1E3:0;u=Date.now();if(!(L+Q<=u)){v.bT(6);break}return g.Y(v,mF(z,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Fa(v,0);break;case 2:X=g.xv(v),fM("Offline manager error",X),
g.Gu(v)}})};
g.S.Pg=function(){var Q=this,z,H,f,b,L,u,X;return g.B(function(v){if(v.Z==1)return g.Y(v,RN(),2);if(v.Z!=3)return(z=v.B)?g.Y(v,lX(z,"transfer"),3):v.return([]);H=v.B;f=[];b=g.n(H);for(L=b.next();!L.done;L=b.next())u=L.value,u.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&u.key&&(X=g.Tp(u.key).entityId,f.push(X));return v.return(u95(Q,f))})};
g.S.Bf=function(){return g.B(function(Q){return Q.return([])})};
g.S.qQ=function(){return g.B(function(Q){g.Gu(Q)})};
g.S.Ml=function(){return g.B(function(Q){g.Gu(Q)})};g.p(SFL,Y4);SFL.prototype.B=function(Q){return yF(Q)?yDs(this,Q):qu(Q)?MKs(this,Q):Mu(Q)?Cns(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};
var wK=[10];g.p(gFL,Y4);gFL.prototype.B=function(Q){return yF(Q)?$PJ(this,Q):qu(Q)?jHt(this,Q):Mu(Q)?FgY(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};
var GeO=[10];g.p(OZs,Y4);OZs.prototype.B=function(Q){return qu(Q)?JD5(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};g.p(NvL,dK);g.S=NvL.prototype;g.S.AJ=function(Q){var z=dK.prototype.AJ.call(this,Q);z.mainVideoEntity=new gFL(Q,this.rh,this.Z);z.mainPlaylistEntity=new SFL(Q,this.rh,this.Z);z.mainDownloadsListEntity=new OZs(Q,this.rh,this.Z);return z};
g.S.refreshAllStaleEntities=function(Q,z){var H=this,f,b,L,u,X,v,y,q,M,C,t;return g.B(function(E){switch(E.Z){case 1:f=[];if(!H.rh.V("web_player_offline_playlist_auto_refresh")){E.bT(2);break}return g.Y(E,IxO(H,Q,z),3);case 3:f=E.B;case 2:return g.Y(E,cF.getInstance(),4);case 4:return b=E.B,g.Y(E,(L=b)==null?void 0:L.get("sdois"),5);case 5:return u=E.B,g.Y(E,(X=b)==null?void 0:X.get("lmqf"),6);case 6:v=E.B;if(!u){E.bT(7);break}q=f;M=q.concat;return g.Y(E,ADu(H,u,(y=v)!=null?y:"SD",Q===0),8);case 8:f=
M.call(q,E.B);case 7:return C=f,t=C.concat,g.Y(E,dK.prototype.refreshAllStaleEntities.call(H,Q,z),9);case 9:return f=t.call(C,E.B),E.return(f)}})};
g.S.OS=function(Q){var z,H,f,b,L,u,X,v;return g.B(function(y){if(y.Z==1)return g.Y(y,RN(),2);if(y.Z!=3)return(z=y.B)?g.Y(y,eC(z,g.Bl,"mainDownloadsListEntity"),3):y.return(!1);H=y.B;if((f=H)==null?0:(b=f.downloads)==null?0:b.length)for(L=g.ed(Q,"mainVideoEntity"),u=g.n(H.downloads),X=u.next();!X.done;X=u.next())if(v=X.value,v.videoItem===L)return y.return(!0);return y.return(!1)})};
g.S.Bf=function(){var Q=this,z,H,f,b,L,u,X,v;return g.B(function(y){if(y.Z==1)return g.Y(y,RN(),2);if(y.Z!=3)return(z=y.B)?g.Y(y,lX(z,"downloadStatusEntity"),3):y.return([]);H=y.B;f=[];b=g.n(H);for(L=b.next();!L.done;L=b.next())u=L.value,u.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&u.key&&(X=g.Tp(u.key).entityId,f.push(X));return f.length?(v={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},y.return(mF(Q,f,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
v))):y.return([])})};
g.S.Ml=function(){var Q;return g.B(function(z){return z.Z==1?g.Y(z,RN(),2):(Q=z.B)?g.Y(z,k0(Q,{mode:"readwrite",VE:!0},function(H){return D9(H,"mainVideoEntity").then(function(f){var b=[];f=g.n(f);for(var L=f.next();!L.done;L=f.next()){L=L.value;var u=void 0;(u=L.userState)!=null&&u.playbackPosition||(u=g.Tp(L.key).entityId,u={key:g.ed(u,"videoPlaybackPositionEntity"),videoId:u,lastPlaybackPositionSeconds:"0"},b.push(Vl(H,u,"videoPlaybackPositionEntity")),L.userState={playbackPosition:u.key},b.push(Vl(H,
L,"mainVideoEntity")))}return g.xw.all(b)})}),0):z.return()})};
g.S.qQ=function(){var Q,z,H,f,b,L,u,X,v,y,q,M,C,t,E,G,x,J,I,r,U,D,T,k,bL,SY,Q9,V,R,Z,d,h8,$O,Cs,J8,eY,Ls,ps;return g.B(function(O){if(O.Z==1)return g.Y(O,RN(),2);if(O.Z!=3){Q=O.B;if(!Q)return O.return();z=g.ed("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.Y(O,k0(Q,{mode:"readonly",VE:!0},function(N){return g.xw.all([WF(N,z,"mainDownloadsListEntity"),WF(N,g.Bl,"mainDownloadsListEntity"),D9(N,"mainVideoEntity"),D9(N,"mainPlaylistEntity")])}),3)}H=O.B;
f=g.n(H);b=f.next().value;L=f.next().value;u=f.next().value;X=f.next().value;v=b;y=L;q=u;M=X;C=new Set;if((t=v)==null?0:(E=t.downloads)==null?0:E.length)for(G=g.n(v.downloads),x=G.next();!x.done;x=G.next())J=x.value,I=void 0,(r=(I=J.videoItem)!=null?I:J.playlistItem)&&C.add(r);if((U=y)==null?0:(D=U.downloads)==null?0:D.length)for(T=g.n(y.downloads),k=T.next();!k.done;k=T.next())bL=k.value,bL.videoItem&&C.add(bL.videoItem);SY=new Set;Q9=[];V=g.n(M);for(R=V.next();!R.done;R=V.next()){Z=R.value;if(Z.videos)for(d=
g.n(Z.videos),h8=d.next();!h8.done;h8=d.next())$O=h8.value,(Cs=JSON.parse(g.Tp($O).entityId).videoId)&&SY.add(Cs);Z.key&&!C.has(Z.key)&&Q9.push(Z.key)}J8=g.n(q);for(eY=J8.next();!eY.done;eY=J8.next())Ls=eY.value,Ls.key&&!C.has(Ls.key)&&(ps=g.Tp(Ls.key).entityId,SY.has(ps)||Q9.push(Ls.key));return Q9.length?g.Y(O,q6R(Q,Q9),0):O.bT(0)})};g.p(YF5,Y4);YF5.prototype.B=function(Q){return yF(Q)?sHx(this,Q):qu(Q)?Bvs(this,Q):Mu(Q)?PnL(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};
var T1=[10];g.p(UPu,Y4);UPu.prototype.B=function(Q){return yF(Q)?iZR(this,Q):qu(Q)?hEB(this,Q):Mu(Q)?WgO(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};
var eg=[10];g.p(VKJ,Y4);VKJ.prototype.B=function(Q){return yF(Q)?keR(this,Q):qu(Q)?TvR(this,Q):Mu(Q)?eEs(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};
var wOu=[10];g.p(l9,dK);l9.prototype.AJ=function(Q){var z=dK.prototype.AJ.call(this,Q);z.musicTrack=new VKJ(Q,this.Z);z.musicPlaylist=new UPu(Q,this.Z);z.musicAlbumRelease=new YF5(Q,this.Z);return z};
l9.prototype.refreshAllStaleEntities=function(Q,z){var H=this,f,b,L;return g.B(function(u){if(u.Z==1)return g.Y(u,REt(H,Q,z),2);if(u.Z!=3)return b=f=u.B,L=b.concat,g.Y(u,dK.prototype.refreshAllStaleEntities.call(H,Q,z),3);f=L.call(b,u.B);return u.return(f)})};g.p(QfL,g.g3);g.S=QfL.prototype;g.S.create=function(){var Q=this;g.W(this,this.events);g.mD(this.rh)?this.Z=new NvL(this.rh,this.player):g.Ux(this.rh)&&(this.Z=new l9(this.rh,this.player));this.events.X(this.player,"onPlaybackStartExternal",function(){Q.Ea()});
this.events.X(this.player,"videodatachange",function(){Q.Ea()});
this.rh.V("html5_offline_playback_position_sync")&&this.events.X(this.player,"presentingplayerstatechange",this.xW)};
g.S.Ti=function(){return!1};
g.S.II=function(Q,z,H,f){var b=this;return g.B(function(L){return b.Z?L.return(mF(b.Z,Q,z,H,f)):L.return(Promise.reject())})};
g.S.deleteAll=function(){return this.Z.deleteAll()};
g.S.Fy=function(Q){return this.Z.Fy(Q)};
g.S.refreshAllStaleEntities=function(Q){return this.Z.refreshAllStaleEntities(Q)};
g.S.setUpPositionSyncInterval=function(Q){this.Z.setUpPositionSyncInterval(Q)};
g.S.Yy=function(Q){this.Z.Yy(Q)};
g.S.wu=function(Q){return this.Z.wu(Q)};
g.S.Ea=function(){var Q=this,z;return g.B(function(H){z=Q.player.getVideoData();return g.lE(z)?z$B(z)&&Q.B!==z.clientPlaybackNonce?g.Y(H,HTu(Q,z),0):H.bT(0):H.return()})};
g.S.xW=function(Q){var z=this,H,f,b,L,u,X,v;return g.B(function(y){if(y.Z==1)return H=z.player.getVideoData(),f=H.iT,g.Ex(Q,2)||g.Ex(Q,512)?g.Y(y,RN(),2):y.return();if(y.Z!=3){b=y.B;if(!b)return fM("PES is undefined"),y.return();L=H.videoId;return g.Y(y,eC(b,g.ed(L,"mainVideoEntity"),"mainVideoEntity"),3)}u=y.B;if(!u)return y.return();X=Math.floor(f).toString();v={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:X}};return g.Y(y,z.II([L],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
v),0)})};
g.S.isOrchestrationLeader=function(){return this.Z.isOrchestrationLeader()};
g.S.updateDownloadState=function(Q,z){var H,f,b,L;return g.B(function(u){if(u.Z==1)return g.Y(u,RN(),2);H=u.B;if(!H)return fM("PES is undefined"),u.return();f=g.Tp(Q);b=f.entityType;L=f.entityId;return g.Y(u,CM(L,b,H,z,!0),0)})};g.nA("offline",QfL);})(_yt_player);
